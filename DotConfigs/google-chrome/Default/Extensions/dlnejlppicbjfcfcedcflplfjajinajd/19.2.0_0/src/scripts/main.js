"use strict";(()=>{var __defProp=Object.defineProperty;var __getOwnPropNames=Object.getOwnPropertyNames;var __esm=(fn,res)=>function(){return fn&&(res=(0,fn[__getOwnPropNames(fn)[0]])(fn=0)),res};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})};function Token(type,content,matchedStr,alias){this.type=type,this.content=content,this.alias=alias,this.length=matchedStr.length}var plainTextGrammar,rest,tokenize,resolve,languages,tokenizeText,withoutTokenizer,closingTag,openingTags,closingTags,highlightTokens,stringify,matchGrammar,init_index_EqkdgABH=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/index-EqkdgABH.js"(){plainTextGrammar={},rest=Symbol(),tokenize=Symbol(),resolve=id=>typeof id=="string"?languages[id]:id,languages={plain:plainTextGrammar,plaintext:plainTextGrammar,text:plainTextGrammar,txt:plainTextGrammar},tokenizeText=(text,grammar)=>(grammar[tokenize]||withoutTokenizer)(text,grammar),withoutTokenizer=(text,grammar)=>{for(var startNode=[text],restGrammar,array=[],i=0;restGrammar=resolve(grammar[rest]);)delete grammar[rest],Object.assign(grammar,restGrammar);for(matchGrammar(text,grammar,startNode,0);array[i++]=startNode[0],startNode=startNode[1];);return array},closingTag="</span>",openingTags="",closingTags="",highlightTokens=tokens=>{for(var str="",l=tokens.length,i=0;i<l;)str+=stringify(tokens[i++]);return str},stringify=token=>{if(token instanceof Token){var{type,alias,content}=token,prevOpening=openingTags,prevClosing=closingTags,opening=`<span class="token ${type+(alias?" "+alias:"")+(type=="keyword"&&typeof content=="string"?" keyword-"+content:"")}">`;closingTags+=closingTag,openingTags+=opening;var contentStr=stringify(content);return openingTags=prevOpening,closingTags=prevClosing,opening+contentStr+closingTag}return typeof token!="string"?highlightTokens(token):(token=token.replace(/&/g,"&amp;").replace(/</g,"&lt;"),closingTags&&token.includes(`
`)?token.replace(/\n/g,closingTags+`
`+openingTags):token)},matchGrammar=(text,grammar,startNode,startPos,rematch)=>{for(var token in grammar)if(grammar[token])for(var j=0,p=grammar[token],patterns=Array.isArray(p)?p:[p];j<patterns.length;++j){if(rematch&&rematch[0]==token&&rematch[1]==j)return;for(var patternObj=patterns[j],pattern=patternObj.pattern||patternObj,inside=resolve(patternObj.inside),lookbehind=patternObj.lookbehind,greedy=patternObj.greedy&&pattern.global,alias=patternObj.alias,currentNode=startNode,pos=startPos;currentNode&&(!rematch||pos<rematch[2]);pos+=currentNode[0].length,currentNode=currentNode[1]){var str=currentNode[0],removeCount=0,match,lookbehindLength;if(!(str instanceof Token)){if(pattern.lastIndex=greedy?pos:0,match=pattern.exec(greedy?text:str),match&&lookbehind&&match[1]&&(lookbehindLength=match[1].length,match.index+=lookbehindLength,match[0]=match[0].slice(lookbehindLength)),greedy){if(!match)break;if(match[0]){for(var from=match.index,to=from+match[0].length,l;from>=pos+(l=currentNode[0].length);currentNode=currentNode[1],pos+=l);if(currentNode[0]instanceof Token)continue;for(var k=currentNode,p=pos;(p+=k[0].length)<to;k=k[1],removeCount++);str=text.slice(pos,p),match.index-=pos}}if(match&&match[0]){for(var from=match.index,matchStr=match[0],after=str.slice(from+matchStr.length),reach=pos+str.length,newToken=new Token(token,inside?tokenizeText(matchStr,inside):matchStr,matchStr,alias),next=currentNode,i=0,nestedRematch;next=next[1],i++<removeCount;);after&&(!next||next[0]instanceof Token?next=[after,next]:next[0]=after+next[0]),pos+=from,currentNode[0]=from?str.slice(0,from):newToken,from?currentNode=currentNode[1]=[newToken,next]:currentNode[1]=next,removeCount&&(matchGrammar(text,grammar,currentNode,pos,nestedRematch=[token,j,reach]),reach=nestedRematch[2]),rematch&&reach>rematch[2]&&(rematch[2]=reach)}}}}}}});var createEditor,editorFromPlaceholder,templateEl,createTemplate,addTextareaListener,getElement,userAgent,isMac,isChrome,isWebKit,numLines,languageMap,editorTemplate,preventDefault,selectionChange,init_index_um6nVglX=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/index-um6nVglX.js"(){init_index_EqkdgABH();createEditor=(container2,options,...extensions)=>{let language,grammar,containerEl=getElement(container2),prevLines=[],activeLine,value="",activeLineNumber,removed=!1,focused=!1,handleSelecionChange=!0,tokens=[],readOnly,scrollContainer=editorTemplate(),wrapper=scrollContainer.firstChild,overlays=wrapper.firstChild,textarea=overlays.firstChild,lines2=wrapper.children,currentOptions={language:"text"},currentExtensions=new Set(extensions),listeners={selectionChange:new Set([([start,end,direction])=>{let newLine=lines2[activeLineNumber=numLines(value,0,direction=="backward"?start:end)];newLine!=activeLine&&(activeLine?.classList.remove("active-line"),newLine.classList.add("active-line"),activeLine=newLine),updateClassName()}])},setOptions=options2=>{({language,value=""}=Object.assign(currentOptions,{value},options2));let newGrammar=languages[language],isNewGrammar=grammar!=newGrammar;if(!newGrammar)throw Error(`Language '${language}' has no grammar.`);grammar=newGrammar,readOnly=!!currentOptions.readOnly,scrollContainer.style.tabSize=currentOptions.tabSize||2,textarea.inputMode=readOnly?"none":"",textarea.setAttribute("aria-readonly",readOnly),updateClassName(),updateExtensions(),(isNewGrammar||value!=textarea.value)&&(focusRelatedTarget(),textarea.value=value,textarea.selectionEnd=0,update2())},update2=()=>{tokens=tokenizeText(value=textarea.value,grammar),dispatchEvent("tokenize",tokens,language,value);let newLines=highlightTokens(tokens).split(`
`),l=newLines.length,start=0,end1=l,end2=prevLines.length,newHTML="";for(;newLines[start]==prevLines[start]&&start<end1;)++start;for(;end1&&newLines[--end1]==prevLines[--end2];);start==end1&&start==end2&&(lines2[++start].innerHTML=newLines[start-1]+`
`);let insertStart=end2<start?end2:start-1,i=insertStart;for(;i<end1;)newHTML+=`<div class="pce-line" aria-hidden="true">${newLines[++i]}
</div>`;for(i=end1<start?end1:start-1;i<end2;i++)lines2[start+1].remove();for(newHTML&&lines2[insertStart+1].insertAdjacentHTML("afterend",newHTML),i=insertStart+1;i<l;)lines2[++i].setAttribute("data-line",i);scrollContainer.style.setProperty("--number-width",Math.ceil(Math.log10(l+1))+".001ch"),dispatchEvent("update",value),dispatchSelection(!0),setTimeout(setTimeout,0,()=>handleSelecionChange=!0),prevLines=newLines,handleSelecionChange=!1},updateExtensions=newExtensions=>{(newExtensions||currentExtensions).forEach(extension=>{typeof extension=="object"?(extension.update(self,currentOptions),newExtensions&&currentExtensions.add(extension)):(extension(self,currentOptions),newExtensions||currentExtensions.delete(extension))})},updateClassName=([start,end]=getInputSelection())=>{scrollContainer.className=`prism-code-editor language-${language}${currentOptions.lineNumbers==!1?"":" show-line-numbers"} pce-${currentOptions.wordWrap?"":"no"}wrap${currentOptions.rtl?" pce-rtl":""} pce-${start==end?"no":"has"}-selection${focused?" pce-focus":""}${readOnly?" pce-readonly":""}`},getInputSelection=()=>[textarea.selectionStart,textarea.selectionEnd,textarea.selectionDirection],keyCommandMap={Escape(){textarea.blur()}},inputCommandMap={},focusRelatedTarget=()=>isWebKit&&!focused&&addTextareaListener(self,"focus",e=>{let relatedTarget=e.relatedTarget;relatedTarget?relatedTarget.focus():textarea.blur()},{once:!0}),dispatchEvent=(name,...args)=>{for(let handler of listeners[name]||[])handler.apply(self,args);currentOptions[`on${name[0].toUpperCase()}${name.slice(1)}`]?.apply(self,args)},dispatchSelection=force=>(force||handleSelecionChange)&&dispatchEvent("selectionChange",getInputSelection(),value),self={scrollContainer,wrapper,overlays,textarea,get activeLine(){return activeLine},get activeLineNumber(){return activeLineNumber},get value(){return value},options:currentOptions,get focused(){return focused},get removed(){return removed},get tokens(){return tokens},inputCommandMap,keyCommandMap,extensions:{},setOptions,update:update2,getSelection:getInputSelection,setSelection(start,end=start,direction){focusRelatedTarget(),textarea.setSelectionRange(start,end,direction),dispatchSelection(!0)},addExtensions(...extensions2){updateExtensions(extensions2)},addListener(name,handler){(listeners[name]||(listeners[name]=new Set)).add(handler)},removeListener(name,handler){listeners[name]?.delete(handler)},remove(){scrollContainer.remove(),removed=!0}};return addTextareaListener(self,"keydown",e=>{keyCommandMap[e.key]?.(e,getInputSelection(),value)&&preventDefault(e)}),addTextareaListener(self,"beforeinput",e=>{(readOnly||e.inputType=="insertText"&&inputCommandMap[e.data]?.(e,getInputSelection(),value))&&preventDefault(e)}),addTextareaListener(self,"input",update2),addTextareaListener(self,"blur",()=>{selectionChange=null,focused=!1,updateClassName()}),addTextareaListener(self,"focus",()=>{selectionChange=dispatchSelection,focused=!0,updateClassName()}),addTextareaListener(self,"selectionchange",e=>{dispatchSelection(),preventDefault(e)}),containerEl?.append(scrollContainer),options&&setOptions(options),self},editorFromPlaceholder=(placeholder,options,...extensions)=>{let el=getElement(placeholder),editor=createEditor(null,Object.assign({value:el.textContent},options),...extensions);return el.replaceWith(editor.scrollContainer),editor},templateEl=document.createElement("div"),createTemplate=html=>{templateEl.innerHTML=html;let node=templateEl.firstChild;return()=>node.cloneNode(!0)},addTextareaListener=(editor,type,listener,options)=>editor.textarea.addEventListener(type,listener,options),getElement=el=>typeof el=="string"?document.querySelector(el):el,userAgent=navigator.userAgent,isMac=/Mac|iPhone|iPod|iPad/i.test(navigator.platform),isChrome=/Chrome\//.test(userAgent),isWebKit=!isChrome&&/AppleWebKit\//.test(userAgent),numLines=(str,start=0,end=1/0)=>{let count=1;for(;(start=str.indexOf(`
`,start)+1)&&start<=end;count++);return count},languageMap={},editorTemplate=createTemplate('<div><div class="pce-wrapper"><div class="pce-overlays"><textarea spellcheck="false" autocapitalize="off" autocomplete="off">'),preventDefault=e=>{e.preventDefault(),e.stopImmediatePropagation()};document.addEventListener("selectionchange",()=>selectionChange?.())}});var getLineStart,getLineEnd,addListener,prevSelection,regexEscape,getLineBefore,getLines2,getClosestToken,getLanguage,insertText,getModifierCode,init_index_xwckIP_e=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/index-xwckIP-e.js"(){init_index_um6nVglX();getLineStart=(text,position)=>position?text.lastIndexOf(`
`,position-1)+1:0,getLineEnd=(text,position)=>(position=text.indexOf(`
`,position))+1?position:text.length,addListener=(editor,type,listener)=>(editor.addListener(type,listener),()=>editor.removeListener(type,listener)),regexEscape=str=>str.replace(/[$+?|.^*()[\]{}\\]/g,"\\$&"),getLineBefore=(text,position)=>text.slice(getLineStart(text,position),position),getLines2=(text,start,end=start)=>[text.slice(start=getLineStart(text,start),end=getLineEnd(text,end)).split(`
`),start,end],getClosestToken=(editor,selector,marginLeft=0,marginRight=marginLeft,position=editor.getSelection()[0])=>{let value=editor.value,line=editor.wrapper.children[numLines(value,0,position)],walker=document.createTreeWalker(line,5),node=walker.lastChild(),offset=getLineEnd(value,position)+1-position-node.length;for(;-offset<=marginRight&&(node=walker.previousNode());)if(!node.lastChild&&(offset-=node.length||0,offset<=marginLeft)){for(;node!=line;node=node.parentNode)if(node.matches?.(selector))return node}},getLanguage=(editor,position)=>getClosestToken(editor,'[class*="language-"]',0,0,position)?.className.match(/language-(\S*)/)[1]||editor.options.language,insertText=(editor,text,start,end,newCursorStart,newCursorEnd)=>{if(editor.options.readOnly)return;prevSelection=editor.getSelection(),end??(end=start);let textarea=editor.textarea,value=editor.value,avoidBug=isChrome&&!value[end??prevSelection[1]]&&/\n$/.test(text)&&/^$|\n$/.test(value),removeListener;editor.focused||textarea.focus(),start!=null&&textarea.setSelectionRange(start,end),newCursorStart!=null&&(removeListener=addListener(editor,"update",()=>{textarea.setSelectionRange(newCursorStart,newCursorEnd??newCursorStart,prevSelection[2]),removeListener()})),isWebKit||textarea.dispatchEvent(new InputEvent("beforeinput",{data:text})),isChrome||isWebKit?(avoidBug&&(textarea.selectionEnd--,text=text.slice(0,-1)),isWebKit&&(text+=`
`),document.execCommand(text?"insertHTML":"delete",!1,text.replace(/&/g,"&amp;").replace(/</g,"&lt;")),avoidBug&&textarea.selectionStart++):document.execCommand(text?"insertText":"delete",!1,text),prevSelection=0},getModifierCode=e=>e.altKey+e.ctrlKey*2+e.metaKey*4+e.shiftKey*8}});var commands_exports={};__export(commands_exports,{defaultCommands:()=>defaultCommands,editHistory:()=>editHistory,ignoreTab:()=>ignoreTab,setIgnoreTab:()=>setIgnoreTab});var ignoreTab,clipboard,mod,setIgnoreTab,whitespaceEnd,defaultCommands,editHistory,init_commands=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/extensions/commands.js"(){init_index_um6nVglX();init_index_xwckIP_e();ignoreTab=!1,clipboard=navigator.clipboard,mod=isMac?4:2,setIgnoreTab=newState=>ignoreTab=newState,whitespaceEnd=str=>str.search(/\S|$/),defaultCommands=(selfClosePairs=['""',"''","``","()","[]","{}"],selfCloseRegex=/([^$\w'"`]["'`]|.[[({])[.,:;\])}>\s]|.[[({]`/s)=>(editor,options)=>{let prevCopy,{keyCommandMap,inputCommandMap,getSelection}=editor,getIndent=({insertSpaces=!0,tabSize})=>[insertSpaces?" ":"	",insertSpaces?tabSize||2:1],scroll=()=>!editor.extensions.cursor?.scrollIntoView(),selfClose=([start,end],[open,close],value,wrapOnly)=>(start<end||!wrapOnly&&selfCloseRegex.test((value[end-1]||" ")+open+(value[end]||" ")))&&!insertText(editor,open+value.slice(start,end)+close,null,null,start+1,end+1),skipIfEqual=([start,end],char,value)=>start==end&&value[end]==char&&!editor.setSelection(start+1),insertLines=(old,newL,start,end,selectionStart,selectionEnd)=>{let newLines=newL.join(`
`);if(newLines!=old.join(`
`)){let last=old.length-1,lastLine=newL[last],oldLastLine=old[last],lastDiff=oldLastLine.length-lastLine.length,firstDiff=newL[0].length-old[0].length,firstInsersion=start+whitespaceEnd((firstDiff<0?newL:old)[0]),lastInsersion=end-oldLastLine.length+whitespaceEnd(lastDiff>0?lastLine:oldLastLine),offset=start-end+newLines.length+lastDiff,newCursorStart=firstInsersion>selectionStart?selectionStart:Math.max(firstInsersion,selectionStart+firstDiff),newCursorEnd=selectionEnd+start-end+newLines.length;insertText(editor,newLines,start,end,newCursorStart,selectionEnd<lastInsersion?newCursorEnd+lastDiff:Math.max(lastInsersion+offset,newCursorEnd))}},indent=(outdent,lines2,start1,end1,start,end,indentChar,tabSize)=>{insertLines(lines2,lines2.map(outdent?str=>str.slice(whitespaceEnd(str)?tabSize-whitespaceEnd(str)%tabSize:0):str=>str&&indentChar.repeat(tabSize-whitespaceEnd(str)%tabSize)+str),start1,end1,start,end)};inputCommandMap["<"]=(_e,selection,value)=>selfClose(selection,"<>",value,!0),selfClosePairs.forEach(([open,close])=>{let isQuote=open==close;inputCommandMap[open]=(_e,selection,value)=>(isQuote&&skipIfEqual(selection,close,value)||selfClose(selection,open+close,value))&&scroll(),isQuote||(inputCommandMap[close]=(_e,selection,value)=>skipIfEqual(selection,close,value)&&scroll())}),inputCommandMap[">"]=(e,selection,value)=>{let closingTag2=languageMap[getLanguage(editor)]?.autoCloseTags?.(selection,value,editor);closingTag2&&(insertText(editor,">"+closingTag2,null,null,selection[0]+1),preventDefault(e))},keyCommandMap.Tab=(e,[start,end],value)=>{if(ignoreTab||options.readOnly||getModifierCode(e)&6)return;let[indentChar,tabSize]=getIndent(options),shiftKey=e.shiftKey,[lines2,start1,end1]=getLines2(value,start,end);return start<end||shiftKey?indent(shiftKey,lines2,start1,end1,start,end,indentChar,tabSize):insertText(editor,indentChar.repeat(tabSize-(start-start1)%tabSize)),scroll()},keyCommandMap.Enter=(e,selection,value)=>{let code=getModifierCode(e)&7;if(!code||code==mod){code&&(selection[0]=selection[1]=getLines2(value,selection[1])[2]);let[indentChar,tabSize]=getIndent(options),[start,end]=selection,autoIndent=languageMap[getLanguage(editor)]?.autoIndent,indenationCount=Math.floor(whitespaceEnd(getLineBefore(value,start))/tabSize)*tabSize,extraIndent=autoIndent?.[0]?.(selection,value,editor)?tabSize:0,extraLine=autoIndent?.[1]?.(selection,value,editor),newText=`
`+indentChar.repeat(indenationCount+extraIndent)+(extraLine?`
`+indentChar.repeat(indenationCount):"");if(newText[1]||value[end])return insertText(editor,newText,start,end,start+indenationCount+extraIndent+1),scroll()}},keyCommandMap.Backspace=(_e,[start,end],value)=>{if(start==end){let currentLine=getLineBefore(value,start),[,tabSize]=getIndent(options),isPair=selfClosePairs.includes(value.slice(start-1,start+1)),indenationCount=currentLine.length%tabSize||tabSize;if(isPair||indenationCount!=1&&!/\S|^$/.test(currentLine))return insertText(editor,"",start-(isPair?1:indenationCount),start+ +isPair),scroll()}};for(let i=0;i<2;i++)keyCommandMap[i?"ArrowDown":"ArrowUp"]=(e,[start,end],value)=>{let code=getModifierCode(e);if((code&7)==1){if(code==1){let newStart=i?start:getLineStart(value,start)-1,newEnd=i?value.indexOf(`
`,end)+1:end;if(newStart>-1&&newEnd>0){let[lines2,start1,end1]=getLines2(value,newStart,newEnd),line=lines2[i?"pop":"shift"](),offset=(line.length+1)*(i?1:-1);lines2[i?"unshift":"push"](line),insertText(editor,lines2.join(`
`),start1,end1,start+offset,end+offset)}}else{let[lines2,start1,end1]=getLines2(value,start,end),str=lines2.join(`
`),offset=i?str.length+1:0;insertText(editor,str+`
`+str,start1,end1,start+offset,end+offset)}return scroll()}};addTextareaListener(editor,"keydown",e=>{let code=getModifierCode(e),keyCode=e.keyCode,[start,end,dir]=getSelection();if(code==mod&&(keyCode==221||keyCode==219))return indent(keyCode==219,...getLines2(editor.value,start,end),start,end,...getIndent(options)),scroll();if(code==(isMac?10:2)&&keyCode==77)setIgnoreTab(!ignoreTab),preventDefault(e);else if(keyCode==191&&code==mod||keyCode==65&&code==9){let value=editor.value,isBlock=code==9,position=isBlock?start:getLineStart(value,start),language=languageMap[getLanguage(editor,position)]||{},{line,block}=language.getComments?.(editor,position,value)||language.comments||{},[lines2,start1,end1]=getLines2(value,start,end),last=lines2.length-1;if(isBlock){if(block){let[open,close]=block,text=value.slice(start,end),pos=value.slice(0,start).search(regexEscape(open)+" ?$"),matches=RegExp("^ ?"+regexEscape(close)).test(value.slice(end));pos+1&&matches?insertText(editor,text,pos,end+ +(value[end]==" ")+close.length,pos,pos+end-start):insertText(editor,`${open} ${text} ${close}`,start,end,start+open.length+1,end+open.length+1),scroll()}}else if(line){let escaped=regexEscape(line),regex=RegExp(`^\\s*(${escaped} ?|$)`),regex2=RegExp(escaped+" ?"),allWhiteSpace=!/\S/.test(value.slice(start1,end1)),newLines=lines2.map(lines2.every(line2=>regex.test(line2))&&!allWhiteSpace?str=>str.replace(regex2,""):str=>allWhiteSpace||/\S/.test(str)?str.replace(/^\s*/,`$&${line} `):str);insertLines(lines2,newLines,start1,end1,start,end),scroll()}else if(block){let[open,close]=block,insertionPoint=whitespaceEnd(lines2[0]),hasComment=lines2[0].startsWith(open,insertionPoint)&&lines2[last].endsWith(close),newLines=lines2.slice();newLines[0]=lines2[0].replace(hasComment?RegExp(regexEscape(open)+" ?"):/(?=\S)|$/,hasComment?"":open+" ");let diff=newLines[0].length-lines2[0].length;newLines[last]=hasComment?newLines[last].replace(RegExp(`( ?${regexEscape(close)})?$`),""):newLines[last]+" "+close;let newText=newLines.join(`
`),firstInsersion=insertionPoint+start1,newStart=firstInsersion>start?start:Math.max(start+diff,firstInsersion),newEnd=firstInsersion>end-(start!=end)?end:Math.min(Math.max(firstInsersion,end+diff),start1+newText.length);insertText(editor,newText,start1,end1,newStart,Math.max(newStart,newEnd)),scroll()}}else if(code==8+mod&&keyCode==75){let value=editor.value,[lines2,start1,end1]=getLines2(value,start,end),column=dir=="forward"?end-end1+lines2.pop().length:start-start1,newLineLen=getLines2(value,end1+1)[0][0].length;return insertText(editor,"",start1-!!start1,end1+!start1,start1+Math.min(column,newLineLen)),scroll()}}),["copy","cut","paste"].forEach(type=>addTextareaListener(editor,type,e=>{let[start,end]=getSelection();if(start==end&&clipboard){let[[line],start1,end1]=getLines2(editor.value,start,end);type=="paste"?e.clipboardData.getData("text/plain")==prevCopy&&(insertText(editor,prevCopy+`
`,start1,start1,start+prevCopy.length+1),scroll(),preventDefault(e)):(clipboard.writeText(prevCopy=line),type=="cut"&&(insertText(editor,"",start1,end1+1),scroll()),preventDefault(e))}}))},editHistory=(historyLimit=999)=>{let sp=0,currentEditor,allowMerge,isTyping=!1,prevInputType,prevData,isMerge,textarea,getSelection,stack=[],update2=index=>{index>=historyLimit&&(index--,stack.shift()),stack.splice(sp=index,historyLimit,[currentEditor.value,getSelection(),getSelection()])},setEditorState=index=>{stack[index]&&(textarea.value=stack[index][0],textarea.setSelectionRange(...stack[index][index<sp?2:1]),currentEditor.update(),currentEditor.extensions.cursor?.scrollIntoView(),sp=index,allowMerge=!1)},self=(editor,options)=>{editor.extensions.history=self,currentEditor=editor,getSelection=editor.getSelection,textarea||update2(0),textarea=editor.textarea,editor.addListener("selectionChange",()=>{allowMerge=isTyping,isTyping=!1}),addTextareaListener(editor,"beforeinput",e=>{let data=e.data,inputType=e.inputType;/history/.test(inputType)?(setEditorState(sp+(inputType[7]=="U"?-1:1)),preventDefault(e)):(isMerge=allowMerge&&prevInputType==inputType&&e.isTrusted&&!data?.includes(`
`)&&(data!=" "||prevData==data))||(stack[sp][2]=prevSelection||getSelection()),isTyping=!0,prevData=data,prevInputType=inputType}),addTextareaListener(editor,"input",()=>update2(sp+!isMerge)),addTextareaListener(editor,"keydown",e=>{if(!options.readOnly){let code=getModifierCode(e),keyCode=e.keyCode,isUndo=code==mod&&keyCode==90,isRedo=code==mod+8&&keyCode==90||!isMac&&code==mod&&keyCode==89;isUndo?(setEditorState(sp-1),preventDefault(e)):isRedo&&(setEditorState(sp+1),preventDefault(e))}})};return self.clear=()=>{update2(0),allowMerge=!1},self.has=offset=>sp+offset in stack,self.go=offset=>setEditorState(sp+offset),self}}});var dist_exports={};__export(dist_exports,{createEditor:()=>createEditor,editorFromPlaceholder:()=>editorFromPlaceholder,isChrome:()=>isChrome,isMac:()=>isMac,isWebKit:()=>isWebKit,languageMap:()=>languageMap,numLines:()=>numLines});var init_dist=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/index.js"(){init_index_um6nVglX()}});var insertBefore,toString,init_language_WpXiUgDw=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/language-WpXiUgDw.js"(){insertBefore=(grammar,before,insert)=>{var temp={};for(var token in grammar)temp[token]=grammar[token],delete grammar[token];for(var token in temp)token==before&&Object.assign(grammar,insert),insert.hasOwnProperty(token)||(grammar[token]=temp[token])},toString={}.toString}});var string,stringSrc,atruleInside,init_css=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/prism/languages/css.js"(){init_index_EqkdgABH();string=/(?:"(?:\\[^]|[^\\\n"])*"|'(?:\\[^]|[^\\\n'])*')/g,stringSrc=string.source,atruleInside={rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}};atruleInside[rest]=languages.css={comment:/\/\*[^]*?\*\//,atrule:{pattern:RegExp(`@[\\w-](?:[^;{\\s"']|\\s+(?!\\s)|${stringSrc})*?(?:;|(?=\\s*\\{))`),inside:atruleInside},url:{pattern:RegExp(`\\burl\\((?:${stringSrc}|(?:[^\\\\
"')=]|\\\\[^])*)\\)`,"gi"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+stringSrc+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|${stringSrc})*(?=\\s*\\{)`),lookbehind:!0},string:{pattern:string,greedy:!0},property:{pattern:/(^|[^-\w\xa0-\uffff])(?!\d)(?:(?!\s)[-\w\xa0-\uffff])+(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z\d])[-a-z\d]+(?=\()/i,lookbehind:!0},punctuation:/[(){},:;]/}}});var css_extras_exports={};var css,unit,number,init_css_extras=__esm({"node_modules/.pnpm/prism-code-editor@3.2.0/node_modules/prism-code-editor/dist/prism/languages/css-extras.js"(){init_index_EqkdgABH();init_language_WpXiUgDw();init_css();css=languages.css,unit={pattern:/(\b\d+)(?:%|[a-z]+(?![\w-]))/,lookbehind:!0},number={pattern:/(^|[^\w.-])-?(?:\d+(?:\.\d+)?|\.\d+)/,lookbehind:!0};css.selector.inside=css.atrule.inside["selector-function-argument"].inside={"pseudo-element":/:(?:after|before|first-letter|first-line|selection)|::[-\w]+/,"pseudo-class":/:[-\w]+/,class:/\.[-\w]+/,id:/#[-\w]+/,attribute:{pattern:/\[(?:[^[\]"']|(["'])(?:\\[^]|(?!\1)[^\\\n])*\1)*\]/g,greedy:!0,inside:{punctuation:/^\[|\]$/,"case-sensitivity":{pattern:/(\s)[si]$/i,lookbehind:!0,alias:"keyword"},namespace:{pattern:/^(\s*)(?:(?!\s)[-*\w\xa0-\uffff])*\|(?!=)/,lookbehind:!0,inside:{punctuation:/\|$/}},"attr-name":{pattern:/^(\s*)(?:(?!\s)[-\w\xa0-\uffff])+/,lookbehind:!0},"attr-value":{pattern:/(=\s*)(?:(?!\s)[-\w\xa0-\uffff])+(?=\s*$)|(["'])(?:\\[^]|(?!\2)[^\\\n])*\2/,lookbehind:!0},operator:/[|~*^$]?=/}},"n-th":[{pattern:/(\(\s*)[+-]?\d*[\dn](?:\s*[+-]\s*\d+)?(?=\s*\))/,lookbehind:!0,inside:{number:/[\dn]+/,operator:/[+-]/}},{pattern:/(\(\s*)(?:even|odd)(?=\s*\))/i,lookbehind:!0}],combinator:/>|\+|~|\|\|/,punctuation:/[(),]/};insertBefore(css,"property",{variable:{pattern:/(^|[^-\w\xa0-\uffff])--(?!\d)(?:(?!\s)[-\w\xa0-\uffff])*/i,lookbehind:!0}});insertBefore(css,"function",{operator:{pattern:/(\s)[/*+-](?!\S)/,lookbehind:!0},hexcode:{pattern:/\B#[a-f\d]{3,8}\b/i,alias:"color"},color:[{pattern:/(^|[^\w-])(?:aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|(?:dark)?(?:blue|cyan|goldenrod|gr[ae]y|green|khaki|magenta|olivegreen|orange|orchid|red|salmon|seagreen|slateblue|slategr[ae]y|turquoise|violet)|deeppink|deepskyblue|dimgr[ae]y|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|greenyellow|honeydew|hotpink|indianred|indigo|ivory|lavender|lavenderblush|lawngreen|lemonchiffon|light(?:blue|coral|cyan|goldenrodyellow|gr[ae]y|green|pink|salmon|seagreen|skyblue|slategr[ae]y|steelblue|yellow)|lime|limegreen|linen|maroon|medium(?:aquamarine|blue|orchid|purple|seagreen|slateblue|springgreen|turquoise|violetred)|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orangered|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|rebeccapurple|rosybrown|royalblue|saddlebrown|sandybrown|seashell|sienna|silver|skyblue|snow|springgreen|steelblue|tan|teal|thistle|tomato|transparent|wheat|white|whitesmoke|yellow|yellowgreen)(?![\w-])/i,lookbehind:!0},{pattern:/\b(?:hsl|rgb)\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\)\B|\b(?:hsl|rgb)a\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*,\s*(?:0|0?\.\d+|1)\s*\)\B/i,inside:{function:/^[^(]+/,unit,number,punctuation:/[(),]/}}],entity:/\\[a-f\d]{1,8}/i,unit,number})}});var langs_default={en:"English",fr:"Fran\xE7ais",sk:"Slovensk\xFD",sv:"Svenska",pl:"Polski",pt_BR:"Portugu\xEAs (Brasil)",pt_PT:"Portugu\xEAs (Portugal)",nl:"Nederlandse",ro:"Rom\xE2n\u0103",ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",zh_CN:"\u7B80\u4F53\u4E2D\u6587",zh_HK:"\u7E41\u9AD4\u4E2D\u6587",jp:"\u65E5\u672C\u8A9E",de:"Deutsch",it:"Italiano",es_ES:"Espa\xF1ol",tr:"T\xFCrk\xE7e",uk:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",id:"Indonesia",da:"Dansk",fi:"Suomi",hu:"Magyar",sr:"\u0421\u0440\u043F\u0441\u043A\u0438 (\u045B\u0438\u0440\u0438\u043B\u0438\u0446\u0430)",sr_YU:"Srpski (latinica)",gr:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",fa:"\u0641\u0627\u0631\u0633\u06CC",vi:"Ti\u1EBFng Vi\u1EC7t",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"},subsets={ar:"arabic",sk:"latin-ext",pl:"latin-ext",ro:"latin-ext",ru:"cyrillic",zh_CN:"chinese-simplified",zh_HK:"chinese-traditional",tr:"latin-ext",uk:"cyrillic",hu:"latin-ext",sr:"cyrillic",gr:"greek",fa:"arabic",jp:"japanese",vi:"latin-ext"};var CURRENT_VERSION="19.2.0",MAIN_API="https://api.bonjourr.fr",FALLBACK_API=["https://bonjourr-apis.victr.workers.dev","https://bonjourr-apis.victrme.workers.dev"],ENVIRONNEMENT="PROD",SYSTEM_OS=window.navigator.appVersion.includes("Macintosh")?"mac":window.navigator.appVersion.includes("Windows")?"windows":window.navigator.userAgent.toLowerCase().includes("Android")?"android":["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document?"ios":"unknown",PLATFORM=window.location.protocol==="moz-extension:"?"firefox":window.location.protocol==="chrome-extension:"?"chrome":window.location.protocol==="safari-web-extension:"?"safari":"online",BROWSER=window.navigator.userAgent.toLowerCase().indexOf("edg/")>-1?"edge":window.navigator?.userAgentData?.brands.some(b=>b.brand==="Opera")?"opera":window.navigator?.userAgentData?.brands.some(b=>b.brand==="Chromium")?"chrome":window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1?"firefox":window.navigator.userAgent.toLowerCase().indexOf("safari")>-1?"safari":"other",IS_MOBILE=navigator.userAgentData?navigator.userAgentData.mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),DEFAULT_LANG=(()=>{for(let code of Object.keys(langs_default))if(navigator.language.replace("-","_").includes(code))return code;return"en"})(),SEARCHBAR_ENGINES=["google","ddg","startpage","qwant","yahoo","bing","brave","ecosia","lilo","baidu","custom"],SYNC_DEFAULT={about:{browser:PLATFORM,version:CURRENT_VERSION},showall:!1,lang:DEFAULT_LANG,dark:"system",favicon:"",tabtitle:"",greeting:"",pagegap:1,pagewidth:1600,time:!0,main:!0,dateformat:"eu",background_blur:15,background_bright:.8,background_type:"unsplash",quicklinks:!0,syncbookmarks:void 0,textShadow:.2,announcements:"major",review:0,css:"",hide:{},linkstyle:"large",linknewtab:!1,linksrow:6,linktabs:{active:!1,selected:0,titles:[""]},clock:{size:1,ampm:!1,analog:!1,seconds:!1,face:"none",style:"round",timezone:"auto"},unsplash:{every:"hour",collection:"",lastCollec:"day",pausedImage:void 0,time:void 0},weather:{ccode:void 0,city:void 0,unit:"metric",provider:"",moreinfo:"none",forecast:"auto",temperature:"actual",geolocation:"approximate"},notes:{on:!1,width:40,opacity:.1,align:"left"},searchbar:{on:!1,opacity:.1,newtab:!1,suggestions:!0,engine:"google",request:"",placeholder:""},quotes:{on:!1,author:!1,type:"classic",frequency:"day",last:1650516688},font:{family:"",size:"14",system:!0,weightlist:[],weight:SYSTEM_OS==="windows"?"400":"300"},move:{selection:"single",layouts:{single:{grid:[["time"],["main"],["quicklinks"]],items:{}},double:{grid:[["time","."],["main","."],["quicklinks","."]],items:{}},triple:{grid:[[".","time","."],[".","main","."],[".","quicklinks","."]],items:{}}}}},LOCAL_DEFAULT={userQuoteSelection:0,translations:void 0,selectedId:"",idsList:[],quotesCache:[],unsplashCache:{noon:[],day:[],evening:[],night:[],user:[]}};function parse(str=""){try{return JSON.parse(str)}catch(error){str!==""&&console.warn("Issue in parsing: ",error)}}function verifyDataAsSync(data){data=data??{};for(let key in SYNC_DEFAULT)key in data||(data[key]=SYNC_DEFAULT[key]);return data}function verifyDataAsLocal(data){data=data??{};for(let key in LOCAL_DEFAULT)key in data||(data[key]=LOCAL_DEFAULT[key]);return data}async function getSyncDefaults(){try{let json=await(await fetch("defaults.json")).json();return verifyDataAsSync(json)}catch{console.log("No defaults.json settings found")}return SYNC_DEFAULT}function online(){let sync={set:function(value){if(typeof value!="object")return console.warn("Value is not an object: ",value);let data=verifyDataAsSync(parse(localStorage.bonjourr)??{});for(let[key,val]of Object.entries(value))data[key]=val;localStorage.bonjourr=JSON.stringify(data??{}),window.dispatchEvent(new Event("storage"))},get:async _=>verifyDataAsSync(parse(localStorage.bonjourr)??{}),remove:key=>{let data=verifyDataAsSync(parse(localStorage.bonjourr)??{});delete data[key],localStorage.bonjourr=JSON.stringify(data??{})},clear:()=>{localStorage.removeItem("bonjourr")}},local={set:value=>{let[key,val]=Object.entries(value)[0];return localStorage.setItem(key,JSON.stringify(val))},get:async keys=>{let res={};keys===void 0?keys=[...Object.keys(localStorage).filter(k=>k!=="bonjourr")]:typeof keys=="string"&&(keys=[keys]);for(let key of keys){let item=localStorage.getItem(key)??"",val=item.startsWith("{")||item.startsWith("[")?parse(item):item;val&&(res[key]=val)}return res},remove:key=>localStorage.removeItem(key),clear:()=>{for(let key of Object.keys(LOCAL_DEFAULT))localStorage.removeItem(key)}};return{sync,local,init:async()=>({sync:verifyDataAsSync(await sync.get()),local:verifyDataAsLocal(await local.get())})}}function webext(){return{sync:{set:(val,cb=()=>{})=>{chrome.storage.sync.set(val,cb)},get:async key=>{let data=await chrome.storage.sync.get(key??null);return verifyDataAsSync(data)},remove:key=>{chrome.storage.sync.remove(key)},clear:()=>{chrome.storage.sync.clear()}},local:{set:val=>{chrome.storage.local.set(val)},get:async key=>await chrome.storage.local.get(key??null),remove:key=>chrome.storage.local.remove(key),clear:()=>{chrome.storage.local.clear()}},init:async()=>{let store=startupStorage,isReady=()=>"sync"in store&&"local"in store;isReady()||await new Promise(resolve2=>{document.addEventListener("webextstorage",function(){isReady()&&resolve2(!0)})});let sync2=verifyDataAsSync(store.sync),local2=verifyDataAsLocal(store.local);return startupStorage=void 0,{sync:sync2,local:local2}}}}var storage_default=PLATFORM==="online"?online():webext();var trns,currentTrnsLang="en";async function setTranslationCache(lang,local,isUpdate){if(lang==="en"){storage_default.local.remove("translations"),trns=void 0;return}let cachedLang=local?.translations?.lang;!isUpdate&&local&&cachedLang===lang?trns=local.translations:(trns=await(await fetch(`../../_locales/${lang}/translations.json`)).json(),storage_default.local.set({translations:trns})),currentTrnsLang=lang}function traduction(settingsDom,lang="en"){if(lang!=="en"){if(trns){let tags=(settingsDom||document.body).querySelectorAll(".trn"),text;for(let tag of tags)text=tag.textContent??"",tag.textContent=trns[text]??text}document.documentElement.setAttribute("lang",lang),currentTrnsLang=lang}}async function toggleTraduction(lang){let tags=document.querySelectorAll(".trn"),newDict,toggleDict={},currentDict={...trns},text;await setTranslationCache(lang),newDict=(await storage_default.local.get("translations")).translations,newDict&&currentDict?.lang===void 0&&Object.keys(newDict).forEach(key=>currentDict[key]=key);for(let[key,val]of Object.entries(currentDict))lang==="en"?toggleDict[val]=key:newDict&&(toggleDict[val]=newDict[key]);for(let tag of tags)text=tag.textContent??"",tag.textContent=toggleDict[text]??text;currentTrnsLang=lang}function getLang(){return currentTrnsLang}function tradThis(str){return trns?trns[str]??str:str}function debounce(callback,waitFor){let timeout,debounced=(...args)=>{clearTimeout(timeout),timeout=setTimeout(()=>callback(...args),waitFor)};return debounced.cancel=()=>clearTimeout(timeout),debounced}var eventDebounce=debounce(function(value){storage_default.sync.set(value)},400);var callbackList=[],areSettingsLoaded=!1;function onSettingsLoad(callback){areSettingsLoaded?callback():callbackList.push(callback)}function loadCallbacks(){for(let i=0;i<callbackList.length;i++)callbackList[i]();areSettingsLoaded=!0}var lines,getLine={all:getLines,selected:getSelectedLines,next:getNextLine,previous:getPrevLine,fromEditable:getLineFromEditable,init:initLinesObserver},getLines_default=getLine;function initLinesObserver(container2){let lineObserverCallback=()=>{lines=Object.values(container2.querySelectorAll(".line"))};new MutationObserver(lineObserverCallback).observe(container2,{childList:!0})}function getLines(){return lines}function getSelectedLines(){return lines.filter(line=>line.classList.contains("sel"))??[]}function getPrevLine(line){return lines[lines.indexOf(line)-1]}function getNextLine(line){return lines[lines.indexOf(line)+1]}function getLineFromEditable(elem){for(;elem?.parentElement;){if(elem.parentElement.classList.contains("line"))return elem.parentElement;elem=elem.parentElement}return null}function lastTextNode(line){let lastNode=line;for(;lastNode?.childNodes.length>0;){let childNodes=Object.values(lastNode.childNodes).reverse(),textNodes=childNodes.filter(child=>child.nodeName==="#text");if(textNodes.length>0)return textNodes[0];lastNode=childNodes[0]}return lastNode}function setCaret(elem,atStart){let node=lastTextNode(elem),sel=window.getSelection(),range=document.createRange(),textlen=node.nodeValue?.length||0;range.setStart(node,atStart?0:textlen),range.setEnd(node,atStart?0:textlen),sel?.removeAllRanges(),sel?.addRange(range),sel?.collapseToEnd()}function lineTransform(editable,mod2,focus=!0){if(!mod2)return;let line=getLines_default.fromEditable(editable);if(!line||line?.className.includes(mod2))return;switch(line.className="line",line.querySelector("span.list-dot")?.remove(),line.querySelector("span.todo-marker")?.remove(),mod2){case"h1":case"h2":case"h3":toHeading(mod2);break;case"list":toList();break;case"todo":toTodolist(!1);break;case"todo-checked":toTodolist(!0);break}function toHeading(tag){let heading=document.createElement(tag),mod22=tag==="h1"?"#":tag==="h2"?"##":"###";heading.textContent=editable.textContent?.replace(mod22,"").trimStart()||"",heading.setAttribute("contenteditable","true"),line&&(line.className="line "+tag,editable.replaceWith(heading)),focus&&setCaret(heading)}function toTodolist(checked){let input=document.createElement("input"),span=document.createElement("span"),p=document.createElement("p"),line2=getLines_default.fromEditable(editable),content=editable.textContent??"";!line2||line2.className.includes("todo")||((content.startsWith("[ ]")||content.startsWith("[x]"))&&(content=content.slice(4,content.length)),input.type="checkbox",input.name="checkbox",input.setAttribute("aria-label","todo list checkbox"),input.addEventListener("input",()=>{line2.classList.toggle("todo-checked",input.checked),line2.classList.toggle("todo",!input.checked),input.checked?input.setAttribute("checked",""):input.removeAttribute("checked")}),checked&&input.setAttribute("checked",""),line2.className="line todo"+(checked?"-checked":""),span.className="todo-marker",p.textContent=content,p.setAttribute("contenteditable","true"),editable.replaceWith(p),span.appendChild(input),line2.prepend(span),focus&&setCaret(p))}function toList(){let span=document.createElement("span"),p=document.createElement("p"),content=editable.textContent??"";!line||line.className.includes("list")||(content.startsWith("-")&&(content=content?.replace("-","").trimStart()),span.dataset.content="\u2022",span.className="list-dot",line.className="line list",p.textContent=content,p.setAttribute("contenteditable","true"),editable.replaceWith(p),line.prepend(span),focus&&setCaret(p))}}var modList={h1:"#",h2:"##",h3:"###",list:"-",todo:"[ ]","todo-checked":"[x]"},modList_default=modList;function generateLine(props){let notesline=document.createElement("div"),editable=document.createElement("p"),mod2=props?.modif??"";return editable.setAttribute("contenteditable","true"),notesline.classList.add("line"),notesline.appendChild(editable),typeof props?.text=="string"&&(editable.textContent=props.text),mod2 in modList_default&&lineTransform(editable,mod2,!1),notesline}function checkModifs(text){for(let[name,str]of Object.entries(modList_default))if(text.startsWith(str+" "))return name;return""}function toHTML(markdown){let fragment=document.createDocumentFragment();markdown=markdown.replaceAll("	","");for(let line of markdown.split(`

`)){if(line.indexOf(`
`)===-1){fragment.appendChild(generateLine({text:line,modif:checkModifs(line)}));continue}for(let subline of line.split(`
`))fragment.appendChild(generateLine({text:subline,modif:checkModifs(subline)}))}return fragment}function toMarkdown(lines2){function addModif(line){return line.classList.contains("list")?"- ":line.classList.contains("h1")?"# ":line.classList.contains("h2")?"## ":line.classList.contains("h3")?"### ":line.classList.contains("todo")?"[ ] ":line.classList.contains("todo-checked")?"[x] ":""}let plaintext="",modif="",isList=line=>line?.classList.contains("list")||line?.classList.contains("todo");return lines2.forEach((line,i)=>{modif=addModif(line),plaintext+=modif+line.textContent;let isWithinList=isList(lines2[i+1])&&isList(line),isLastLine=lines2.length-1===i;plaintext+=isLastLine?"":isWithinList?`
`:`

`}),plaintext}var pocketEditorContainer;function setContainer(elem){return pocketEditorContainer=elem,elem}function getContainer(){return pocketEditorContainer??document.getElementById("pocket-editor")}function insertAfter(newNode,existingNode){existingNode?.parentNode?.insertBefore(newNode,existingNode.nextSibling)}function removeLines(lines2){let container2=getContainer(),emptyLine=generateLine(),prevline=getLines_default.previous(lines2[0]);lines2.forEach(line=>line.remove()),prevline?insertAfter(emptyLine,prevline):container2.prepend(emptyLine),setCaret(emptyLine),container2.dispatchEvent(new InputEvent("input",{inputType:"deleteContent",bubbles:!0,data:""}))}var history=[];function addUndoHistory(lastline){let lines2=getLines_default.all(),markdown=toMarkdown(lines2),index=lastline?lines2.indexOf(lastline):0;markdown!==history[0]?.markdown&&(history.unshift({markdown,index}),history.length>50&&history.pop())}function initUndo(){let container2=getContainer(),timeout;new MutationObserver(()=>{timeout&&clearTimeout(timeout)}).observe(container2,{characterData:!0,subtree:!0}),container2.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="z"&&(timeout=window.setTimeout(()=>{applyUndo()},1))})}function applyUndo(){let container2=getContainer(),{markdown,index}=history[0]??{};markdown&&(Object.values(container2.children).forEach(node=>node.remove()),container2.appendChild(toHTML(markdown)),setTimeout(()=>{let editable=container2.querySelectorAll("[contenteditable]")[index];editable&&(editable.focus(),setCaret(editable,!1))},0),history.shift(),container2.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""})))}function copyEvent(e){let selected=getLines_default.selected();selected.length>0&&(e.clipboardData?.setData("text/plain",toMarkdown(selected)),e.preventDefault())}function cutEvent(e){let selected=getLines_default.selected();selected.length>0&&(e.clipboardData?.setData("text/plain",toMarkdown(selected)),e.preventDefault(),removeLines(selected),addUndoHistory(selected[selected.length-1]))}function pasteEvent(e){e.preventDefault();let container2=getContainer(),selection=window.getSelection(),range=selection?.getRangeAt(0),text=e.clipboardData?.getData("text")||"";if(checkModifs(text)!==""){let editable=e.target,newHTML=toHTML(text),linesInNew=newHTML.childElementCount-1,line=getLines_default.fromEditable(editable),selected=getLines_default.selected();if(selected.length>0&&(line=selected[selected.length-1]),!line?.classList.contains("line"))return;container2.insertBefore(newHTML,getLines_default.next(line));let lastline=line.nextSibling;for(let ii=0;ii<linesInNew;ii++)lastline&&(lastline=lastline.nextSibling);if(lastline&&setCaret(lastline),line&&line.textContent===""){let areSameMods=mod2=>{let curr=line?.classList,next=getLines_default.next(line)?.classList;return curr?.contains(mod2)===next?.contains(mod2)};(line.classList.length>1||areSameMods("list")||areSameMods("todo")||areSameMods("todo-checked"))&&line.remove()}container2.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""}));return}if(selection?.rangeCount&&range){let offset=selection?.anchorOffset??0,value=selection.focusNode?.nodeValue??"";value&&selection.focusNode?(selection.focusNode.nodeValue=value.slice(0,offset)+text+value.slice(offset),selection.collapse(selection.focusNode,offset+text.length)):(range.insertNode(document.createTextNode(text)),setCaret(range.endContainer))}container2.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""}))}function removeModifier(editable){let content=document.createElement("div"),parent=editable.parentElement;parent&&(parent.className="line",content.textContent=parent.textContent,content.setAttribute("contenteditable","true"),Object.values(parent.childNodes).forEach(node=>node.remove()),parent.appendChild(content),content.focus())}function paragraphControl(e){let container2=getContainer(),editable=e.target,range;try{let isContenteditable=editable?.hasAttribute("contenteditable"),isInput=editable?.tagName==="INPUT";if(range=window.getSelection()?.getRangeAt(0),!range||!isContenteditable||isInput)throw""}catch{return}let line=getLines_default.fromEditable(editable),insertParagraph=e?.inputType==="insertParagraph",insertText2=e?.inputType==="insertText",modif;if(e.type==="beforeinput"&&insertParagraph&&line){e.preventDefault(),addUndoHistory(line);let cuttext=(editable.textContent??"").slice(0,range.startOffset),nexttext=(editable.textContent??"").slice(range.startOffset);if(range.startOffset===0&&line?.classList?.length>1){removeModifier(editable);return}line?.classList.contains("todo")&&(modif="todo"),line?.classList.contains("list")&&(modif="list"),line?.classList.contains("todo-checked")&&(modif="todo");let nextline=getLines_default.next(line),newline=generateLine({text:nexttext,modif});nextline?container2.insertBefore(newline,nextline):container2?.appendChild(newline),newline.querySelector("[contenteditable]")?.focus(),editable.textContent=cuttext,container2.dispatchEvent(new InputEvent("input",{inputType:"insertText",bubbles:!0,data:""}));return}if(e.type==="input"&&insertText2){let content=editable?.textContent??"";for(let[mod2,val]of Object.entries(modList_default))(content.startsWith(val+" ")||content.startsWith(val+"\xA0"))&&(modif=mod2,lineTransform(editable,modif))}}function detectLineJump(e){if(!e.key.includes("Arrow")||!window.getSelection()?.anchorNode)return;let editable=e.target,line=getLines_default.fromEditable(editable),range=window?.getSelection()?.getRangeAt(0),txtLen=range?.startContainer?.nodeValue?.length??0;if(!range||!line)return;let prevSibling=getLines_default.previous(line),nextSibling=getLines_default.next(line),isCaretAtZero=Math.min(range?.endOffset,range?.startOffset)===0,isCaretAtEnd=Math.max(range?.endOffset,range?.startOffset)===txtLen;if(e.key==="ArrowLeft"&&isCaretAtZero&&prevSibling)return{line,dir:"up"};if(e.key==="ArrowRight"&&isCaretAtEnd&&nextSibling)return{line,dir:"down"};let top=!1,bottom=!1,rr=range?.getBoundingClientRect(),lr=line?.getBoundingClientRect();if(!lr||!rr||rr.y===0?(top=!0,bottom=!0):(top=lr.top-rr.top+rr.height>0,bottom=rr.bottom+rr.height-lr.bottom>0),e.key==="ArrowUp"&&prevSibling&&top)return{line,dir:"up"};if(e.key==="ArrowDown"&&nextSibling&&bottom)return{line,dir:"down"}}function lineSelection(container2){let lines2=getLines_default.all(),caretSelTimeout,lineInterval=[-1,-1],currentLine=-1,firstLine=-1;function caretSelectionDebounce(callback){clearTimeout(caretSelTimeout),caretSelTimeout=window.setTimeout(()=>{callback()},200)}function createRange(selected){if(selected||(selected=getLines_default.selected()),selected.length===0)return;document.querySelector("#pocket-editor-mock-sel")?.remove();let mockSelection=document.createElement("pre");mockSelection.id="pocket-editor-mock-sel",mockSelection.textContent="mock-selection",mockSelection.setAttribute("contenteditable","true"),container2.appendChild(mockSelection);let sel=window.getSelection(),range=document.createRange(),textlen=mockSelection.childNodes[0].nodeValue?.length||0;range.setStart(mockSelection.childNodes[0],0),range.setEnd(mockSelection.childNodes[0],textlen),sel?.removeAllRanges(),sel?.addRange(range)}function getLineIndex(editable){let line=getLines_default.fromEditable(editable);return line?lines2.indexOf(line):-1}function resetLineSelection(){let line=lines2[currentLine];line?.querySelector("[contenteditable]")&&setCaret(line),currentLine=-1,firstLine=-1,lineInterval=[-1,-1],document.querySelector("#pocket-editor-mock-sel")?.remove(),container2.removeEventListener("mousemove",mouseMoveEvent)}function addToLineSelection(index){index>firstLine&&(lineInterval[1]=index),index<firstLine&&(lineInterval[0]=index),index===firstLine&&(lineInterval=[index,index])}function changeLineSelection(index){firstLine=index,lineInterval=[index,index]}function applyLineSelection(interval){lines2.forEach((line,i)=>{i>=interval[0]&&i<=interval[1]?line.classList.add("sel"):line.classList.remove("sel")}),caretSelectionDebounce(()=>createRange())}function initLineSelection(index){currentLine=firstLine=index,lineInterval=[index,index]}function keyboardEvent(e){lines2=getLines_default.all();let selected=getLines_default.selected(),isClipboardKey=e.key.match(/([x|c|v])/g),isCtrlKey=e.key==="Control"||e.key==="Meta",noSelection=selected.length>0,ctrl=e.ctrlKey||e.metaKey;if(isCtrlKey||ctrl&&isClipboardKey&&noSelection)return;if(ctrl&&e.key==="a"){window.getSelection()?.removeAllRanges(),currentLine=firstLine=0,lineInterval=[0,lines2.length-1],applyLineSelection(lineInterval),e.preventDefault();return}if(noSelection){if(window.getSelection()?.removeAllRanges(),e.key==="Escape"||e.key==="Tab"){resetLineSelection(),applyLineSelection(lineInterval),e.preventDefault();return}if(e.key.includes("Arrow")){e.key.includes("Down")&&(currentLine=Math.min(currentLine+1,lines2.length-1)),e.key.includes("Up")&&(currentLine=Math.max(0,currentLine-1)),e.shiftKey&&addToLineSelection(currentLine),e.shiftKey||changeLineSelection(currentLine),applyLineSelection(lineInterval),e.preventDefault();return}e.code.match(/Shift|Alt|Control|Caps/)||(resetLineSelection(),addUndoHistory(selected[selected.length- -1]),removeLines(selected),e.code==="Enter"&&e.preventDefault())}if(!e.shiftKey)return;let{line}=detectLineJump(e)??{};if(line){let index=lines2.indexOf(line);initLineSelection(index),applyLineSelection(lineInterval),window.getSelection()?.removeAllRanges()}}function mouseMoveEvent(e){let target=e.target,selected=getLines_default.selected();selected.length>0&&window.getSelection()?.removeAllRanges();let isCheckbox=target.getAttribute("aria-label")==="todo list checkbox",isListMarker=target.className.includes("list-dot"),isEditable=!!target.getAttribute("contenteditable");if(isCheckbox||isListMarker||isEditable){if(currentLine=getLineIndex(target),currentLine===firstLine&&selected.length===0)return;addToLineSelection(currentLine),applyLineSelection(lineInterval)}}function mouseDownEvent(e){let target=e.target;lines2=getLines_default.all(),e.button===2&&e.preventDefault(),e.button===0&&(resetLineSelection(),applyLineSelection(lineInterval),target.getAttribute("contenteditable")&&(initLineSelection(getLineIndex(target)),container2.addEventListener("mousemove",mouseMoveEvent)))}function mouseClickEvent(e){!e.composedPath().includes(container2)&&(lines2=getLines_default.all(),resetLineSelection(),applyLineSelection(lineInterval)),container2.removeEventListener("mousemove",mouseMoveEvent)}window.addEventListener("touchend",mouseClickEvent),window.addEventListener("click",mouseClickEvent),container2.addEventListener("keydown",keyboardEvent),container2.addEventListener("mousedown",mouseDownEvent)}function removeLineNoText(editable,prevline){setCaret(prevline),editable.parentElement?.remove()}function removeLineWithText(editable,prevLine){let node=lastTextNode(prevLine),isTextNode=node.nodeType===3,charAmount=node.nodeValue?.length||0,targetText=editable?.textContent||"";node[isTextNode?"nodeValue":"textContent"]+=targetText;let selection=window.getSelection(),range=document.createRange();range.setStart(node,isTextNode?charAmount:0),range.setEnd(node,isTextNode?charAmount:0),selection?.removeAllRanges(),selection?.addRange(range),editable.parentElement.remove()}function lineDeletion(){let userAgent2=navigator.userAgent.toLowerCase(),container2=getContainer(),sel=window.getSelection();function applyLineRemove(e){let editable=e.target,line=getLines_default.fromEditable(editable),isEditable=!!editable.getAttribute("contenteditable"),isAtStart=sel?.getRangeAt(0)?.endOffset===0,isDelEvent=e.inputType==="deleteContentBackward";if(e.type==="beforeinput"&&!isDelEvent||!isAtStart||!isEditable)return;if(e.preventDefault(),line&&addUndoHistory(line),line?.classList.length>1){removeModifier(editable);return}let prevline=getLines_default.previous(line);prevline&&(editable.textContent===""&&removeLineNoText(editable,prevline),editable.textContent!==""&&removeLineWithText(editable,prevline))}if(container2.addEventListener("beforeinput",applyLineRemove),userAgent2.includes("safari")&&!userAgent2.match(/chrome|chromium/)&&container2.addEventListener("keydown",e=>{try{let range=sel?.getRangeAt(0),isBackspacing=e.key==="Backspace",isAtContainerStart=range?.startOffset===0;isBackspacing&&isAtContainerStart&&applyLineRemove(e)}catch{}}),"ontouchstart"in window||navigator.maxTouchPoints>0){let touchDeleteDebounce,inputEventPrevents=!1;container2.addEventListener("input",()=>inputEventPrevents=!0),container2.addEventListener("keyup",function(ev){if(inputEventPrevents||ev?.key!=="Unidentified"||sel?.getRangeAt(0)?.endOffset!==0){clearTimeout(touchDeleteDebounce),inputEventPrevents=!1;return}touchDeleteDebounce=window.setTimeout(()=>applyLineRemove(ev),5)})}}function caretControl(container2){let averageCharWidth=0;function initAverageCharWidth(){let p=document.createElement("p"),span=document.createElement("span");p.id="pocket-editor-mock-p",span.textContent="abcdefghijklmnopqrstuvwxyz",p?.appendChild(span),container2.querySelector(".line [contenteditable]")?.appendChild(p),averageCharWidth=span.offsetWidth/26/2,p.remove()}function rangePosInCharLen(line,str){let sel=window.getSelection(),editable=line?.querySelector("[contenteditable]"),cx=editable?.getBoundingClientRect().x??0,ox=(sel?.getRangeAt(0)?.cloneRange()?.getBoundingClientRect().x??0)-cx,charCount=-1,textnode=lastTextNode(editable),range=document.createRange();range.setStart(textnode,0),range.setEnd(textnode,0);let rangeX=0;for(let i=0;i<str.length-1;i++){try{range.setStart(textnode,i),range.setEnd(textnode,i)}catch{break}if(rangeX=range.getBoundingClientRect().x-cx,rangeX+averageCharWidth>=ox){charCount=i;break}}return charCount}function getParagraphAsArray(line){let editable=line?.querySelector("[contenteditable]");if(!editable)return console.warn("Couldn't get string[], no contenteditable found"),[];let pos=0,rangeY=0,rangeYlast=0,lines2=[""],words=(editable.textContent??"").split(" "),textnode=lastTextNode(editable),range=document.createRange();range.setStart(textnode,0),range.setEnd(textnode,0);let isWebkit=navigator.userAgent.includes("AppleWebKit");rangeYlast=rangeY=range.getBoundingClientRect().y;for(let word of words){word=word+" ",pos+=word.length;try{range.setStart(textnode,pos),range.setEnd(textnode,pos),rangeY=range.getBoundingClientRect().y}catch{}isWebkit&&(lines2[0]+=word),rangeY>rangeYlast&&(isWebkit&&(lines2[0]=lines2[0].trimEnd()),lines2.unshift(""),rangeYlast=rangeY),isWebkit===!1&&(lines2[0]+=word)}return lines2.reverse(),lines2}container2.addEventListener("keydown",function(e){let{line,dir}=detectLineJump(e)??{};if(!line)return;let goesRight=e.key==="ArrowRight",goesLeft=e.key==="ArrowLeft",sel=window.getSelection(),range=document.createRange(),offset=0,node;if(averageCharWidth===0&&initAverageCharWidth(),dir==="down"){let nextline=getLines_default.next(line)??line;node=lastTextNode(nextline);let textlen=node.nodeValue?.length||0;if(!goesRight){let rows=getParagraphAsArray(nextline);offset=rangePosInCharLen(nextline,rows[0])??-1,offset<0&&(offset=textlen)}}if(dir==="up"){let prevline=getLines_default.previous(line)??line;node=lastTextNode(prevline);let textlen=node.nodeValue?.length||0;if(offset=textlen,!goesLeft){let rows=getParagraphAsArray(prevline),lastrow=rows[rows.length-1].trimEnd(),lastrowOffset=rangePosInCharLen(prevline,lastrow)??textlen;offset=textlen-(lastrow.length-lastrowOffset),lastrowOffset<0&&(offset=textlen)}}try{range.setStart(node,offset),range.setEnd(node,offset),sel?.removeAllRanges(),sel?.addRange(range),sel?.collapseToEnd(),e.preventDefault()}catch{console.warn("Cannot set caret")}})}async function keybindings(e){let editable=e.target;if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.code.includes("Digit")&&editable){let index=parseInt(e.code.replace("Digit",""))-1,targetMod=Object.keys(modList_default)[index];if(index===5){e.preventDefault(),removeModifier(editable);return}targetMod in modList_default&&targetMod!=="todo-checked"&&(e.preventDefault(),lineTransform(editable,targetMod))}}function pocketEditor(id,init){let container2=setContainer(document.createElement("div"));if(container2.id="pocket-editor",getLines_default.init(container2),container2.appendChild(init?toHTML(init):generateLine({text:""})),document.getElementById(id)?.appendChild(container2),queueMicrotask(()=>{container2.addEventListener("beforeinput",paragraphControl),container2.addEventListener("input",paragraphControl),container2.addEventListener("keydown",keybindings),container2.addEventListener("paste",pasteEvent),container2.addEventListener("copy",copyEvent),container2.addEventListener("cut",cutEvent),lineSelection(container2),caretControl(container2),lineDeletion(),initUndo()}),document.getElementById(id)===null)throw'Pocket editor: id "'+id+'" was not found';return{get:pocketeditor_get,set:pocketeditor_set,oninput:pocketeditor_oninput}}function pocketeditor_get(){return toMarkdown(getLines_default.all())}function pocketeditor_set(text){let container2=getContainer();Object.values(container2.children).forEach(node=>node.remove()),container2.appendChild(toHTML(text))}function pocketeditor_oninput(callback){let container2=getContainer();return container2.addEventListener("cut",cb),container2.addEventListener("paste",cb),container2.addEventListener("input",cb),container2.addEventListener("beforeinput",cb),()=>{container2.removeEventListener("cut",cb),container2.removeEventListener("paste",cb),container2.removeEventListener("input",cb),container2.removeEventListener("beforeinput",cb)};function cb(e){e.type==="beforeinput"&&!e.inputType.match(/(deleteContentBackward|insertParagraph)/g)||callback(pocketeditor_get())}}var container=document.getElementById("notes_container");function notes(init,event){if(event){updateNotes(event);return}init&&(init.on?initNotes(init):onSettingsLoad(()=>initNotes(init)))}async function updateNotes(event){let notes2=(await storage_default.sync.get("notes"))?.notes;notes2&&(event?.text!==void 0&&(notes2.text=event.text),event?.align!==void 0&&(notes2.align=event.align,handleAlign(notes2.align)),event?.width!==void 0&&(notes2.width=parseInt(event.width),handleWidth(notes2.width)),event?.opacity!==void 0&&(notes2.opacity=parseFloat(event.opacity),handleOpacity(notes2.opacity)),eventDebounce({notes:notes2}))}function initNotes(init){document.getElementById("pocket-editor")?.remove(),handleAlign(init.align),handleWidth(init.width),handleOpacity(init.opacity),handleToggle(init.on),init.text=init.text??translateNotesText(),pocketEditor("notes_container",init.text).oninput(content=>{updateNotes({text:content})})}function handleToggle(state){container?.classList.toggle("hidden",!state)}function handleAlign(value){container?.classList.toggle("center-align",value==="center"),container?.classList.toggle("right-align",value==="right")}function handleWidth(value){value&&document.documentElement.style.setProperty("--notes-width",value.toString()+"em")}function handleOpacity(value){container&&(container?.classList.toggle("opaque",value>.45),document.documentElement.style.setProperty("--notes-background-alpha",value.toString()))}function translateNotesText(){let lang=getLang();lang&&lang in langs_default||(lang="en");let line1=tradThis("Edit this note"),line2=tradThis("With markdown titles, lists, and checkboxes"),line3=tradThis("Learn more on <url>");return`## ${line1} !

[ ] ${line2}

[ ] ${line3.replace("<url>","https://bonjourr.fr/docs/overview")}`}async function errorMessage(error){let dominterface3=document.getElementById("interface");console.error(error);function reduceErrorStack(){try{let lines2=(error.stack||"").split(`
`);return lines2.forEach((line,i)=>{let start=line.indexOf(" ("),end=line.indexOf("main.js");start>0&&end>0&&(lines2[i]=line.replace(line.substring(start+1,end),"").replace(")",""))}),lines2.join(`
`)}catch{return"No error stack found"}}function displayMessage(dataStr){let warning=document.createElement("div"),title=document.createElement("h1"),subtitle=document.createElement("p"),errorpre=document.createElement("pre"),storagetext=document.createElement("textarea"),explain=document.createElement("p"),resetButton=document.createElement("button"),closeError=document.createElement("button"),buttonWrap=document.createElement("div");title.textContent="Oops Bonjourr failed \u{1F616}",subtitle.textContent="Copy the error and your settings below and contact us !",explain.textContent="Sharing your settings with us helps a lot in debugging. You can also reset Bonjourr, or close this window for now if you think it is a false alert.",explain.className="error-explain",errorpre.textContent=reduceErrorStack(),storagetext.textContent=dataStr,storagetext.setAttribute("spellcheck","false"),resetButton.textContent="Reset Bonjourr",resetButton.addEventListener("click",()=>{warning.style.opacity="0",storage_default.sync.clear(),localStorage.clear()}),closeError.className="error-buttons-close",closeError.textContent="Close this window",closeError.addEventListener("click",()=>{sessionStorage.errorMessage="removed",warning.style.opacity="0",setTimeout(()=>warning.style.display="none",400)}),buttonWrap.className="error-buttons",buttonWrap.appendChild(resetButton),buttonWrap.appendChild(closeError),warning.appendChild(title),warning.appendChild(subtitle),warning.appendChild(errorpre),warning.appendChild(storagetext),warning.appendChild(explain),warning.appendChild(buttonWrap),warning.id="error",document.body.prepend(warning),dominterface3&&(dominterface3.style.opacity="1"),setTimeout(()=>warning.style.opacity="1",20)}if(sessionStorage.errorMessage==="removed"&&dominterface3)return dominterface3.style.opacity="1",!1;try{let data=await storage_default.sync.get();document.querySelector("#error")?.remove(),displayMessage(JSON.stringify(data,null,4))}catch{displayMessage("")}}var oneInFiveRandom=Math.random()>.8?1:0,clockInterval;function clock(init,event){if(event){clockUpdate(event);return}let clock2=init?.clock??{...SYNC_DEFAULT.clock};try{startClock(clock2,init?.greeting||"",init?.dateformat||"eu"),clockDate(zonedDate(clock2.timezone),init?.dateformat||"eu"),greetings(zonedDate(clock2.timezone),init?.greeting||""),analogFace(clock2.face),analogStyle(clock2.style),clockSize(clock2.size),displayInterface("clock")}catch(e){errorMessage(e)}}async function clockUpdate({ampm,analog:analog2,seconds,dateformat,greeting,timezone,style,face,size}){let data=await storage_default.sync.get(["clock","dateformat","greeting"]),clock2=data?.clock;!clock2||data.dateformat===void 0||data.greeting===void 0||(analog2!==void 0&&(document.getElementById("analog_options")?.classList.toggle("shown",analog2),document.getElementById("digital_options")?.classList.toggle("shown",!analog2)),isDateFormat(dateformat)&&(clockDate(zonedDate(clock2.timezone),dateformat),storage_default.sync.set({dateformat})),greeting!==void 0&&(greetings(zonedDate(clock2.timezone),greeting),storage_default.sync.set({greeting})),timezone!==void 0&&(clockDate(zonedDate(timezone),data.dateformat),greetings(zonedDate(timezone),data.greeting)),clock2={...clock2,ampm:ampm??clock2.ampm,size:size??clock2.size,analog:analog2??clock2.analog,seconds:seconds??clock2.seconds,timezone:timezone??clock2.timezone,face:isFace(face)?face:clock2.face,style:isStyle(style)?style:clock2.style},storage_default.sync.set({clock:clock2}),startClock(clock2,data.greeting,data.dateformat),analogFace(clock2.face),analogStyle(clock2.style),clockSize(clock2.size))}function analogFace(face="none"){document.querySelectorAll("#analog span").forEach((span,i)=>{face==="none"&&(span.textContent=["","","",""][i]),face==="number"&&(span.textContent=["12","3","6","9"][i]),face==="roman"&&(span.textContent=["XII","III","VI","IX"][i]),face==="marks"&&(span.textContent=["\u2502","\u2015","\u2502","\u2015"][i])})}function analogStyle(style){document.getElementById("analog")?.setAttribute("class",style||"")}function clockSize(size=1){document.documentElement.style.setProperty("--clock-size",size.toString()+"em")}function startClock(clock2,greeting,dateformat){document.getElementById("time")?.classList.toggle("analog",clock2.analog),document.getElementById("time")?.classList.toggle("seconds",clock2.seconds),clearInterval(clockInterval),start(),clockInterval=setInterval(start,1e3);function start(){let date=zonedDate(clock2.timezone),isNextHour=date.getMinutes()===0;clock2.analog?analog(date,clock2.seconds):digital(date,clock2.ampm),isNextHour&&(clockDate(date,dateformat),greetings(date,greeting))}}function digital(date,ampm){let domclock=document.getElementById("digital"),hh=document.getElementById("digital-hh"),mm=document.getElementById("digital-mm"),ss=document.getElementById("digital-ss"),m=fixunits(date.getMinutes()),s=fixunits(date.getSeconds()),h=ampm?date.getHours()%12:date.getHours();ampm&&h===0&&(h=12),domclock?.classList.toggle("zero",!ampm&&h<10),hh.textContent=h.toString(),mm.textContent=m.toString(),ss.textContent=s.toString()}function analog(date,seconds){let m=((date.getMinutes()+date.getSeconds()/60)*6).toFixed(1),h=((date.getHours()%12+date.getMinutes()/60)*30).toFixed(1),s=(date.getSeconds()*6).toFixed(1);document.getElementById("analog-hours")?.style.setProperty("--deg",`${h}deg`),document.getElementById("analog-minutes")?.style.setProperty("--deg",`${m}deg`),seconds&&document.getElementById("analog-seconds")?.style.setProperty("--deg",`${s}deg`)}var months=["January","February","March","April","May","June","July","August","September","October","November","December"],days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function clockDate(date,dateformat){let datedom=document.getElementById("date"),aa=document.getElementById("date-aa"),bb=document.getElementById("date-bb"),cc=document.getElementById("date-cc"),lang=getLang(),useSinograms=lang.includes("zh")||lang.includes("jp"),day=date.getDate().toString()+(useSinograms?"\u65E5":""),weekday=tradThis(days[date.getDay()]),month=tradThis(months[date.getMonth()]);datedom.classList.remove("eu","us","cn"),datedom.classList.add(dateformat),dateformat==="eu"&&(aa.textContent=weekday,bb.textContent=day,cc.textContent=month),dateformat==="us"&&(aa.textContent=weekday,bb.textContent=month,cc.textContent=day),dateformat==="cn"&&(aa.textContent=month,bb.textContent=day,cc.textContent=weekday)}function greetings(date,name){let hour=date.getHours(),greet="Good evening";hour<3?greet="Good evening":hour<5?greet=["Good night","Sweet dreams"][oneInFiveRandom]:hour<12?greet="Good morning":hour<18&&(greet="Good afternoon");let domgreetings=document.getElementById("greetings"),domgreeting=document.getElementById("greeting"),domname=document.getElementById("greeting-name");domgreetings.style.textTransform=name?"none":"capitalize",domgreeting.textContent=tradThis(greet)+(name?", ":""),domname.textContent=name??""}function zonedDate(timezone="auto"){let date=new Date;if(timezone==="auto")return date;let offset=date.getTimezoneOffset()/60,utcHour=date.getHours()+offset,utcMinutes=date.getMinutes()+date.getTimezoneOffset(),minutes;return timezone.split(".")[1]?(minutes=utcMinutes+parseInt(timezone.split(".")[1]),minutes>-30&&utcHour++):minutes=date.getMinutes(),date.setHours(utcHour+parseInt(timezone),minutes),date}function fixunits(val){return(val<10?"0":"")+val.toString()}function isFace(str=""){return["none","number","roman","marks"].includes(str)}function isStyle(str=""){return["round","square","transparent"].includes(str)}function isDateFormat(str=""){return["eu","us","cn"].includes(str)}var sunrise=420,sunset=1320;function suntime(rise,set2){return rise&&set2&&(sunrise=minutator(new Date(rise*1e3)),sunset=minutator(new Date(set2*1e3))),{sunrise,sunset}}var apiList=ENVIRONNEMENT==="TEST"?["http://localhost:8787"]:shuffledAPIUrls();function shuffledAPIUrls(){return[MAIN_API,...FALLBACK_API.map(value=>({value,sort:Math.random()})).sort((a,b)=>a.sort-b.sort).map(({value})=>value)]}async function apiWebSocket(path){for(let url of apiList)try{ENVIRONNEMENT==="TEST"&&(url="wss://bonjourr-apis.victr.workers.dev");let socket2=new WebSocket(url.replace("https://","wss://")+path);if(await new Promise(resolve2=>{socket2.onopen=()=>resolve2(!0),socket2.onerror=()=>resolve2(!1),socket2.onclose=()=>resolve2(!1)}))return socket2}catch(error){console.warn(error)}}async function apiFetch(path){for(let url of apiList)try{return await fetch(url+path)}catch(error){console.warn(error),await new Promise(r=>setTimeout(()=>r(!0),200))}}function stringMaxSize(str="",size){return str.length>size?str.slice(0,size):str}function minutator(date){return date.getHours()*60+date.getMinutes()}function randomString(len){let chars="abcdefghijklmnopqr";return Array.from({length:len},()=>chars[Math.floor(Math.random()*chars.length)]).join("")}function periodOfDay(time){let mins=minutator(time?new Date(time):new Date),{sunrise:sunrise2,sunset:sunset2}=suntime();return mins>=0&&mins<=sunrise2-60?"night":mins<=sunrise2+60?"noon":mins<=sunset2-60?"day":mins<=sunset2+60?"evening":mins>=sunset2+60?"night":"day"}var freqControl={set:()=>new Date().getTime(),get:(every,last)=>{let nowDate=new Date,lastDate=new Date(last||0),changed={date:nowDate.getDate()!==lastDate.getDate(),hour:nowDate.getHours()!==lastDate.getHours()};switch(every){case"day":return changed.date;case"hour":return changed.date||changed.hour;case"tabs":return!0;case"pause":return last===0;case"period":return last===0?!0:periodOfDay()!==periodOfDay(+lastDate)||!1;default:return!1}}};function bundleLinks(data){let res=[];return Object.entries(data).map(([key,val])=>{key.length===11&&key.startsWith("links")&&res.push(val)}),res}function linksDataMigration(data){if(data?.linktabs)return data;let notfoundicon="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI2MiIgdmlld0JveD0iMC";return bundleLinks(data).sort((a,b)=>(a.order??0)-(b.order??0)).forEach(link=>{link.icon?.startsWith(notfoundicon)&&(link.icon=MAIN_API+"/favicon/blob/",data[link._id]=link)}),data}var inputThrottle=(elem,time=800)=>{let isThrottled=!0;setTimeout(()=>{isThrottled=!1,elem.removeAttribute("disabled")},time),isThrottled&&elem.setAttribute("disabled","")};function turnRefreshButton(button,canTurn){let animationOptions={duration:600,easing:"ease-out"};button.animate(canTurn?[{transform:"rotate(360deg)"}]:[{transform:"rotate(0deg)"},{transform:"rotate(90deg)"},{transform:"rotate(0deg)"}],animationOptions)}function isEvery(freq=""){return["tabs","hour","day","period","pause"].includes(freq)}function getHTMLTemplate(id,selector){return document.getElementById(id)?.content.cloneNode(!0)?.querySelector(selector)}function networkForm(targetId2){let form,button;onSettingsLoad(()=>{form=document.getElementById(targetId2),button=form?.querySelector("button:last-of-type"),form.querySelectorAll("input").forEach(input=>{input?.addEventListener("blur",()=>{input.value===""&&form.classList.remove("valid")})}),form?.addEventListener("input",()=>{form.classList.contains("warn")&&form.classList.remove("warn")})});function resetForm(){form.classList.remove("load","warn","offline","valid"),button.removeAttribute("disabled"),button.title=""}function load(){form.classList.add("valid","load"),form.classList.remove("warn","offline"),button.setAttribute("disabled","disabled"),button.title="loading"}function warn(err){form.classList.add("warn"),form.classList.remove("load","offline"),button.setAttribute("disabled","disabled"),button.title=err}function accept(inputId,value){inputId&&value&&(form.classList.remove("valid"),form.querySelectorAll("input").forEach(input=>input.value=""),document.getElementById(inputId)?.setAttribute("placeholder",value)),setTimeout(()=>resetForm(),200)}return{load,warn,accept}}var pollingInterval=0,locationForm=networkForm("f_location"),unitForm=networkForm("f_units"),geolForm=networkForm("f_geol");function weather(init,update2){if(update2){updatesWeather(update2);return}init&&!(init.sync?.weatherdesc&&init.sync?.weathericon)&&weatherCacheControl(init.sync.weather,init.lastWeather),init&&(onSettingsLoad(()=>{handleGeolOption(init.sync.weather)}),queueMicrotask(()=>{clearInterval(pollingInterval),pollingInterval=setInterval(async()=>{let sync=await storage_default.sync.get(["weather","hide"]),local=await storage_default.local.get("lastWeather");weatherCacheControl(sync.weather,local.lastWeather)},12e5)}))}async function updatesWeather(update2){let{weather:weather2,hide}=await storage_default.sync.get(["weather","hide"]),lastWeather=(await storage_default.local.get("lastWeather")).lastWeather;if(!(!weather2||!hide)){if(isUnits(update2.units)&&(unitForm.load(),weather2.unit=update2.units,lastWeather=await request(weather2,lastWeather)??lastWeather,unitForm.accept()),isForecast(update2.forecast)&&(weather2.forecast=update2.forecast),isTemperature(update2.temp)&&(weather2.temperature=update2.temp),isMoreinfo(update2.moreinfo)&&(document.getElementById("weather_provider")?.classList.toggle("shown",update2.moreinfo==="custom"),weather2.moreinfo=update2.moreinfo),update2.provider&&(weather2.provider=update2.provider),update2.unhide){let{weatherdesc,weathericon}=hide||{};weatherdesc&&weathericon&&weatherCacheControl(weather2)}if(update2.city){let i_city=document.getElementById("i_city"),i_ccode=document.getElementById("i_ccode"),ccode=i_ccode.value,city=i_city.value;if(!navigator.onLine)return locationForm.warn("No internet connection"),!1;if(city===weather2.city)return;city=stringMaxSize(city,64),locationForm.load();let currentWeather={...weather2,ccode,city},newWeather=await request(currentWeather,lastWeather),newCity=newWeather?.approximation?.city,foundCityIsDifferent=newCity!==""&&newCity!==city;if(!newWeather){locationForm.warn("Cannot reach weather service");return}if(foundCityIsDifferent){locationForm.warn("Cannot find correct city");return}newWeather&&(lastWeather=newWeather,weather2.ccode=(lastWeather.approximation?.ccode||i_ccode.value)??"FR",weather2.city=(lastWeather.approximation?.city||city)??"Paris",locationForm.accept("i_city",weather2.city??tradThis("City")),i_city.dispatchEvent(new KeyboardEvent("input")))}if(update2.geol){if(geolForm.load(),update2.geol==="precise"&&!await getGeolocation("precise")){geolForm.warn("Cannot get precise location");return}isGeolocation(update2.geol)&&(weather2.geolocation=update2.geol),lastWeather=await request(weather2,lastWeather)??lastWeather,geolForm.accept()}storage_default.sync.set({weather:weather2}),onSettingsLoad(()=>handleGeolOption(weather2)),lastWeather&&(storage_default.local.set({lastWeather}),displayWeather(weather2,lastWeather))}}async function weatherCacheControl(data,lastWeather){if(handleForecastDisplay(data.forecast),!lastWeather){initWeather(data);return}let date=new Date,now=date.getTime(),forecast=new Date((lastWeather?.forecasted_timestamp??0)*1e3),forecastFromPreviousDay=forecast.getDate()!==date.getDate()&&forecast.getTime()<now,forecastFromToday=forecast.getDate()===date.getDate(),aboveSunset=date.getHours()>getSunsetHour(),isForecastOld=forecastFromPreviousDay||forecastFromToday&&aboveSunset,isCurrentOnly=isForecastOld===!1,isAnHourLater=Math.floor(now/1e3)>(lastWeather?.timestamp??0)+3600;if(navigator.onLine&&(isAnHourLater||isForecastOld)){let newWeather=await request(data,lastWeather,isCurrentOnly);newWeather&&(lastWeather=newWeather,storage_default.local.set({lastWeather}))}displayWeather(data,lastWeather)}async function initWeather(data){let currentWeather=await request(data);currentWeather&&(data.ccode=currentWeather.approximation?.ccode??"FR",data.city=currentWeather.approximation?.city??tradThis("City"),storage_default.sync.set({weather:data}),storage_default.local.set({lastWeather:currentWeather}),displayWeather(data,currentWeather),setTimeout(()=>handleGeolOption(data),400))}async function getGeolocation(type){let location2={lat:0,lon:0};return type==="precise"&&await new Promise(resolve2=>navigator.geolocation.getCurrentPosition(geo=>{location2.lat=geo.coords.latitude,location2.lon=geo.coords.longitude,resolve2(!0)},()=>{resolve2(!1)})),location2.lat!==0&&location2.lon!==0?location2:void 0}function handleGeolOption(data){let i_city=document.querySelector("#i_city"),i_geol=document.querySelector("#i_geol"),i_ccode=document.querySelector("#i_ccode");i_ccode&&i_city&&i_geol&&(i_geol.value=data?.geolocation??!1,i_ccode.value=data.ccode??"FR",i_city.setAttribute("placeholder",data.city??"Paris"),document.getElementById("location_options")?.classList.toggle("shown",data.geolocation==="off"))}async function request(data,lastWeather,currentOnly){if(!navigator.onLine)return lastWeather;let isKeepingCity=data.geolocation==="off"&&lastWeather?.approximation?.city===data.city,coords2=await getGeolocation(data.geolocation),lang=getLang(),queries="";lang==="zh_HK"&&(lang="zh_TW"),lang==="pt_PT"&&(lang="pt"),lang==="es_ES"&&(lang="es"),lang==="gr"&&(lang="el"),lang==="jp"&&(lang="ja"),queries+="?units="+(data.unit??"metric"),queries+="&lang="+lang,data.geolocation==="off"&&isKeepingCity&&lastWeather?.approximation&&(coords2={lat:lastWeather.approximation.lat,lon:lastWeather.approximation.lon}),coords2&&(queries+="&lat="+coords2.lat,queries+="&lon="+coords2.lon),data.geolocation==="off"&&!coords2&&(queries+="&q="+encodeURI(data.city??"Paris"),queries+=","+(data.ccode??"FR"));let response,onecall,current;if(queries.includes("&lat")&&lang==="en")try{let masterurl=`https://openweathermap.org/data/2.5/onecall${queries}&appid=439d4b804bc8187953eb36d2a8c26a02`;response=await fetch(masterurl,{signal:AbortSignal.timeout(2e3)}),response.status===200&&(onecall=await response.json())}catch{console.log("Default key not available right now")}if(!onecall){let response2=await apiFetch((currentOnly?"/weather/current/":"/weather/")+queries);try{response2?.status===200&&(currentOnly&&(current=await response2?.json()),currentOnly||(onecall=await response2?.json()))}catch(error){console.log(error)}}if(response?.status===429&&lastWeather)return lastWeather.timestamp=Date.now()-18e5,lastWeather;if(!onecall&&current&&(onecall={lat:current.coord.lat,lon:current.coord.lon,current:{dt:Math.floor(new Date().getTime()/1e3),feels_like:current.main.feels_like,sunrise:current.sys.sunrise,sunset:current.sys.sunset,temp:current.main.temp,weather:current.weather}}),!onecall)return lastWeather;let{temp,feels_like,sunrise:sunrise2,sunset:sunset2}=onecall.current,{description,id}=onecall.current.weather[0],forecasted_high=lastWeather?.forecasted_high??-273.15,forecasted_timestamp=lastWeather?.forecasted_timestamp??0;if(onecall.hourly){let date=new Date,alltemps=[];date.getHours()>getSunsetHour()&&date.setDate(date.getDate()+1);for(let item of onecall.hourly)new Date(item.dt*1e3).getDate()===date.getDate()&&alltemps.push(item.temp);date.setHours(0,0,0,0),forecasted_timestamp=Math.floor(date.getTime()/1e3),forecasted_high=Math.round(Math.max(...alltemps))}return suntime(sunrise2,sunset2),{timestamp:Math.floor(new Date().getTime()/1e3),forecasted_timestamp,forecasted_high,description,feels_like,icon_id:id,sunrise:sunrise2,sunset:sunset2,temp,approximation:{ccode:isKeepingCity?lastWeather?.approximation?.ccode:onecall?.ccode,city:isKeepingCity?lastWeather?.approximation?.city:onecall?.city,lat:onecall.lat,lon:onecall.lon}}}function displayWeather(data,lastWeather){let useSinograms=getLang().includes("zh")||getLang().includes("jp"),current=document.getElementById("current"),tempContainer=document.getElementById("tempContainer"),weatherdom=document.getElementById("weather"),dot=useSinograms?"\u3002":". ",date=new Date,handleDescription=()=>{let feels=Math.floor(lastWeather.feels_like),actual=Math.floor(lastWeather.temp),maintemp=data.temperature==="feelslike"?feels:actual,tempReport="";data.temperature==="actual"&&(tempReport=tradThis("It is currently <temp1>\xB0")),data.temperature==="feelslike"&&(tempReport=tradThis("It currently feels like <temp2>\xB0")),data.temperature==="both"&&(tempReport=tradThis("It is currently <temp1>\xB0 and feels like <temp2>\xB0"));let iconText=tempContainer?.querySelector("p"),weatherReport=lastWeather.description[0].toUpperCase()+lastWeather.description.slice(1);tempReport=tempReport.replace("<temp1>",actual.toString()),tempReport=tempReport.replace("<temp2>",feels.toString()),current&&iconText&&(current.textContent=weatherReport+dot+tempReport,iconText.textContent=`${maintemp}\xB0`)},handleWidget=()=>{let filename="lightrain";if([[[200,201,202,210,211,212,221,230,231,232],"thunderstorm"],[[300,301,302,310],"lightdrizzle"],[[312,313,314,321],"showerdrizzle"],[[500,501,502,503],"lightrain"],[[504,520,521,522],"showerrain"],[[511,600,601,602,611,612,613,615,616,620,621,622],"snow"],[[701,711,721,731,741,751,761,762,771,781],"mist"],[[800],"clearsky"],[[801],"fewclouds"],[[802],"brokenclouds"],[[803,804],"overcastclouds"]].forEach(category=>{category[0].includes(lastWeather.icon_id)&&(filename=category[1])}),!tempContainer)return;let icon=document.getElementById("weather-icon"),now=minutator(new Date),{sunrise:sunrise2,sunset:sunset2}=suntime(),iconSrc=`src/assets/weather/${now<sunrise2||now>sunset2?"night":"day"}/${filename}.svg`;icon.src=iconSrc},handleForecastData=()=>{let forecastdom=document.getElementById("forecast"),day=date.getHours()>getSunsetHour()?"tomorrow":"today",string2="";day==="today"&&(string2=tradThis("with a high of <temp1>\xB0 today")),day==="tomorrow"&&(string2=tradThis("with a high of <temp1>\xB0 tomorrow")),string2=string2.replace("<temp1>",lastWeather.forecasted_high.toString()),string2=string2+dot,forecastdom&&(forecastdom.textContent=string2)},handleMoreInfo=()=>{let noDetails=!data.moreinfo||data.moreinfo==="none",emptyCustom=data.moreinfo==="custom"&&!data.provider;if(noDetails||emptyCustom){weatherdom?.removeAttribute("href");return}let URLs={msnw:"https://www.msn.com/en-us/weather/forecast/",yhw:"https://www.yahoo.com/news/weather/",windy:"https://www.windy.com/",custom:data.provider??""};(data.moreinfo||"")in URLs&&weatherdom?.setAttribute("href",URLs[data.moreinfo])};handleForecastDisplay(data.forecast),handleWidget(),handleMoreInfo(),handleDescription(),handleForecastData(),weatherdom?.classList.remove("wait")}function handleForecastDisplay(forecast){let date=new Date,morningOrLateDay=date.getHours()<12||date.getHours()>getSunsetHour(),isTimeForForecast=forecast==="auto"?morningOrLateDay:forecast==="always";if(isTimeForForecast&&!document.getElementById("forecast")){let p=document.createElement("p");p.id="forecast",document.getElementById("description")?.appendChild(p)}isTimeForForecast||document.querySelector("#forecast")?.remove()}function getSunsetHour(){let d=new Date;return d.setHours(Math.round(suntime().sunset/60)),d.getHours()}function isUnits(str=""){return["metric","imperial"].includes(str)}function isForecast(str=""){return["auto","always","never"].includes(str)}function isMoreinfo(str=""){return["none","msnw","yhw","windy","custom"].includes(str)}function isTemperature(str=""){return["actual","feelslike","both"].includes(str)}function isGeolocation(str=""){return["precise","approximate","off"].includes(str)}function customCss(init,event){let stylelink=document.getElementById("styles");if(event){if(event?.styling!==void 0){let val=stringMaxSize(event.styling,8080);stylelink.textContent=val,eventDebounce({css:val})}return}init&&(stylelink.textContent=init),onSettingsLoad(async()=>{let{defaultCommands:defaultCommands2}=await Promise.resolve().then(()=>(init_commands(),commands_exports)),{createEditor:createEditor2}=await Promise.resolve().then(()=>(init_dist(),dist_exports));await Promise.resolve().then(()=>(init_css_extras(),css_extras_exports));let options={language:"css",lineNumbers:!1,wordWrap:!0,value:init||`/* ${tradThis("Type in your custom CSS")} */`};createEditor2("#css-editor",options,defaultCommands2()).addListener("update",value=>{value=stringMaxSize(value,8080),eventDebounce({css:value}),stylelink.textContent=value})})}var socket,domsuggestions=document.getElementById("sb-suggestions"),domcontainer=document.getElementById("sb_container"),domsearchbar=document.getElementById("searchbar"),dombuttons=document.getElementById("sb-buttons"),emptyButton=document.getElementById("sb_empty"),display=(shown=!1)=>domcontainer?.classList.toggle("hidden",!shown),setEngine=(value="google")=>domcontainer?.setAttribute("data-engine",value),setRequest=(value="")=>domcontainer?.setAttribute("data-request",stringMaxSize(value,512)),setNewtab=(value=!1)=>domcontainer?.setAttribute("data-newtab",value.toString()),setSuggestions=(value=!0)=>domcontainer?.setAttribute("data-suggestions",value.toString()),setPlaceholder=(value="")=>domsearchbar?.setAttribute("placeholder",value),setWidth=(value=30)=>document.documentElement.style.setProperty("--searchbar-width",value.toString()+"em"),setOpacity=(value=.1)=>{document.documentElement.style.setProperty("--searchbar-background-alpha",value.toString()),document.getElementById("sb_container")?.classList.toggle("opaque",value>.4)};function searchbar(init,update2){if(update2){updateSearchbar(update2);return}try{display(init?.on),setWidth(init?.width),setEngine(init?.engine),setRequest(init?.request),setNewtab(init?.newtab),setPlaceholder(init?.placeholder),setSuggestions(init?.suggestions),setOpacity(init?.opacity),dombuttons?.addEventListener("click",focusSearchbar),emptyButton?.addEventListener("click",removeInputText),domcontainer?.addEventListener("submit",submitSearch),domsearchbar?.addEventListener("input",handleUserInput),document.addEventListener("keydown",searchbarShortcut)}catch(e){errorMessage(e)}}async function updateSearchbar({engine,newtab,opacity,placeholder,request:request2,suggestions:suggestions2,width}){let{searchbar:searchbar2}=await storage_default.sync.get("searchbar");if(searchbar2){if(isValidEngine(engine)&&(document.getElementById("searchbar_request")?.classList.toggle("shown",engine==="custom"),searchbar2.engine=engine,setEngine(engine)),suggestions2!==void 0&&(searchbar2.suggestions=suggestions2,setSuggestions(suggestions2)),newtab!==void 0&&(searchbar2.newtab=newtab,setNewtab(newtab)),opacity!==void 0&&(searchbar2.opacity=parseFloat(opacity),setOpacity(searchbar2.opacity)),width!==void 0&&(searchbar2.width=parseInt(width),setWidth(searchbar2.width)),placeholder!==void 0&&(searchbar2.placeholder=placeholder,setPlaceholder(placeholder)),request2){if(!request2.value.includes("%s"))return;searchbar2.request=stringMaxSize(request2.value,512),setRequest(searchbar2.request),request2.blur()}eventDebounce({searchbar:searchbar2})}}function isValidURL(string2){try{let url=new URL(string2.startsWith("http")?string2:"https://"+string2);return/^(?:\w(?:[\w-]*\.)+[\w-]+)(?::\d+)?(?:\/[^/?#]+)?\/?$/.test(url.host)}catch{return!1}}function createSearchURL(val){let URLs={google:"https://www.google.com/search?q=%s",ddg:"https://duckduckgo.com/?q=%s",startpage:"https://www.startpage.com/do/search?query=%s",qwant:"https://www.qwant.com/?q=%s",yahoo:"https://search.yahoo.com/search?q=%s",bing:"https://www.bing.com/search?q=%s",brave:"https://search.brave.com/search?q=%s",ecosia:"https://www.ecosia.org/search?q=%s",lilo:"https://search.lilo.org/?q=%s",baidu:"https://www.baidu.com/s?wd=%s",custom:domcontainer?.dataset.request||""},searchURL=URLs.google,engine=domcontainer?.dataset.engine||"google";if(isValidEngine(engine)){let trad=tradThis(engine);searchURL=trad.includes("%s")?trad:URLs[engine]}return searchURL.replace("%s",encodeURIComponent(val??""))}function submitSearch(e){if(!domsearchbar)return;let target=domcontainer?.dataset.newtab==="true"?"_blank":"_self",val=domsearchbar.value,url="";isValidURL(val)?url=val.startsWith("http")?val:"https://"+val:url=createSearchURL(val),socket&&socket.close(),window.open(url,target),e.preventDefault()}function initSuggestions(){function selectShownResult(next){return next?.classList.contains("shown")?next:null}function applyResultContentToInput(elem){!elem||!domsearchbar||(domsearchbar.value=elem?.querySelector(".suggest-result")?.textContent??"")}for(let ii=0;ii<10;ii++){let li=document.createElement("li"),image=document.createElement("img"),wrapper=document.createElement("div"),result=document.createElement("p"),description=document.createElement("p");li.setAttribute("tabindex","0"),image.setAttribute("draggable","false"),image.setAttribute("width","16"),image.setAttribute("height","16"),result.classList.add("suggest-result"),description.classList.add("suggest-desc"),wrapper.appendChild(result),wrapper.appendChild(description),li.appendChild(image),li.appendChild(wrapper),li.addEventListener("mouseenter",()=>{domcontainer?.querySelector('li[aria-selected="true"]')?.removeAttribute("aria-selected"),li?.setAttribute("aria-selected","true")}),li.addEventListener("mouseleave",()=>{li?.removeAttribute("aria-selected")}),li.addEventListener("click",e=>{applyResultContentToInput(li),submitSearch(e)}),domsuggestions?.appendChild(li)}function toggleSuggestions(e){let targetIsResult=e?.relatedTarget?.parentElement?.id==="sb-suggestions",hasResults=document.querySelectorAll("#sb-suggestions li.shown")?.length>0,isFocus=e.type==="focus";targetIsResult||domsuggestions?.classList.toggle("shown",isFocus&&hasResults)}function navigateSuggestions(e){let isArrowDown=e.code==="ArrowDown",isArrowUp=e.code==="ArrowUp",isEnter=e.code==="Enter",isEscape=e.code==="Escape",lastSelected=domsuggestions?.querySelector('li[aria-selected="true"]');lastSelected?.removeAttribute("aria-selected"),!isEscape&&(isArrowDown&&(lastSelected=selectShownResult(lastSelected?.nextElementSibling)??domsuggestions?.querySelector("li.shown"),applyResultContentToInput(lastSelected)),isArrowUp&&(lastSelected=selectShownResult(lastSelected?.previousElementSibling),applyResultContentToInput(lastSelected),e.preventDefault()),isEnter&&lastSelected&&(applyResultContentToInput(lastSelected),submitSearch(e)),lastSelected?.setAttribute("aria-selected","true"))}function hideResultsAndSuggestions(){Object.values(domsuggestions?.children??[]).forEach(child=>child.classList.remove("shown")),domsuggestions?.classList.remove("shown")}async function createSuggestionSocket(){socket=await apiWebSocket("/suggestions"),socket?.addEventListener("message",function(event){let data=parse(event.data);Array.isArray(data)?suggestions(data):data?.error&&createSuggestionSocket()})}domcontainer?.addEventListener("keydown",navigateSuggestions),domsearchbar?.addEventListener("focus",toggleSuggestions),domsearchbar?.addEventListener("blur",toggleSuggestions),emptyButton?.addEventListener("click",hideResultsAndSuggestions),createSuggestionSocket()}async function suggestions(results){let input=domsearchbar,liList=domsuggestions?.querySelectorAll("li")??[];domsuggestions?.classList.toggle("shown",results.length>0),domsuggestions?.querySelector('li[aria-selected="true"]')?.removeAttribute("aria-selected"),liList.forEach((li,i)=>{let result=results[i];if(!result)return;let searchIcon="src/assets/interface/magnifying-glass.svg",image=result.image??searchIcon,desc=result.desc??"",resultdom=li.querySelector(".suggest-result");if(resultdom.textContent=result.text,result.text.includes(input.value)){let queryIndex=result.text.indexOf(input.value),startdom=document.createElement("span"),querydom=document.createElement("b"),enddom=document.createElement("span");startdom.textContent=result.text.slice(0,queryIndex),querydom.textContent=result.text.slice(queryIndex,input.value.length),enddom.textContent=result.text.slice(input.value.length),resultdom.textContent="",resultdom?.appendChild(startdom),resultdom?.appendChild(querydom),resultdom?.appendChild(enddom)}let imgdom=li.querySelector("img");imgdom.classList.toggle("default-search-icon",image===searchIcon),imgdom.src=image,li.querySelector(".suggest-desc").textContent=desc,li.classList.toggle("shown",!!result);let rect=li.getBoundingClientRect();rect.y+rect.height+40>document.body.offsetHeight&&li.classList.remove("shown")}),domsuggestions?.querySelectorAll("li.shown")?.length===0&&domsuggestions?.classList.remove("shown")}async function handleUserInput(e){let value=e.target.value??"",startsTypingProtocol="https://".startsWith(value)||value.match(/https?:\/?\/?/i);if(domsearchbar&&toggleInputButton(value.length>0),value===""){document.querySelectorAll("#sb-suggestions li.shown")?.forEach(li=>li.classList.remove("shown")),domsuggestions?.classList.remove("shown");return}if(startsTypingProtocol||isValidURL(value)){domsuggestions?.classList.remove("shown");return}if(domsuggestions?.childElementCount===0&&initSuggestions(),domcontainer?.dataset.suggestions==="true"&&socket&&socket.readyState===socket.OPEN){let engine=(domcontainer?.dataset.engine??"ddg").replace("custom","ddg"),query=encodeURIComponent(value??"");socket.send(JSON.stringify({q:query,with:engine}))}}function toggleInputButton(enabled){document.getElementById("sb-buttons")?.classList.toggle("shown",enabled),document.getElementById("sb_empty")?.toggleAttribute("disabled",!enabled),document.getElementById("sb_submit")?.toggleAttribute("disabled",!enabled)}function removeInputText(){domsearchbar&&(domsearchbar.focus(),domsearchbar.value="",toggleInputButton(!1))}function focusSearchbar(){dombuttons?.classList.contains("shown")===!1&&domsearchbar?.focus()}function searchbarShortcut(event){event.target.tagName==="BODY"&&event.key==="/"&&(domsearchbar?.focus(),domsearchbar?.select(),event.preventDefault())}function isValidEngine(s=""){return SEARCHBAR_ENGINES.includes(s)}var familyForm=networkForm("f_customfont"),systemfont=function(){let fonts={fallback:{placeholder:"Arial",weights:["500","600","800"]},windows:{placeholder:"Segoe UI",weights:["300","400","600","700","800"]},android:{placeholder:"Roboto",weights:["100","300","400","500","700","900"]},linux:{placeholder:"Fira Sans",weights:["100","200","300","400","500","600","700","800","900"]},apple:{placeholder:"SF Pro Display",weights:["100","200","300","400","500","600","700","800","900"]}};return SYSTEM_OS==="windows"?fonts.windows:SYSTEM_OS==="android"?fonts.android:SYSTEM_OS==="mac"||SYSTEM_OS==="ios"?fonts.apple:fonts.linux}();async function customFont(init,event){if(event){updateCustomFont(event);return}if(init)try{init=migrateToNewFormat(init),displayFont(init),displayInterface("fonts"),onSettingsLoad(()=>{initFontSettings(init)})}catch(e){errorMessage(e)}}async function updateCustomFont({family,weight,size,lang,autocomplete}){if(autocomplete){setAutocompleteSettings();return}let data=await storage_default.sync.get("font");if(family!==void 0&&(data.font=await updateFontFamily(data,family)),weight&&(data.font.weight=weight||"400",displayFont(data.font)),size&&(data.font.size=size,displayFont(data.font)),lang){handleLangSwitch(data.font);return}eventDebounce({font:data.font})}async function updateFontFamily(data,family){let i_weight=document.getElementById("i_weight"),familyType=family.length==0?"none":systemFontChecker(family)?"system":"fontsource",font={family:"",system:!0,size:data.font.size,weight:SYSTEM_OS==="windows"?"400":"300",weightlist:systemfont.weights};switch(familyType){case"none":{displayFont(font),familyForm.accept("i_customfont",systemfont.placeholder);break}case"system":{font.family=family,displayFont(font),familyForm.accept("i_customfont",family);break}case"fontsource":{familyForm.load();let newfont=await getNewFont(font,family);if(newfont&&navigator.onLine&&(font={...font,...newfont},displayFont(font),await waitForFontLoad(family),familyForm.accept("i_customfont",family)),font.family==="")return familyForm.warn(`Cannot load "${family}"`),data.font;break}}return setWeightSettings(font.weightlist),i_weight.value=font.weight,font}async function handleLangSwitch(font){if(!font.family||font?.system)return;let newfont=await getNewFont(font,font.family);if(newfont===void 0){updateCustomFont({family:""});return}font.family=newfont.family,font.weight=newfont.weight,font.weightlist=newfont.weightlist,displayFont(font),setAutocompleteSettings(!0)}async function getNewFont(font,newfamily){let fontlist=await(await apiFetch("/fonts"))?.json()??[],newfont;for(let item of fontlist){let hasCorrectSubset=item.subsets.includes(getRequiredSubset()),isFamily=item.family.toLowerCase()===newfamily.toLowerCase();hasCorrectSubset&&isFamily&&(newfont=item)}if(newfont)return font.weight="400",font.system=!1,font.family=newfamily,font.weightlist=newfont.weights.map(w=>w.toString()),font}function displayFont({family,size,weight,system}){let clockWeight=parseInt(weight)>100?systemfont.weights[systemfont.weights.indexOf(weight)-1]:weight,subset=getRequiredSubset(),id=family.toLocaleLowerCase().replaceAll(" ","-");if(!system){let fontface=`
			@font-face {font-family: "${family}";
				src: url(https://cdn.jsdelivr.net/fontsource/fonts/${id}@latest/latin-${weight}-normal.woff2) format('woff2');
			}
		`;subset!=="latin"&&(fontface+=fontface.replace("latin",subset)),document.getElementById("fontface").textContent+=fontface}document.documentElement.style.setProperty("--font-family",family?`"${family}"`:null),document.documentElement.style.setProperty("--font-size",parseInt(size)/16+"em"),document.documentElement.style.setProperty("--font-weight",weight),document.documentElement.style.setProperty("--font-weight-clock",family?weight:clockWeight)}async function initFontSettings(font){let settings=document.getElementById("settings"),weights=font&&font.weightlist.length>0?font.weightlist:systemfont.weights,family=font?.family||systemfont.placeholder;settings.querySelector("#i_customfont")?.setAttribute("placeholder",family),setWeightSettings(weights)}async function setAutocompleteSettings(isLangSwitch){let dl_fontfamily=document.querySelector("#dl_fontfamily");if(isLangSwitch&&dl_fontfamily?.childNodes.forEach(node=>node.remove()),dl_fontfamily?.childElementCount===0){let fontlist=await(await apiFetch("/fonts"))?.json()??[],fragment=new DocumentFragment,requiredSubset=getRequiredSubset();for(let item of fontlist)if(item.subsets.includes(requiredSubset)){let option=document.createElement("option");option.textContent=item.family,option.value=item.family,fragment.appendChild(option)}dl_fontfamily?.appendChild(fragment)}}function setWeightSettings(weights){let options=document.querySelectorAll("#i_weight option");for(let option of options)option.classList.toggle("hidden",weights.includes(option.value)===!1)}async function fontIsAvailableInSubset(lang,family){let font=(await(await apiFetch("/fonts"))?.json())?.find(item=>item.family===family),subset=getRequiredSubset(lang);return font&&font.subsets.includes(subset)}function systemFontChecker(family){let p=document.createElement("p");p.setAttribute("style","position: absolute; opacity: 0; font-family: invalid font;"),p.textContent="mqlskdjfhgpaozieurytwnxbcv?./,;:1234567890"+tradThis("New tab"),document.getElementById("interface")?.prepend(p);let first_w=p.getBoundingClientRect().width;p.style.fontFamily=`'${family}'`;let second_w=p.getBoundingClientRect().width,hasLoadedFont=first_w!==second_w;return p.remove(),hasLoadedFont}async function waitForFontLoad(family){return new Promise(resolve2=>{let limitcounter=0,hasLoadedFont=systemFontChecker(family),interval=setInterval(()=>{if(hasLoadedFont||limitcounter===100)return clearInterval(interval),resolve2(!0);hasLoadedFont=systemFontChecker(family),limitcounter++},100)})}function getRequiredSubset(lang){let subset="latin";return lang=lang??getLang(),lang in subsets&&(subset=subsets[lang]),subset}function migrateToNewFormat(font){return font?.weightlist||(font.availWeights&&(font.weightlist=font.availWeights),font.system=systemFontChecker(font.family),delete font.availWeights,delete font.url,storage_default.local.remove("fontface"),storage_default.local.remove("fonts"),storage_default.sync.remove("font"),setTimeout(()=>storage_default.sync.set({font}))),font}function getDefaultIcon(url){return`${MAIN_API}/favicon/blob/${url}`}function getSelectedIds(){let selected=document.querySelectorAll("#linkblocks li.selected");return Array.from(selected).map(li=>li.id)}function getLiFromEvent(event){let filtered=event.composedPath().filter(el=>el.tagName==="LI"&&el.className?.includes("block"));return filtered[0]?filtered[0]:void 0}function createTitle(link){let isInline=document.getElementById("linkblocks")?.className.includes("inline"),isText=document.getElementById("linkblocks")?.className.includes("text");if(!isInline&&!isText||link.title!=="")return stringMaxSize(link.title,64);try{isElem(link)?link.title=new URL(link.url)?.hostname.replace("www.",""):link.title=tradThis("folder")}catch{}return link.title}function getLink(data,id){let val=data[id];if(isLink(val))return val}function isLink(link){return(link?._id??"").startsWith("links")}function isElem(link){return link?.folder!==!0}function transitioner(){let waitTimeout,steps={};return{first:cb=>steps.first=cb,finally:cb=>steps.finally=cb,then:cb=>steps.then=cb,cancel:()=>clearTimeout(waitTimeout),transition:async timeout=>{steps.first&&steps.first(...arguments),await new Promise(r=>{waitTimeout=setTimeout(()=>r(!0),Math.min(timeout,2e3))}),steps.then&&await steps.then(...arguments),steps.finally&&steps.finally(...arguments),delete steps.first,delete steps.then,delete steps.finally}}}var domlinkblocks=document.getElementById("linkblocks"),domeditlink=document.getElementById("editlink"),domtitle=document.getElementById("e_title"),domurl=document.getElementById("e_url"),domicon=document.getElementById("e_iconurl");async function openEditDialog(event){if(event.type==="keyup"&&event.code!=="KeyE")return;document.dispatchEvent(new Event("stop-select-all")),event.preventDefault();let selected=document.querySelectorAll("#linkblocks li.selected");domurl.value="",domicon.value="",domtitle.value="";let isSelectAll=domlinkblocks.classList.contains("select-all"),isInFolder=domlinkblocks.classList.contains("in-folder"),isSelectingFolder=!!document.querySelector(".block.selected.folder"),path=event.composedPath(),isTab=path.some(el=>el?.id==="link-title"),isTabItem=path[0]?.tagName==="BUTTON"&&path[1]?.id==="tab-title",isTabDefault=isTabItem&&path[0]?.id==="default-tab-title",isOnLink=path.some(el=>el?.className?.includes("block")&&el?.tagName==="LI"),isOnLinkFolder=isOnLink&&path.some(el=>el?.classList?.contains("folder")),isOnLinklist=path[0]?.id==="link-list";if(isInFolder&&isTab||isSelectAll&&selected.length===0||domlinkblocks.classList.contains("dragging"))return;domeditlink?.classList.toggle("select-all",isSelectAll),domeditlink?.classList.toggle("select-folder",isSelectingFolder),domeditlink?.classList.toggle("in-folder",isInFolder),domeditlink?.classList.toggle("on-linklist",isOnLinklist),domeditlink?.classList.toggle("on-link",isOnLink),domeditlink?.classList.toggle("on-link-folder",isOnLinkFolder),domeditlink?.classList.toggle("on-tabtitle",isTab),domeditlink?.classList.toggle("on-tab",isTabItem),domeditlink?.classList.toggle("on-tab-default",isTabDefault);let data=await storage_default.sync.get();if(isTabItem){let button=path[0],index=[...document.querySelectorAll("#tab-title button")].findIndex(node=>node===button),title=data.linktabs.titles[index]??"";isTabDefault&&(title=data.linktabs.titles[index]||tradThis("Default page")),domeditlink.dataset.tabIndex=index.toString(),domtitle.value=title}if(isOnLink){let li=path.filter(el=>el.tagName==="LI")[0],id=li?.id,link=getLink(data,id);domtitle.value=link?.title??"",link?.folder||(domurl.value=link?.url??"",domicon.value=link?.icon??""),isSelectAll===!1&&(document.querySelector(".block.selected")?.classList.remove("selected"),li?.classList.add("selected"))}let contextmenuTransition=transitioner();contextmenuTransition.first(()=>domeditlink?.show()),contextmenuTransition.then(async()=>domeditlink?.classList?.add("shown")),contextmenuTransition.transition(10);let{x,y}=newEditDialogPosition(event);domeditlink.style.transform=`translate(${Math.floor(x)}px, ${Math.floor(y)}px)`,domtitle?.focus()}function newEditDialogPosition(event){let editRects=domeditlink.getBoundingClientRect(),withPointer=event.type==="contextmenu"||event.type==="click",withKeyboard=event.type==="keyup"&&event?.key==="e",{innerHeight,innerWidth}=window,isMobileSized=innerWidth<600,x=0,y=0;withPointer&&isMobileSized?(x=(innerWidth-editRects.width)/2,y=event.y-60-editRects.height):withPointer?(x=event.x+20,y=event.y+20):withKeyboard&&(x=event.target.offsetLeft,y=event.target.offsetTop);let w=editRects.width+30,h=editRects.height+30;return x+w>innerWidth&&(x-=x+w-innerWidth),y+h>innerHeight&&(y-=h),{x,y}}queueMicrotask(()=>{document.addEventListener("close-edit",closeEditDialog),document.getElementById("editlink-form")?.addEventListener("submit",submitChanges),domlinkblocks?.addEventListener("contextmenu",openEditDialog),(SYSTEM_OS==="ios"||!IS_MOBILE)&&window.addEventListener("resize",closeEditDialog)});async function submitChanges(event){switch(event.submitter?.id){case"eb_inputs":{applyLinkChanges("inputs"),event.preventDefault();return}case"eb_delete-selected":case"eb_delete-folder":case"eb_delete-link":deleteSelection();break;case"eb_submit-changes":applyLinkChanges("button");break;case"eb_add-link":addLinkFromEditDialog();break;case"eb_add-folder":addSelectionToNewFolder();break;case"eb_remove-folder":removeSelectionFromFolder();break;case"eb_add-tab":addTab();break;case"eb_delete-tab":deleteTab();break}event.preventDefault(),setTimeout(closeEditDialog)}async function applyLinkChanges(origin){let id=getSelectedIds()[0],li=document.querySelector(`#${id}`),isOnTab=domeditlink.classList.contains("on-tabtitle"),isOnTabItem=domeditlink.classList.contains("on-tab"),inputs=document.querySelectorAll("#editlink input");if(isOnTabItem){changeTabTitle(),closeEditDialog();return}else if(isOnTab){addTab(),closeEditDialog();return}else if(!id&&domeditlink.classList.contains("on-linklist")){addLinkFromEditDialog(),closeEditDialog();return}if(!id||!li)return;origin==="inputs"&&inputs.forEach(node=>node.blur());let link=(await storage_default.sync.get(id))[id],title={val:document.querySelector("#e_title")?.value,dom:document.querySelector(`#${id} span`)},url={val:document.querySelector("#e_url")?.value,dom:document.querySelector(`#${id} a`)},icon={val:document.querySelector("#e_iconurl")?.value,dom:document.querySelector(`#${id} img`)};if(title.dom&&title.val!==void 0&&(link.title=stringMaxSize(title.val,64),title.dom.textContent=link.title),!link.folder){if(icon.dom){let url2=icon.val?stringMaxSize(icon.val,7500):getDefaultIcon(link.url),img=document.createElement("img");link.icon=url2||void 0,icon.dom.src="src/assets/interface/loading.svg",img.onload=()=>icon.dom.src=url2,img.src=url2}title.dom&&url.dom&&url.val!==void 0&&(link.url=stringMaxSize(url.val,512),url.dom.href=link.url,title.dom.textContent=createTitle(link))}storage_default.sync.set({[id]:link})}function changeTabTitle(){linksUpdate({tabTitle:{title:domtitle.value,index:parseInt(domeditlink.dataset.tabIndex??"0")}})}function addTab(){linksUpdate({addTab:domtitle.value})}function deleteTab(){linksUpdate({deleteTab:parseInt(domeditlink.dataset.tabIndex??"0")})}function addLinkFromEditDialog(){linksUpdate({addLink:{title:domtitle.value,url:domurl.value}})}function addSelectionToNewFolder(){linksUpdate({addFolder:getSelectedIds()}),document.dispatchEvent(new Event("remove-select-all"))}function deleteSelection(){linksUpdate({deleteLinks:getSelectedIds()})}function removeSelectionFromFolder(){linksUpdate({removeFromFolder:getSelectedIds()}),document.dispatchEvent(new Event("remove-select-all"))}function closeEditDialog(){domeditlink.open&&(document.querySelectorAll(".block.selected").forEach(block=>block?.classList.remove("selected")),domeditlink.removeAttribute("data-tab-index"),domeditlink.classList.remove("shown"),domeditlink.close())}var blocks=new Map,dropzones=new Set,[dx,dy,cox,coy,lastIndex]=[0,0,0,0,0,0],lastdropAreas=[""],draggedId="",targetId="",ids=[],initids=[],coords=[],dragChangeParentTimeout=0,dragAnimationFrame=0,domlinklist=document.getElementById("link-list"),domlinkblocks2=document.getElementById("linkblocks");function startDrag(event){if(event.button>0)return;if(event.type==="pointerdown"){beforeStartDrag(event);return}let target=event.composedPath().find(el=>el.tagName==="LI"),lis=document.querySelectorAll("#linkblocks li.block"),tabs=document.querySelectorAll("#tab-title button"),listRect=domlinklist?.getBoundingClientRect(),pos=getPosFromEvent(event);draggedId=target?.id??"",ids=[],coords=[],initids=[],lastdropAreas=[],blocks.clear(),dropzones.clear();for(let i=0;i<tabs.length;i++){let{x,y,height,width}=tabs[i].getBoundingClientRect(),id=i.toString();dropzones.add({id,x,y,h:height,w:width})}for(let li of lis){let{x,y,width,height}=li.getBoundingClientRect(),id=li.id;dropzones.add({id,x,y,w:width,h:height}),x=x-listRect.x,y=y-listRect.y,ids.push(id),initids.push(id),coords.push({x,y,w:width,h:height}),li.style.transition="none",setTimeout(()=>li.style.removeProperty("transition"),10),blocks.set(id,li),deplaceElem(li,x,y),id===draggedId&&(cox=pos.x-x,coy=pos.y-y,dx=x,dy=y,li.classList.add("on"))}domlinklist.style.setProperty("--drag-width",Math.floor(listRect?.width)+"px"),domlinklist.style.setProperty("--drag-height",Math.floor(listRect?.height)+"px"),domlinkblocks2?.classList.add("dragging"),document.dispatchEvent(new Event("remove-select-all")),dragAnimationFrame=window.requestAnimationFrame(deplaceDraggedElem),event.pointerType==="touch"?(document.documentElement.addEventListener("touchmove",moveDrag,{passive:!1}),document.documentElement.addEventListener("touchend",endDrag,{passive:!1})):(document.documentElement.addEventListener("pointermove",moveDrag),document.documentElement.addEventListener("pointerup",endDrag),document.documentElement.addEventListener("pointerleave",endDrag))}function beforeStartDrag(event){let li=getLiFromEvent(event);cox=event.offsetX,coy=event.offsetY,li?.addEventListener("pointermove",pointerDeadzone),li?.addEventListener("pointerup",pointerDeadzone);function pointerDeadzone(event2){let precision=event2.pointerType==="touch"?7:14,ox=Math.abs(cox-event2.offsetX),oy=Math.abs(coy-event2.offsetY),isEndEvents=event2.type.match(/pointerup|touchend/),isHalfOutside=ox>precision/2||oy>precision/2,isOutside=ox>precision||oy>precision;isHalfOutside&&document.dispatchEvent(new Event("stop-select-all")),isOutside&&startDrag(event2),(isOutside||isEndEvents)&&(li?.removeEventListener("pointermove",pointerDeadzone),li?.removeEventListener("pointerup",pointerDeadzone))}}function moveDrag(event){let{x,y}=getPosFromEvent(event);dx=x-cox,dy=y-coy;let[curr,id]=isDraggingOver({x,y})??["",""],last=lastdropAreas[lastdropAreas.length-1],secondlast=lastdropAreas[lastdropAreas.length-2];if(curr===last&&curr!=="center")return;if(curr===""){lastdropAreas.push(""),clearTimeout(dragChangeParentTimeout),blocks.forEach(block=>block.classList.remove("drop-target","drop-source"));return}let movesFromCenter=last==="center"&&(curr==="left"||curr==="right"),movesAcrossArea=curr!==secondlast,staysInCenter=last===curr&&curr==="center",isDroppingToTab=isNaN(parseInt(id))===!1,idAtCurrentArea=ids[initids.indexOf(id)];staysInCenter&&applyDragChangeParent(isDroppingToTab?id:idAtCurrentArea),movesFromCenter&&movesAcrossArea&&applyDragMoveBlocks(id),last!==curr&&lastdropAreas.push(curr)}function applyDragMoveBlocks(id){let targetIndex=initids.indexOf(id);if(lastIndex!==targetIndex){clearTimeout(dragChangeParentTimeout),lastIndex=targetIndex,ids.splice(ids.indexOf(draggedId),1),ids.splice(targetIndex,0,draggedId);for(let i=0;i<ids.length;i++)ids[i]!==draggedId&&deplaceElem(blocks.get(ids[i]),coords[i].x,coords[i].y)}}function applyDragChangeParent(id){let propertyValue=getComputedStyle(domlinkblocks2).getPropertyValue("--drop-delay"),dropDelay=parseInt(propertyValue||"120");clearTimeout(dragChangeParentTimeout),dragChangeParentTimeout=setTimeout(()=>{let isDraggedId=id===draggedId,inFolder=domlinkblocks2?.classList.contains("in-folder"),parentIsTab=parseInt(id)>-1;if(!(isDraggedId||inFolder)){if(parentIsTab){let selectedIndex=[...document.querySelectorAll("#tab-title button")].findIndex(btn=>btn?.classList?.contains("selected"));if(parseInt(id)===selectedIndex)return}targetId=id,blocks.forEach(block=>block.classList.remove("drop-target","drop-source")),blocks.get(draggedId)?.classList.toggle("drop-source",!0),blocks.get(id)?.classList.toggle("drop-target",!0)}},dropDelay)}function endDrag(event){event.preventDefault(),document.documentElement.removeEventListener("pointermove",moveDrag),document.documentElement.removeEventListener("pointerup",endDrag),document.documentElement.removeEventListener("pointerleave",endDrag),document.documentElement.removeEventListener("touchmove",moveDrag),document.documentElement.removeEventListener("touchend",endDrag);let path=event.composedPath(),newIndex=ids.indexOf(draggedId),block=blocks.get(draggedId),coord=coords[newIndex],isDroppable=!!document.querySelector(".drop-source"),outOfFolder=path[0]!==domlinklist&&domlinkblocks2.classList.contains("in-folder"),toFolder=isDroppable&&isNaN(parseInt(targetId))===!0,toTab=isDroppable&&isNaN(parseInt(targetId))===!1;window.cancelAnimationFrame(dragAnimationFrame),blocks.get(draggedId)?.classList.remove("on"),domlinkblocks2?.classList.replace("dragging","dropping"),document.body?.classList.replace("dragging","dropping"),outOfFolder||toFolder||toTab?blocks.get(draggedId)?.classList.add("removed"):deplaceElem(block,coord.x,coord.y),setTimeout(()=>{let targetIsFolder=blocks.get(targetId)?.classList.contains("folder"),draggedIsFolder=blocks.get(draggedId)?.classList.contains("folder");toFolder&&!targetIsFolder&&!draggedIsFolder?linksUpdate({addFolder:[targetId,draggedId]}):toFolder&&(targetIsFolder||draggedIsFolder)?linksUpdate({addToFolder:{source:draggedId,target:targetId}}):toTab?linksUpdate({moveToTab:{ids:[draggedId],target:targetId}}):outOfFolder?linksUpdate({removeFromFolder:[draggedId]}):linksUpdate({moveLinks:ids}),setTimeout(()=>{domlinkblocks2?.classList.remove("dropping"),document.body.classList.remove("dropping"),domlinklist?.removeAttribute("style")},1)},200)}function deplaceElem(dom,x=0,y=0){dom&&(dom.style.transform=`translate(${Math.floor(x)}px, ${Math.floor(y)}px)`)}function deplaceDraggedElem(){blocks.has(draggedId)&&(blocks.get(draggedId).style.transform=`translate(${dx}px, ${dy}px)`,dragAnimationFrame=window.requestAnimationFrame(deplaceDraggedElem))}function isDraggingOver({x,y}){for(let zone of dropzones){let ll=zone.x,lr=zone.x+zone.w*.2,lt=zone.y,lb=zone.y+zone.h,isInLeftEdge=x>ll&&x<lr&&y>lt&&y<lb,rl=zone.x+zone.w*.8,rr=zone.x+zone.w,rt=zone.y+0,rb=zone.y+zone.h,isInRightEdge=x>rl&&x<rr&&y>rt&&y<rb,cl=zone.x+zone.w*.2,cr=zone.x+zone.w*.8,ct=zone.y,cb=zone.y+zone.h,isInCenter=x>cl&&x<cr&&y>ct&&y<cb,area="";if(isInLeftEdge&&(area="left"),isInRightEdge&&(area="right"),isInCenter&&(area="center"),area)return[area,zone.id]}}function getPosFromEvent(event){switch(event.type){case"touchmove":{let touch=event.touches[0];return{x:touch.clientX,y:touch.clientY}}case"pointermove":{let{x,y}=event;return{x,y}}}return{x:0,y:0}}var domlinkblocks3=document.getElementById("linkblocks"),getTitleButtons=()=>document.querySelectorAll("#tab-title button");function initTabs(data){let defaultTabTitle=document.getElementById("default-tab-title"),buttons=[...getTitleButtons()];for(let ii=1;ii<buttons.length;ii++)buttons[ii].remove();for(let ii=1;ii<data.linktabs.titles.length;ii++)appendNewTab(data.linktabs.titles[ii],ii===(data.linktabs.selected??0));defaultTabTitle.textContent=data.linktabs.titles[0]||tradThis("Default page"),defaultTabTitle.classList.toggle("selected",data.linktabs.selected===0),defaultTabTitle?.addEventListener("click",changeTab),domlinkblocks3?.classList.toggle("with-tabs",data.linktabs.active)}function appendNewTab(title,selected){let tabtitle=document.getElementById("tab-title"),button=document.createElement("button"),defaultTabName=`${tradThis("Page")} ${tabtitle?.childElementCount}`;button.textContent=title||defaultTabName,button.classList.toggle("selected",selected),button?.addEventListener("click",changeTab),tabtitle?.appendChild(button)}function changeTab(event){let button=event.currentTarget,tabTransition=transitioner();if(domlinkblocks3.dataset.folderid||button.classList.contains("selected"))return;tabTransition.first(hideCurrentTab),tabTransition.then(recreateLinksFromNewTab),tabTransition.finally(showNewTab),tabTransition.transition(100);async function recreateLinksFromNewTab(){let buttons=[...getTitleButtons()],data=await storage_default.sync.get();buttons?.forEach(div=>div.classList.remove("selected")),button.classList.add("selected"),data.linktabs.selected=buttons.indexOf(button),storage_default.sync.set(data),await initblocks(data)}function hideCurrentTab(){domlinkblocks3.classList.remove("in-folder"),domlinkblocks3.classList.add("hiding")}function showNewTab(){domlinkblocks3.classList.remove("hiding")}}var domlinkblocks4=document.getElementById("linkblocks"),initIconList=[],selectallTimer=0;async function quickLinks(init,event){if(event){linksUpdate(event);return}if(!init){errorMessage("No data for quick links !");return}domlinkblocks4.className=init.linkstyle??"large",domlinkblocks4.classList.toggle("hidden",!init.quicklinks),initblocks(init),initTabs(init),initRows(init.linksrow,init.linkstyle)}async function initblocks(data){let tabList=document.querySelector("#link-list"),folderid=domlinkblocks4.dataset.folderid,allLinks=Object.values(data).filter(val=>isLink(val)),links=folderid?getLinksInFolder(data,folderid):getLinksInTab(data),ids2=links.map(link=>link._id),linksInFolders=allLinks.filter(link=>!link.folder&&typeof link.parent=="string"),children=document.querySelectorAll("#link-list > li"),childrenIds=[...children].map(li=>li.id);for(let child of children)ids2.includes(child.id)===!1&&child.remove();if(links.length===0)return displayInterface("links"),!0;let fragment=document.createDocumentFragment();for(let link of links){let liExistsOnInterface=childrenIds.indexOf(link._id)!==-1,li;liExistsOnInterface?(li=children[childrenIds.indexOf(link._id)],li.removeAttribute("style"),tabList?.appendChild(li)):(li=isElem(link)?createElem(link,data.linknewtab,data.linkstyle):createFolder(link,linksInFolders,data.linkstyle),li.addEventListener("keyup",openEditDialog),li.addEventListener("click",selectAll),li.addEventListener("pointerdown",selectAll),li.addEventListener("pointerdown",startDrag)),fragment.appendChild(li)}return tabList?.appendChild(fragment),queueMicrotask(createIcons),displayInterface("links"),!0}function createFolder(link,folderChildren,style){let linksInThisFolder=folderChildren.filter(l=>!l.folder&&l.parent===link._id),li=getHTMLTemplate("link-folder","li"),imgs=li.querySelectorAll("img"),span=li.querySelector("span");li.id=link._id,span.textContent=createTitle(link),li.addEventListener("mouseup",folderClickAction);for(let i=0;i<linksInThisFolder.length;i++){let img=imgs[i],elem=linksInThisFolder[i];img&&isElem(elem)&&style!=="text"&&initIconList.push([img,elem.icon??getDefaultIcon(elem.url)])}return li}function createElem(link,openInNewtab,style){let li=getHTMLTemplate("link-elem","li"),span=li.querySelector("span"),anchor=li.querySelector("a"),img=li.querySelector("img");return li.id=link._id,anchor.href=stringMaxSize(link.url,512),span.textContent=createTitle(link),style!=="text"&&initIconList.push([img,link.icon??getDefaultIcon(link.url)]),openInNewtab&&(BROWSER==="safari"?anchor.onclick=handleSafariNewtab:anchor.target="_blank"),li}function createIcons(){for(let[img,url]of initIconList)img.src=url;setTimeout(()=>{let incomplete=initIconList.filter(([img])=>!img.complete);for(let[img,url]of incomplete){img.src="src/assets/interface/loading.svg";let newimg=document.createElement("img");newimg.addEventListener("load",()=>img.src=url),newimg.src=url}initIconList=[]},100)}function initRows(row,style){let linklist=document.getElementById("link-list"),sizes={large:{width:4.8,gap:2.3},medium:{width:3.5,gap:2},small:{width:2.5,gap:2},inline:{width:11,gap:2},text:{width:5,gap:2}};if(linklist&&style in sizes){let{width,gap}=sizes[style];document.documentElement.style.setProperty("--links-width",Math.ceil((width+gap)*row)+"em")}}queueMicrotask(()=>{document.addEventListener("close-folder",closeFolder),document.addEventListener("stop-select-all",()=>clearTimeout(selectallTimer)),document.addEventListener("remove-select-all",removeSelectAll)});async function folderClickAction(event){let li=getLiFromEvent(event),rightClick=event.button===2,inFolder=li?.classList.contains("folder"),isSelectAll=domlinkblocks4.className.includes("select-all");if(!li||!inFolder||rightClick||isSelectAll)return;clearTimeout(selectallTimer);let data=await storage_default.sync.get(),ctrlClick=event.button===0&&(event.ctrlKey||event.metaKey),middleClick=event.button===1;ctrlClick||middleClick?openAllLinks(data,li):openFolder(data,li)}function openAllLinks(data,li){getLinksInFolder(data,li.id).forEach(link=>window.open(link.url,"_blank")?.focus()),window.open(window.location.href,"_blank")?.focus(),window.close()}async function openFolder(data,li){let folder=data[li.id],folderOpenTransition=transitioner(),folderTitle=folder?.title||tradThis("Folder"),folderTitleBtn=document.querySelector("#folder-title button");folderTitleBtn&&(folderTitleBtn.textContent=folderTitle),folderOpenTransition.first(hide),folderOpenTransition.then(changeToFolder),folderOpenTransition.finally(show),folderOpenTransition.transition(200);function hide(){domlinkblocks4.dataset.folderid=li?.id,domlinkblocks4.classList.add("hiding"),domlinkblocks4.classList.remove("in-folder")}async function changeToFolder(){domlinkblocks4.classList.toggle("with-tabs",!0),await initblocks(data)}function show(){domlinkblocks4.classList.replace("hiding","in-folder")}}async function closeFolder(){if(domlinkblocks4.classList.contains("dropping"))return;let data=await storage_default.sync.get(),folderCloseTransition=transitioner();folderCloseTransition.first(hide),folderCloseTransition.then(changeToTab),folderCloseTransition.finally(show),folderCloseTransition.transition(200);function hide(){domlinkblocks4.dataset.folderid="",domlinkblocks4.classList.add("hiding")}async function changeToTab(){domlinkblocks4.classList.toggle("with-tabs",data.linktabs.active),await initblocks(data)}function show(){domlinkblocks4.classList.remove("in-folder"),domlinkblocks4.classList.remove("hiding")}}function selectAll(event){clearTimeout(selectallTimer);let selectAllActive=domlinkblocks4.className.includes("select-all"),primaryButton=!event.button||event.button===0,li=getLiFromEvent(event);if(selectAllActive&&event.type.match(/pointerup|click/)){primaryButton&&li?.classList.toggle("selected"),event.preventDefault();return}if(!selectAllActive&&primaryButton&&event.type==="pointerdown"){if(event?.pointerType==="touch")return;selectallTimer=setTimeout(()=>{domlinkblocks4.classList.add("select-all")},600)}}function removeSelectAll(){clearTimeout(selectallTimer),domlinkblocks4.classList.remove("select-all"),domlinkblocks4.querySelectorAll(".block").forEach(li=>li.classList.remove("selected"))}async function linksUpdate(update2){update2.addLink&&linkSubmission({type:"link",title:update2.addLink.title,url:update2.addLink.url}),update2.addFolder&&linkSubmission({type:"folder",ids:update2.addFolder}),update2.bookmarks&&linkSubmission({type:"import",bookmarks:update2.bookmarks}),update2.addToFolder&&addLinkToFolder(update2.addToFolder),update2.removeFromFolder&&removeFromFolder(update2.removeFromFolder),update2.deleteLinks&&deleteLinks(update2.deleteLinks),update2.moveToTab&&moveToOtherTab(update2.moveToTab),update2.moveLinks&&moveLinks(update2.moveLinks),update2.tab!==void 0&&setTab(update2.tab),update2.addTab!==void 0&&addTab2(update2.addTab),update2.deleteTab!==void 0&&deleteTab2(update2.deleteTab),update2.tabTitle!==void 0&&setTabTitle(update2.tabTitle.title,update2.tabTitle.index),update2.newtab!==void 0&&setOpenInNewTab(update2.newtab),update2.style&&setLinkStyle(update2.style),update2.row&&setRows(update2.row)}async function linkSubmission(arg){let folderid=domlinkblocks4.dataset.folderid,data=await storage_default.sync.get(),newlinks=[];if(arg.type==="import"&&(newlinks=(arg.bookmarks??[]).map(b=>validateLink(b.title,b.url))),arg.type==="link"){if(arg.url.length<=3)return;newlinks.push(validateLink(arg.title,arg.url))}if(arg.type==="folder"){newlinks=addLinkFolder(arg.ids,arg.title);for(let id of arg.ids){let elem=data[id];elem&&!elem.folder&&(elem.parent=newlinks[0]._id)}}for(let link of newlinks)folderid&&!link.folder?link.parent=folderid:link.parent=data.linktabs.selected,data[link._id]=link;storage_default.sync.set(correctLinksOrder(data)),initblocks(data)}function addLinkFolder(ids2,title){let titledom=document.getElementById("ei_title");title=title??titledom.value,titledom.value="";let order=[...document.querySelectorAll("li.block")].map(block=>block.id).indexOf(ids2[0]);for(let i=0;i<ids2.length;i++)document.getElementById(ids2[i])?.classList.contains("folder")&&ids2.splice(i,1);return[{_id:"links"+randomString(6),folder:!0,order,parent:0,title}]}async function addLinkToFolder({target,source}){let data=await storage_default.sync.get(),linktarget=data[target],linksource=data[source],title=linktarget.title,ids2=[];if(!linktarget||!linksource)return;let getIdsFrom=id=>getLinksInFolder(data,id).map(l=>l._id);linktarget.folder?ids2.push(target,...getIdsFrom(target)):ids2.push(target),linksource.folder?ids2.push(source,...getIdsFrom(source)):ids2.push(source);for(let[key,val]of Object.entries(data))isLink(val)!==!1&&ids2.includes(val._id)&&!val.folder&&(data[key].parent=target,data[key].order=Date.now());[linksource,linktarget].forEach(link=>{link.folder&&(delete data[link._id],storage_default.sync.remove(link._id))}),linkSubmission({ids:ids2,type:"folder",title}),animateLinksRemove(ids2)}async function removeFromFolder(ids2){let folderid=domlinkblocks4.dataset.folderid,data=await storage_default.sync.get();if(folderid){for(let id of ids2)data[id].parent=data.linktabs.selected,data[id].order=Date.now();data=correctLinksOrder(data),storage_default.sync.set(data),initblocks(data)}}async function deleteLinks(ids2){let data=await storage_default.sync.get();for(let id of ids2){let link=data[id];link.folder&&getLinksInFolder(data,link._id).forEach(child=>{delete data[child._id]}),delete data[id]}storage_default.sync.clear(),storage_default.sync.set(correctLinksOrder(data)),animateLinksRemove(ids2)}async function moveLinks(ids2){let data=await storage_default.sync.get();ids2.forEach((id,i)=>{data[id].order=i}),storage_default.sync.set(data),initblocks(data)}async function moveToOtherTab({ids:ids2,target}){let data=await storage_default.sync.get();for(let id of ids2)data[id].parent=parseInt(target),data[id].order=Date.now();data=correctLinksOrder(data),storage_default.sync.set(data),initblocks(data)}async function setTab(tab){let data=await storage_default.sync.get("linktabs");data.linktabs.active=tab,storage_default.sync.set({linktabs:data.linktabs}),domlinkblocks4?.classList.toggle("with-tabs",tab)}async function setTabTitle(title,index){let data=await storage_default.sync.get("linktabs");data.linktabs.titles.length>=index&&(data.linktabs.titles[index]=title,storage_default.sync.set({linktabs:data.linktabs}),initTabs(data))}async function addTab2(title){let data=await storage_default.sync.get("linktabs");data.linktabs.titles.push(title),storage_default.sync.set({linktabs:data.linktabs}),initTabs(data)}async function deleteTab2(index){let data=await storage_default.sync.get(),{titles,selected}=data.linktabs;if(!(index===0||titles.length===1)){for(let link of getLinksInTab(data,index))delete data[link._id];data.linktabs.titles=titles.toSpliced(index,1),data.linktabs.selected-=index===selected?1:0,initblocks(data),initTabs(data),storage_default.sync.clear(),storage_default.sync.set(data)}}async function setOpenInNewTab(newtab){let anchors=document.querySelectorAll(".block a");for(let anchor of anchors)BROWSER==="safari"?newtab?anchor.addEventListener("click",handleSafariNewtab):anchor.removeEventListener("click",handleSafariNewtab):newtab?anchor.setAttribute("target","_blank"):anchor.removeAttribute("target");storage_default.sync.set({linknewtab:newtab})}async function setLinkStyle(style="large"){if(!isLinkStyle(style))return;let wasText=domlinkblocks4?.className.includes("text"),data=await storage_default.sync.get(),links=getLinksInTab(data);domlinkblocks4.classList.remove("large","medium","small","inline","text"),domlinkblocks4.classList.add(style);for(let link of links){let span=document.getElementById(link._id).querySelector("span");span.textContent=createTitle(link)}data.linkstyle=style,storage_default.sync.set(data),wasText&&document.querySelectorAll("#link-list li")?.forEach(el=>el.remove()),console.log(wasText),initRows(data.linksrow,style),initblocks(data)}function setRows(row){let style=[...domlinkblocks4.classList].filter(isLinkStyle)[0]??"large",val=parseInt(row??"6");initRows(val,style),eventDebounce({linksrow:row})}function handleSafariNewtab(e){let anchor=e.composedPath().filter(el=>el.tagName==="A")[0];window.open(anchor?.href),e.preventDefault()}function validateLink(title,url){let startsWithEither=strs=>strs.some(str=>url.startsWith(str));url=stringMaxSize(url,512);let isConfig=startsWithEither(["about:","chrome://","edge://"]),noProtocol=!startsWithEither(["https://","http://"]),isLocalhost=url.startsWith("localhost")||url.startsWith("127.0.0.1");return url=(isConfig?"#":isLocalhost?"http://":noProtocol?"https://":"")+url,{_id:"links"+randomString(6),order:Date.now(),title:stringMaxSize(title,64),url}}function getLinksInFolder(data,id){let links=[];for(let value of Object.values(data))isElem(value)&&value?.parent===id&&links.push(value);return links.sort((a,b)=>a.order-b.order),links}function getLinksInTab(data,index){let selection=index??data.linktabs.selected??0,links=[];for(let value of Object.values(data))isLink(value)&&(value?.parent??0)===selection&&links.push(value);return links.sort((a,b)=>a.order-b.order),links}function animateLinksRemove(ids2){for(let id of ids2)document.getElementById(id)?.classList.add("removed"),setTimeout(()=>document.getElementById(id)?.remove(),600)}function correctLinksOrder(data){let folderIds=Object.values(data).filter(val=>isLink(val)).filter(link=>link.folder).map(({_id})=>_id);for(let folderId of folderIds)getLinksInFolder(data,folderId).forEach((link,i)=>{link.order=i,data[link._id]});for(let i=0;i<data.linktabs.titles.length;i++)getLinksInTab(data,i).forEach((link,i2)=>{link.order=i2,data[link._id]});return data}function isLinkStyle(s){return["large","medium","small","inline","text"].includes(s)}var dominterface=document.querySelector("#interface"),elements={time:document.getElementById("time"),main:document.getElementById("main"),quicklinks:document.getElementById("linkblocks"),searchbar:document.getElementById("sb_container"),notes:document.getElementById("notes_container"),quotes:document.getElementById("quotes_container")},smallWidth=!1,activeID,resetTimeout,isEditing=()=>dominterface?.classList.contains("move-edit")||!1;function widgetsListToData(list,data){let widgets={};return list.forEach(([id,on])=>widgets[id]=on),widgets?.time!==void 0&&(data.time=widgets.time),widgets?.main!==void 0&&(data.main=widgets.main),widgets?.quicklinks!==void 0&&(data.quicklinks=widgets.quicklinks),widgets?.searchbar!==void 0&&(data.searchbar={...data.searchbar,on:widgets.searchbar}),widgets?.quotes!==void 0&&(data.quotes={...data.quotes,on:widgets.quotes}),widgets?.notes!==void 0&&data.notes&&(data.notes={...data.notes,on:widgets.notes}),data}function areaStringToLayoutGrid(area){let splitchar=BROWSER==="safari"?'"':"'";return area.split(splitchar).filter(a=>a.length>1).map(r=>r.split(" "))}function layoutToGridAreas(grid){let areas="",itemListToString=row=>row.reduce((a,b)=>`${a} ${b}`);return grid.forEach(row=>areas+=`'${itemListToString(row)}' `),areas}function getEnabledWidgetsFromStorage(data){let displayed={time:data.time,main:data.main,notes:!!data.notes?.on,searchbar:!!data.searchbar?.on,quicklinks:data.quicklinks,quotes:!!data.quotes?.on};return Object.entries(displayed).filter(([_,val])=>val).map(([key,_])=>key)}function getEnabledWidgetsFromGrid(grid){let flat=[...grid.flat()];return flat=flat.filter(str=>str!=="."),flat=flat.filter((str,i)=>flat.indexOf(str)===i),flat}function findIdPositions(grid,id){let allpos=[];return grid.flat().forEach((a,i)=>{a===id&&allpos.push({posCol:i%grid[0].length,posRow:Math.floor(i/grid[0].length)})}),allpos}function getSpanDirection(grid,id){let poses=findIdPositions(grid,id),rows=Object.values(poses).map(({posRow})=>posRow);return poses.length<2?"none":rows[0]!==rows[1]?"columns":"rows"}function hasDuplicateInArray(arr,id){return arr.filter(a=>a===(id||activeID)).length>1}function isRowEmpty(grid,index){if(grid[index]===void 0)return!1;let row=grid[index],empty=!0;return row.forEach(cell=>{cell!=="."&&getSpanDirection(grid,cell)!=="columns"&&(empty=!1)}),empty}function spansInGridArea(grid,id,{toggle,remove}){function addSpans(arr){let target=arr.indexOf(id),stopper=[!1,!1];function replaceWithId(a,i,lim){return!stopper[lim]&&a[i]&&(a[i]==="."?a[i]=id:a[i]!==id&&(stopper[lim]=!0)),a}for(let ii=1;ii<arr.length;ii++)arr=replaceWithId(arr,target+ii,0),arr=replaceWithId(arr,target-ii,1);return arr}function removeSpans(arr){let keepfirst=!0;return arr.map(a=>{if(a===id)if(keepfirst)keepfirst=!1;else return".";return a})}let{posCol,posRow}=findIdPositions(grid,id)[0],col=grid.map(g=>g[posCol]),row=[...grid[posRow]];return remove&&(col=removeSpans(col),row=removeSpans(row)),toggle&&(toggle==="col"&&(col=hasDuplicateInArray(col)?removeSpans(col):addSpans(col)),toggle==="row"&&(row=hasDuplicateInArray(row)?removeSpans(row):addSpans(row))),grid.forEach((r,i)=>grid[i][posCol]=col[i]),grid[posRow].forEach((r,i)=>grid[posRow][i]=row[i]),grid}function gridWidget(grid,selection,id,add){function addWidget(){if(grid.length===0){if(selection==="single")return[[id]];if(selection==="double")return[[id,"."]];if(selection==="triple")return[[".",id,"."]]}let targetCol=grid[0].length===3?1:0,index=grid.length===1?1:2;id==="time"&&(index=0),id==="main"&&(index=grid[0][targetCol]==="time"?1:0),id==="quotes"&&(index=grid.length),id==="quicklinks"&&(index=grid[grid.length-1][targetCol]==="quotes"?grid.length-1:grid.length);function fillNewRow(cell,i){if(!cell||cell===".")return;let positions=findIdPositions(grid,cell);if(i===targetCol&&positions.length>1){grid=spansInGridArea(grid,cell,{remove:!0});return}getSpanDirection(grid,cell)==="columns"&&(newrow[i]=cell)}let newrow=grid[0].map(()=>"."),isLastRow=grid[index]===void 0;return grid[index-(isLastRow?1:0)].forEach((cell,i)=>fillNewRow(cell,i)),grid.splice(index,0,newrow),grid[index][targetCol]=id,grid}function removeWidget(){for(let i in grid)for(let k in grid[i])grid[i][k]===id&&(grid[i][k]=".");return grid.forEach((_,i)=>{isRowEmpty(grid,i)&&grid.splice(i,1)}),grid}return add?addWidget():removeWidget()}function setGridAreas(grid){document.documentElement.style.setProperty("--grid",layoutToGridAreas(grid))}function setAlign(id,item){let elem=elements[id];if(elem)if(elem.style.placeSelf=item?.box||"",id==="quicklinks"){let flex=item?.text=="left"?"flex-start":item?.text=="right"?"flex-end":"",linklist=document.getElementById("link-list");linklist.style.justifyContent=flex}else elem.style.textAlign=item?.text||""}function setAllAligns(items){Object.keys(elements).forEach(key=>{let id=key;setAlign(id,items[id])})}function manageGridSpanner(selection){selection!=="single"?document.getElementById("grid-spanner-container")?.classList.add("active"):document.getElementById("grid-spanner-container")?.classList.remove("active")}var gridOverlay={add:id=>{let button=document.createElement("button");button.id="move-overlay-"+id,button.className="move-overlay",dominterface?.appendChild(button),button.addEventListener("click",()=>{moveElements(void 0,{select:id})})},remove:id=>{document.querySelector("#move-overlay-"+id)?.remove()},removeAll:()=>{document.querySelectorAll(".move-overlay").forEach(d=>d.remove())}},buttonControl={layout:selection=>{document.querySelectorAll("#grid-layout button").forEach(button=>{button.classList.toggle("selected",button.dataset.layout===selection)})},grid:id=>{let grid=areaStringToLayoutGrid(document.documentElement?.style.getPropertyValue("--grid")||"");if(grid.length===0)return;let top=!1,bottom=!1,left=!1,right=!1,positions=findIdPositions(grid,id),widgetBottomLimit=getEnabledWidgetsFromGrid(grid).length-1,rightLimit=grid[0].length-1;positions.forEach(pos=>{if(pos.posRow===0&&(top=!0),pos.posCol===0&&(left=!0),pos.posCol===rightLimit&&(right=!0),pos.posRow===widgetBottomLimit&&(bottom=!0),pos.posRow===grid.length-1){let idOnlyRow=grid.at(pos.posRow)?.filter(id2=>id2!==".");new Set(idOnlyRow).size===1&&(bottom=!0)}}),document.querySelectorAll("#grid-mover button").forEach(b=>{let c=parseInt(b.dataset.col||"0"),r=parseInt(b.dataset.row||"0"),limit=!1;r===-1&&(limit=top),r===1&&(limit=bottom),c===-1&&(limit=left),c===1&&(limit=right),limit?b?.setAttribute("disabled",""):b?.removeAttribute("disabled")})},span:id=>{function applyStates(dir,state){let dirButton=document.querySelector(`#grid-span-${dir}s`),otherButton=document.querySelector(`#grid-span-${dir==="col"?"rows":"cols"}`);state?otherButton?.setAttribute("disabled",""):otherButton?.removeAttribute("disabled"),dirButton?.classList.toggle("selected",state)}let grid=areaStringToLayoutGrid(document.documentElement?.style.getPropertyValue("--grid")||"");if(grid.length===0)return;let{posCol,posRow}=findIdPositions(grid,id)[0],col=grid.map(g=>g[posCol]),row=[...grid[posRow]];applyStates("col",hasDuplicateInArray(col,id)),applyStates("row",hasDuplicateInArray(row,id))},align:item=>{let boxBtns=document.querySelectorAll("#box-alignment-mover button"),textBtns=document.querySelectorAll("#text-alignment-mover button");boxBtns.forEach(b=>b.classList.toggle("selected",b.dataset.align===(item?.box||""))),textBtns.forEach(b=>b.classList.toggle("selected",b.dataset.align===(item?.text||"")))},title:id=>{let titlestr="",editingNames={time:tradThis("Time & Date"),main:tradThis("Weather"),notes:tradThis("Notes"),searchbar:tradThis("Search bar"),quotes:tradThis("Quotes"),quicklinks:tradThis("Quick Links")};titlestr=id?editingNames[id]:tradThis("No selection"),document.getElementById("mover-title").textContent=titlestr}};function removeSelection(){activeID=null,buttonControl.align(),buttonControl.title(),document.querySelectorAll(".grid-spanner")?.forEach(elem=>{elem.removeAttribute("disabled"),elem?.classList.remove("selected")}),document.querySelectorAll(".move-overlay").forEach(elem=>{elem.classList.remove("selected")}),document.querySelectorAll("#grid-mover button").forEach(b=>{b.removeAttribute("disabled")})}function resetButtonConfirm(){let b_resetlayout=document.getElementById("b_resetlayout"),confirm=!!b_resetlayout.dataset.confirm;return clearTimeout(resetTimeout),confirm===!1?(b_resetlayout.textContent=tradThis("Are you sure ?"),b_resetlayout.dataset.confirm="true",resetTimeout=setTimeout(()=>{b_resetlayout.textContent=tradThis("Reset layout"),b_resetlayout.dataset.confirm=""},1e3)):(b_resetlayout.textContent=tradThis("Reset layout"),b_resetlayout.dataset.confirm=""),confirm}function moveElements(init,events){let moverdom=document.querySelector("#element-mover"),firstPos={x:0,y:0},moverPos={x:0,y:0};async function updateMoveElement(prop){let data=await storage_default.sync.get(),move=data.move;move||(move=structuredClone(SYNC_DEFAULT.move)),smallWidth&&(move.selection="single");function gridChange(){if(!activeID)return;let y=parseInt(prop.grid?.y||"0"),x=parseInt(prop.grid?.x||"0"),grid=move.layouts[move.selection].grid,allActivePos=findIdPositions(grid,activeID),allAffectedIds=[];allActivePos.some(({posRow})=>grid[posRow+y]===void 0)&&(move.selection==="single"&&grid.push(["."]),move.selection==="double"&&grid.push([".","."]),move.selection==="triple"&&grid.push([".",".","."])),allActivePos.forEach(({posRow,posCol})=>{let newposition=grid[posRow+y][posCol+x];newposition!=="."&&allAffectedIds.push(newposition)}),allAffectedIds.forEach(id=>{findIdPositions(grid,id).length>1&&(grid=spansInGridArea(grid,id,{remove:!0}))}),allActivePos.forEach(({posRow,posCol})=>{let newRow=Math.min(Math.max(posRow+y,0),grid.length-1),newCol=Math.min(Math.max(posCol+x,0),grid[0].length-1),tempItem=grid[posRow][posCol];grid[posRow][posCol]=grid[newRow][newCol],grid[newRow][newCol]=tempItem}),grid.forEach((_,i)=>{isRowEmpty(grid,i)&&grid.splice(i,1)}),setGridAreas(move.layouts[move.selection].grid),move.layouts[move.selection].grid=grid,buttonControl.grid(activeID),storage_default.sync.set({move})}function alignChange(type){if(!activeID)return;let item=move.layouts[move.selection].items[activeID]||{box:"",text:""};item[type]=prop.box||prop.text||"",setAlign(activeID,item),buttonControl.align(item),move.layouts[move.selection].items[activeID]=item,storage_default.sync.set({move})}function layoutChange(){(prop.layout==="single"||prop.layout==="double"||prop.layout==="triple")&&(move.selection=prop.layout);let layout=move.layouts[move.selection],widgetsInGrid=getEnabledWidgetsFromGrid(layout.grid),list=[["time",widgetsInGrid.includes("time")],["main",widgetsInGrid.includes("main")],["notes",widgetsInGrid.includes("notes")],["quotes",widgetsInGrid.includes("quotes")],["searchbar",widgetsInGrid.includes("searchbar")],["quicklinks",widgetsInGrid.includes("quicklinks")]],states=widgetsListToData(list,data);storage_default.sync.set({...states,move});let interfaceTransition=transitioner();interfaceTransition.first(()=>{interfaceFadeOut()}),interfaceTransition.then(async()=>{toggleWidgetInSettings(list),toggleWidgetOnInterface(list),setAllAligns(layout.items),setGridAreas(layout.grid),buttonControl.layout(move.selection),manageGridSpanner(move.selection),removeSelection(),dominterface?.classList.contains("move-edit")&&(gridOverlay.removeAll(),widgetsInGrid.forEach(id=>gridOverlay.add(id))),activeID&&(buttonControl.grid(activeID),buttonControl.align(layout.items[activeID]))}),interfaceTransition.finally(interfaceFadeIn),interfaceTransition.transition(200)}function layoutReset(){if(resetButtonConfirm()===!1)return;let layout=move.layouts[move.selection],enabled=getEnabledWidgetsFromStorage(data),grid=[];enabled.forEach(id=>{grid=gridWidget(grid,move.selection,id,!0)}),move.layouts[move.selection].grid=grid,move.layouts[move.selection].items={},removeSelection(),setGridAreas(layout.grid),buttonControl.title(),setAllAligns({quicklinks:{box:"",text:""},main:{box:"",text:""},time:{box:"",text:""},notes:{box:"",text:""},searchbar:{box:"",text:""},quotes:{box:"",text:""}}),storage_default.sync.set({move})}function elementSelection(){let layout=move.layouts[move.selection];if(removeSelection(),!isEditing()||!prop.select)return;let id=prop.select;buttonControl.align(layout.items[id]),buttonControl.span(id),buttonControl.grid(id),buttonControl.title(id),document.getElementById("move-overlay-"+id).classList.add("selected"),document.getElementById("element-mover")?.classList.add("active"),activeID=id}function toggleMoveStatus(){let b_editmove=document.getElementById("b_editmove");dominterface?.classList.contains("move-edit")?(b_editmove.textContent=tradThis("Open"),gridOverlay.removeAll()):(b_editmove.textContent=tradThis("Close"),buttonControl.layout(move.selection),getEnabledWidgetsFromStorage(data).forEach(id=>gridOverlay.add(id)));let mover=document.getElementById("element-mover");mover?.classList.toggle("hidden"),mover?.classList.remove("active"),dominterface?.classList.toggle("move-edit"),removeSelection()}function toggleGridSpans(dir){if(!activeID)return;let layout=move.layouts[move.selection];layout.grid=spansInGridArea(layout.grid,activeID,{toggle:dir}),setGridAreas(layout.grid),buttonControl.grid(activeID),buttonControl.span(activeID),storage_default.sync.set({move})}function pageWidthOverlay(overlay){let isEditing2=document.getElementById("interface")?.classList?.contains("move-edit"),hasOverlays=document.querySelector(".move-overlay");if(!isEditing2&&overlay===!1){gridOverlay.removeAll();return}if(!hasOverlays){let grid=move.layouts[move.selection].grid;getEnabledWidgetsFromGrid(grid).forEach(id=>{gridOverlay.add(id)})}}switch(Object.keys(prop)[0]){case"toggle":toggleMoveStatus();break;case"select":elementSelection();break;case"grid":gridChange();break;case"span":toggleGridSpans(prop.span);break;case"box":alignChange("box");break;case"text":alignChange("text");break;case"layout":layoutChange();break;case"reset":layoutReset();case"overlay":pageWidthOverlay(prop.overlay);break}events?.widget&&toggleWidget(data,events.widget)}function moverToolboxEvents(){function moverDrag(e){let pos=e.touches?e.touches[0]:e,x=pos.clientX,y=pos.clientY;if(firstPos.x===0&&firstPos.y===0){firstPos={x:x-moverPos.x,y:y-moverPos.y};return}moverPos={x:x-firstPos.x,y:y-firstPos.y},moverdom&&(moverdom.style.transform=`translate(${moverPos.x}px, ${moverPos.y}px)`,moverdom.style.cursor="grabbing")}Object.entries(elements).forEach(([key,elem])=>{elem?.addEventListener("click",()=>updateMoveElement({select:key}))}),document.querySelectorAll("#grid-mover button").forEach(btn=>{btn.addEventListener("click",()=>updateMoveElement({grid:{x:btn.dataset.col,y:btn.dataset.row}}))}),document.querySelectorAll("#box-alignment-mover button").forEach(btn=>{btn.addEventListener("click",()=>updateMoveElement({box:btn.dataset.align}))}),document.querySelectorAll("#text-alignment-mover button").forEach(btn=>{btn.addEventListener("click",()=>updateMoveElement({text:btn.dataset.align}))}),document.querySelector("#close-mover")?.addEventListener("click",()=>{updateMoveElement({toggle:!0})}),document.querySelector("#grid-span-cols")?.addEventListener("click",()=>{updateMoveElement({span:"col"})}),document.querySelector("#grid-span-rows")?.addEventListener("click",()=>{updateMoveElement({span:"row"})}),moverdom?.addEventListener("mousedown",e=>{e.target?.id==="element-mover"&&moverdom?.addEventListener("mousemove",moverDrag)}),moverdom?.addEventListener("touchstart",e=>{e.target?.id==="element-mover"&&moverdom?.addEventListener("touchmove",moverDrag)},{passive:!1});let removeDrag=()=>{firstPos={x:0,y:0},moverdom.style.removeProperty("cursor"),moverdom?.removeEventListener("mousemove",moverDrag),moverdom?.removeEventListener("touchmove",moverDrag)};moverdom?.addEventListener("mouseup",removeDrag),moverdom?.addEventListener("mouseleave",removeDrag),moverdom?.addEventListener("touchend",removeDrag)}if(events){typeof events.overlay=="boolean"&&updateMoveElement({overlay:events.overlay}),events?.widget&&updateMoveElement({widget:events.widget}),events?.select&&updateMoveElement({select:events.select}),events?.layout&&updateMoveElement({layout:events.layout}),events?.toggle&&updateMoveElement({toggle:!0}),events?.reset&&updateMoveElement({reset:!0});return}if(onSettingsLoad(moverToolboxEvents),!init&&!events){updateMoveElement({reset:!0});return}if(init){let layout=init.layouts[init.selection];manageGridSpanner(init.selection),setAllAligns(layout.items),setGridAreas(layout.grid)}}async function toggleWidget(data,widget){if(!widget)return;let interfaceTransition=transitioner(),[id,on]=widget,layout={...data.move.layouts[data.move.selection]},newgrid=gridWidget(layout.grid,data.move.selection,id,on);data.move.layouts[data.move.selection].grid=newgrid,data=widgetsListToData([[id,on]],data),storage_default.sync.set(data),interfaceTransition.first(()=>{toggleWidgetInSettings([[id,on]]),interfaceFadeOut()}),interfaceTransition.then(async()=>{setGridAreas(data.move.layouts[data.move.selection].grid),setAllAligns(data.move.layouts[data.move.selection].items),toggleWidgetOnInterface([[id,on]]),removeSelection(),isEditing()&&(on?gridOverlay.add(id):gridOverlay.remove(id))}),interfaceTransition.finally(interfaceFadeIn),interfaceTransition.transition(200)}function toggleWidgetInSettings(states){let inputids={time:"i_time",main:"i_main",quicklinks:"i_quicklinks",notes:"i_notes",quotes:"i_quotes",searchbar:"i_sb"};for(let[widget,on]of states){let input=document.getElementById(inputids[widget]);document.getElementById(widget+"_options")?.classList.toggle("shown",on),input.checked=on}}function toggleWidgetOnInterface(states){let domids={time:"time",main:"main",quicklinks:"linkblocks",notes:"notes_container",quotes:"quotes_container",searchbar:"sb_container"};for(let[widget,on]of states)document.getElementById(domids[widget])?.classList.toggle("hidden",!on)}function interfaceFadeOut(){let dominterface3=document.getElementById("interface");dominterface3.style.opacity="0",dominterface3.style.transition="opacity 200ms cubic-bezier(.215,.61,.355,1)"}function interfaceFadeIn(){let dominterface3=document.getElementById("interface");dominterface3.style.removeProperty("opacity"),setTimeout(()=>dominterface3.style.transition="",200)}async function hideElements(hide={},options){options?.isEvent&&(hide={...(await storage_default.sync.get("hide")).hide,...hide},storage_default.sync.set({hide}));for(let[key,val]of Object.entries(hide))document.querySelector(`[data-hide="${key}"]`)?.classList.toggle("he_hidden",val)}var ANNOUNCEMENT_URL="https://github.com/victrme/Bonjourr/releases/tag/v19.2.0",ANNOUNCEMENT_VERSION="19.2.0",ANNOUNCEMENT_TRNS={en:"New this update: syntax highlighted CSS editor, search bar width option and made some settings more user friendldy!"},ANNOUNCEMENT_BTN_TRNS={en:"Read the release notes"},REVIEW_TEXT="Love using Bonjourr? Consider giving us a review or donating, that would help a lot! \u{1F607}",REVIEW_URLS={chrome:"https://chrome.google.com/webstore/detail/bonjourr-%C2%B7-minimalist-lig/dlnejlppicbjfcfcedcflplfjajinajd/reviews",opera:"https://chrome.google.com/webstore/detail/bonjourr-%C2%B7-minimalist-lig/dlnejlppicbjfcfcedcflplfjajinajd/reviews",firefox:"https://addons.mozilla.org/en-US/firefox/addon/bonjourr-startpage/",safari:"https://apps.apple.com/fr/app/bonjourr-startpage/id1615431236",edge:"https://microsoftedge.microsoft.com/addons/detail/bonjourr/dehmmlejmefjphdeoagelkpaoolicmid",other:"https://bonjourr.fr/help#%EF%B8%8F-reviews"};function interfacePopup(init,event){if(event?.announcements){storage_default.sync.set({announcements:event?.announcements});return}if(!(!init||init?.announce==="off")){if(init.old&&(init.review===-1||init.review>30)){let major=s=>parseInt(s.split(".")[0]),isMajorUpdate=major(init.new)>major(init.old),isNewVersion=init.new!==init.old&&init.new===ANNOUNCEMENT_VERSION,announceMajor=init.announce==="major"&&isMajorUpdate,announceAny=init.announce==="all"&&isNewVersion;if(localStorage.hasUpdated==="true"||announceAny||announceMajor){localStorage.hasUpdated="true",displayPopup("announce");return}}init.review!==-1&&(init.review>30?displayPopup("review"):storage_default.sync.set({review:init.review+1}))}}function displayPopup(type){let template=document.getElementById("popup-template"),doc=document.importNode(template.content,!0),popup=doc.getElementById("popup"),desc=doc.getElementById("popup_desc"),close=doc.getElementById("popup_close"),buttons=doc.getElementById("popup_buttons");if(popup){if(type==="review"&&(desc.textContent=tradThis(REVIEW_TEXT),buttons.appendChild(createPopupButton(REVIEW_URLS[BROWSER],tradThis("Review"))),buttons.appendChild(createPopupButton("https://ko-fi.com/bonjourr",tradThis("Donate")))),type==="announce"){let lang=getLang(),description=ANNOUNCEMENT_TRNS[lang]??ANNOUNCEMENT_TRNS.en,buttontext=ANNOUNCEMENT_BTN_TRNS[lang]??ANNOUNCEMENT_BTN_TRNS.en;desc.textContent=description,buttons.appendChild(createPopupButton(ANNOUNCEMENT_URL,buttontext))}close?.addEventListener("click",closePopup),document.body.appendChild(popup),popup.classList.add(type),openPopup()}}function createPopupButton(href,text){let anchor=document.createElement("a");return anchor.href=href,anchor.rel="noreferrer",anchor.textContent=text,anchor.addEventListener("pointerdown",removePopupTrigger),anchor}function removePopupTrigger(){storage_default.sync.set({review:-1}),localStorage.removeItem("hasUpdated")}function openPopup(){setTimeout(()=>document.getElementById("popup")?.classList.add("shown"),800),setTimeout(()=>document.getElementById("creditContainer")?.setAttribute("style","opacity: 0"),400)}function closePopup(){setTimeout(()=>document.getElementById("popup")?.remove(),200),setTimeout(()=>document.getElementById("creditContainer")?.removeAttribute("style"),600),document.getElementById("popup")?.classList.remove("shown"),removePopupTrigger()}var collectionForm=networkForm("f_collection"),bonjourrCollections={noon:"GD4aOSg4yQE",day:"o8uX55RbBPs",evening:"3M2rKTckZaQ",night:"bHDh4Ae7O8o"};function unsplashBackgrounds(init,event){if(event&&updateUnsplash(event),init)try{init.unsplash.time===void 0?initUnsplashBackgrounds(init.unsplash,init.cache):cacheControl(init.unsplash,init.cache)}catch(e){errorMessage(e)}}async function updateUnsplash({refresh,every,collection}){let{unsplash}=await storage_default.sync.get("unsplash"),unsplashCache=await getCache();if(unsplash){if(refresh){if(sessionStorage.waitingForPreload){turnRefreshButton(refresh,!1);return}unsplash.time=0,storage_default.sync.set({unsplash}),turnRefreshButton(refresh,!0),setTimeout(()=>cacheControl(unsplash),400)}if(isEvery(every)){let currentImage=unsplashCache[unsplash.lastCollec][0];unsplash.pausedImage=every==="pause"?currentImage:void 0,unsplash.every=every,unsplash.time=freqControl.set(),storage_default.sync.set({unsplash})}if(collection===""&&(unsplashCache.user=[],unsplash.collection="",unsplash.lastCollec="day",unsplashBackgrounds({unsplash,cache:unsplashCache}),collectionForm.accept("i_collection","2nVzlQADDIE")),collection!==void 0&&collection.length>0){let isFullURL=collection.includes("https://unsplash.com/")&&collection.includes("/collections/");if(!navigator.onLine)return collectionForm.warn("No internet connection");if(isFullURL){let start=collection.indexOf("/collections/")+13,end=collection.indexOf("/",start);collection=collection.slice(start,end)}unsplash.collection=collection.replaceAll(" ",""),unsplash.lastCollec="user",unsplash.time=freqControl.set(),collectionForm.load();let list=await requestNewList(unsplash.collection);if(!list||list.length===0){collectionForm.warn(`Cannot get "${collection}"`);return}unsplashCache.user=list,await preloadImage(unsplashCache.user[0].url),preloadImage(unsplashCache.user[1].url),loadBackground(unsplashCache.user[0]),collectionForm.accept("i_collection",collection)}storage_default.sync.set({unsplash}),storage_default.local.set({unsplashCache})}}async function cacheControl(unsplash,cache){unsplash={...SYNC_DEFAULT.unsplash,...unsplash},cache=cache??await getCache();let{lastCollec}=unsplash,{every,time,collection,pausedImage}=unsplash,needNewImage=freqControl.get(every,time??Date.now());!every.match(/day|pause/)&&periodOfDay()!==lastCollec&&lastCollec!=="user"&&(lastCollec=periodOfDay());let collectionId=lastCollec==="user"?collection:bonjourrCollections[lastCollec],list=cache[lastCollec];if(list.length===0){let newlist=await requestNewList(collectionId);if(!newlist)return;list=newlist,await preloadImage(list[0].url),cache[lastCollec]=list,storage_default.local.set({unsplashCache:cache}),sessionStorage.setItem("waitingForPreload","true")}if(sessionStorage.waitingForPreload==="true"){loadBackground(list[0]),await preloadImage(list[1].url);return}if(!needNewImage){loadBackground(every==="pause"&&pausedImage?pausedImage:list[0]);return}if(unsplash.lastCollec=lastCollec,unsplash.time=freqControl.set(),list.length>1&&list.shift(),loadBackground(list[0]),every==="pause"&&(unsplash.pausedImage=list[0]),list.length===1&&navigator.onLine){let newList=await requestNewList(collectionId);newList&&(cache[unsplash.lastCollec]=list.concat(newList),await preloadImage(newList[0].url))}else list.length>1&&await preloadImage(list[1].url);storage_default.sync.set({unsplash}),storage_default.local.set({unsplashCache:cache})}async function initUnsplashBackgrounds(unsplash,cache){let lastCollec=periodOfDay(),list=await requestNewList(bonjourrCollections[lastCollec]);if(!list)return;cache[lastCollec]=list,unsplash.lastCollec=lastCollec,unsplash.time=new Date().getTime(),preloadImage(list[0].url),await new Promise(sleep=>setTimeout(sleep,200));let lastCollecAgain=periodOfDay();lastCollec!==lastCollecAgain&&(list=await requestNewList(bonjourrCollections[lastCollecAgain])??[],unsplash.lastCollec=lastCollecAgain,cache[lastCollecAgain]=list),storage_default.sync.set({unsplash}),storage_default.local.set({unsplashCache:cache}),sessionStorage.setItem("waitingForPreload","true"),loadBackground(list[0]),await preloadImage(list[1].url)}async function requestNewList(collection){let json,resp=await apiFetch(`/unsplash/photos/random?collections=${collection}&count=8`);if(resp?.status===404||(json=await resp?.json(),json.length===1))return null;let filteredList=[],{width,height}=screen,dpr=window.devicePixelRatio,quality=Math.min(100-dpr*20,75),isExifEmpty=exif=>Object.values(exif).every(val=>!val);for(let img of json)filteredList.push({url:`${img.urls.raw}&w=${width}&h=${height}&dpr=${dpr}&auto=format&q=${quality}&fit=crop`,link:img.links.html,username:img.user.username,name:img.user.name,city:img.location.city,country:img.location.country,color:img.color,exif:isExifEmpty(img.exif)?void 0:img.exif});return filteredList}function imgCredits(image){let domcontainer2=document.getElementById("creditContainer"),domcredit=document.getElementById("credit"),hasLocation=image.city||image.country,exif="",credits="";if(image.exif){let{iso,model,aperture,exposure_time,focal_length}=image.exif;model&&(exif+=`${model} - `),aperture&&(exif+=`f/${aperture} `),exposure_time&&(exif+=`${aperture}s `),iso&&(exif+=`${iso}ISO `),focal_length&&(exif+=`${focal_length}mm`)}if(hasLocation){let city=image.city||"",country=image.country||"";credits=`${city}${city&&country?", ":""}${country} <name>`}else credits=tradThis("Photo by <name>");let[location2,rest2]=credits.split(" <name>"),domlocation=document.createElement("a"),domspacer=document.createElement("span"),domrest=document.createElement("span"),domartist=document.createElement("a"),domexif=document.createElement("p");domexif.className="exif",domexif.textContent=exif,domlocation.textContent=location2,domartist.textContent=image.name.slice(0,1).toUpperCase()+image.name.slice(1),domspacer.textContent=hasLocation?" - ":" ",domrest.textContent=rest2,domlocation.href=`${image.link}?utm_source=Bonjourr&utm_medium=referral`,domartist.href=`https://unsplash.com/@${image.username}?utm_source=Bonjourr&utm_medium=referral`,domcredit&&(domcredit.textContent=""),domcredit?.appendChild(domexif),domcredit?.appendChild(domlocation),domcredit?.appendChild(domspacer),domcredit?.appendChild(domartist),domcredit?.appendChild(domrest),domcontainer2?.classList.toggle("shown",!0)}async function getCache(){return(await storage_default.local.get("unsplashCache"))?.unsplashCache??{...LOCAL_DEFAULT.unsplashCache}}function loadBackground(props){imgBackground(props.url,props.color),imgCredits(props)}async function preloadImage(src){let img=new Image;sessionStorage.setItem("waitingForPreload","true");try{img.src=src,await img.decode(),img.remove(),sessionStorage.removeItem("waitingForPreload")}catch{console.warn("Could not decode image: ",src)}}function promisifyRequest(request2){return new Promise((resolve2,reject)=>{request2.oncomplete=request2.onsuccess=()=>resolve2(request2.result),request2.onabort=request2.onerror=()=>reject(request2.error)})}function createStore(dbName,storeName){let request2=indexedDB.open(dbName);request2.onupgradeneeded=()=>request2.result.createObjectStore(storeName);let dbp=promisifyRequest(request2);return(txMode,callback)=>dbp.then(db=>callback(db.transaction(storeName,txMode).objectStore(storeName)))}var defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(key,customStore=defaultGetStore()){return customStore("readonly",store=>promisifyRequest(store.get(key)))}function set(key,value,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.put(value,key),promisifyRequest(store.transaction)))}function update(key,updater,customStore=defaultGetStore()){return customStore("readwrite",store=>new Promise((resolve2,reject)=>{store.get(key).onsuccess=function(){try{store.put(updater(this.result),key),resolve2(promisifyRequest(store.transaction))}catch(err){reject(err)}}}))}function del(key,customStore=defaultGetStore()){return customStore("readwrite",store=>(store.delete(key),promisifyRequest(store.transaction)))}var localImages=localImagesStorage(),localIsLoading=!1;async function localBackgrounds(event){if(event){updateLocalBackgrounds(event);return}try{initLocalBackgrounds()}catch(error){errorMessage(error)}}async function initLocalBackgrounds(){let{ids:ids2,selected,freq,last}=await localImages.get(),needNewImage=freqControl.get(freq,last)&&ids2.length>1;if(ids2.length===0){let data=await storage_default.sync.get("unsplash"),local=await storage_default.local.get("unsplashCache");unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache});return}if(needNewImage){let idsNoSelection=ids2.filter(l=>!l.includes(selected)),randomId=Math.floor(Math.random()*idsNoSelection.length);selected=idsNoSelection[randomId],localImages.update({selected,last:freqControl.set()})}displayCustomBackground(await getBlob(selected,"background")),onSettingsLoad(()=>initSettingsOptions())}async function initSettingsOptions(){let loadedThumbIds=[...document.querySelectorAll(".thumbnail")].map(el=>el.id),i_freq=document.getElementById("i_freq"),images=await localImages.get(),ids2=images.ids;addThumbnailsToDom(ids2,images.selected),i_freq&&(i_freq.value=images.freq),IS_MOBILE&&ids2.length>9&&(ids2=ids2.slice(0,9),document.getElementById("thumbnail-show-buttons")?.classList.add("shown")),loadedThumbIds.length>0&&(ids2=ids2.filter(id=>loadedThumbIds.includes(id)===!1))}async function updateLocalBackgrounds(event){event?.newfile&&addNewImage(event.newfile),event?.refresh&&refreshCustom(event.refresh),event?.showing&&updateThumbnailAmount(event.showing),isEvery(event?.freq)&&localImages.update({freq:event?.freq})}async function addNewImage(filelist){let fileContainer=document.getElementById("fileContainer"),{ids:ids2,selected}=await localImages.get(),blobs={},newIds=[];localIsLoading=!0,ids2.length===0&&storage_default.sync.set({background_type:"local"});for(let file of filelist){let id=randomString(8);newIds.push(id),selected=id;let thumbnail=await compressThumbnail(file);blobs[id]={thumbnail,background:file},fileContainer?.appendChild(createThumbnail(thumbnail,id,!1)),await set(id,blobs[id])}localImages.update({ids:ids2.concat(newIds),selected}),localIsLoading=!1,displayCustomBackground(blobs[selected].background),selectThumbnail(selected)}async function refreshCustom(button){localImages.update({last:0}),turnRefreshButton(button,!0),setTimeout(()=>localBackgrounds(),100)}async function updateThumbnailAmount(showing){let thumbsAmount=document.getElementById("fileContainer")?.childElementCount||0,images=await localImages.get(),ids2=[];showing==="all"&&ids2.push(...images.ids),showing==="more"&&ids2.push(...images.ids.filter((_,i)=>i<thumbsAmount+9)),ids2.length===images.ids.length&&document.getElementById("thumbnail-show-buttons")?.classList.remove("shown"),addThumbnailsToDom(ids2,images.selected)}async function displayCustomBackground(blob){blob&&(imgBackground(URL.createObjectURL(blob)),document.getElementById("creditContainer")?.classList.remove("shown"),localIsLoading=!1)}function selectThumbnail(id){document.querySelector(".thumbnail.selected")?.classList.remove("selected"),document.getElementById(id)?.classList?.add("selected")}async function getBlob(id,which){let blobs=await get(id);return blobs?blobs[which]:void 0}async function compressThumbnail(blob){let blobURL=window.URL.createObjectURL(blob),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),img=new Image;return img.src=blobURL,await new Promise(resolve2=>{img.onload=()=>{let height=140*window.devicePixelRatio,scaleFactor=height/img.height;canvas.width=img.width*scaleFactor,canvas.height=height,ctx?.drawImage(img,0,0,img.width*scaleFactor,height),resolve2(!0)}}),await new Promise(resolve2=>ctx?.canvas.toBlob(resolve2,"image/webp",80))}function createThumbnail(blob,id,isSelected){let thb=document.createElement("button"),rem=document.createElement("button"),thbimg=document.createElement("img"),remspan=document.createElement("span");if(!blob)return thb;thb.id=id,thbimg.src=URL.createObjectURL(blob),thb.className="thumbnail"+(isSelected?" selected":""),rem.classList.toggle("b_removethumb",!0),rem.classList.toggle("hidden",!IS_MOBILE),thb.setAttribute("aria-label","Select this background"),rem.setAttribute("aria-label","Remove this background"),thbimg.setAttribute("alt",""),thbimg.setAttribute("draggable","false"),remspan.textContent="\u2715",rem.appendChild(remspan),thb.appendChild(thbimg),thb.appendChild(rem),thbimg.addEventListener("click",applyThisBackground),rem.addEventListener("click",deleteThisBackground);async function applyThisBackground(e){if(e.button!==0||localIsLoading)return;let userImages=await localImages.get(),id2=this?.parentElement?.id;id2&&id2!==userImages.selected&&(localIsLoading=!1,localImages.update({selected:id2}),selectThumbnail(id2),displayCustomBackground(await getBlob(id2,"background")))}async function deleteThisBackground(e){if(e.button!==0||localIsLoading||!e.target)return;let{ids:ids2,selected}=await localImages.get(),thumbnail=this?.parentElement,id2=thumbnail?.id;if(id2&&(thumbnail?.classList.toggle("hiding",!0),setTimeout(()=>thumbnail?.remove(),100),ids2=ids2.filter(s=>!s.includes(id2)),localImages.update({ids:ids2}),del(id2)),id2===selected){if(ids2.length>0){selected=ids2[0],localImages.update({selected});let blob2=await getBlob(selected,"background");selectThumbnail(selected),displayCustomBackground(blob2);return}storage_default.sync.set({background_type:"unsplash"}),localImages.update({ids:[],selected:""}),setTimeout(async()=>{document.getElementById("creditContainer")?.classList.toggle("shown",!0);let data=await storage_default.sync.get("unsplash"),local=await storage_default.local.get("unsplashCache");unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache})},100)}}return thb}async function addThumbnailsToDom(ids2,selected){let fileContainer=document.getElementById("fileContainer"),fragment=document.createDocumentFragment(),idsToAdd=ids2.filter(id=>!document.getElementById(id));for(let id of idsToAdd){let isSelected=id===selected,blob=await getBlob(id,"thumbnail");fragment.appendChild(createThumbnail(blob,id,isSelected))}fileContainer.appendChild(fragment)}function localImagesStorage(){async function get2(){let res=await get("localImages");return{selected:res?.selected??"",freq:res?.freq??"pause",ids:res?.ids??[],last:res?.last??0}}function set2(val){set("localImages",val)}function update2(val){update("localImages",prev=>({...prev,...val}))}return{get:get2,set:set2,update:update2}}function initBackground(data,local){let type=data.background_type||"unsplash",blur=data.background_blur,brightness=data.background_bright;backgroundFilter({blur,brightness}),type==="local"?localBackgrounds():unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache})}function imgBackground(url,color){let img=new Image;img.onload=()=>{let bgoverlay=document.getElementById("background_overlay"),bgfirst=document.getElementById("background"),bgsecond=document.getElementById("background-bis"),loadBis=bgfirst.style.opacity==="1",bgToChange=loadBis?bgsecond:bgfirst;bgfirst.style.opacity=loadBis?"0":"1",bgToChange.style.backgroundImage=`url(${url})`,bgoverlay.style.opacity="1",color&&BROWSER==="safari"&&(document.querySelector('meta[name="theme-color"]')?.setAttribute("content",color),setTimeout(()=>document.documentElement.style.setProperty("--average-color",color),400))},img.src=url,img.remove()}function backgroundFilter({blur,brightness,isEvent}){let hasbright=typeof brightness=="number",hasblur=typeof blur=="number";hasblur&&document.documentElement.style.setProperty("--background-blur",blur.toString()+"px"),hasbright&&document.documentElement.style.setProperty("--background-brightness",brightness.toString()),isEvent&&hasblur&&eventDebounce({background_blur:blur}),isEvent&&hasbright&&eventDebounce({background_bright:brightness})}function updateBackgroundOption({freq,refresh}){let isLocal=document.getElementById("i_type").value==="local";freq!==void 0&&(isLocal?localBackgrounds({freq}):unsplashBackgrounds(void 0,{every:freq})),refresh&&(isLocal?localBackgrounds({refresh}):unsplashBackgrounds(void 0,{refresh}))}var quotesTypeForm=networkForm("f_qttype");async function quotes(init,update2){if(update2){updateQuotes(update2);return}if(!init)return;let{lang,quotes:quotes2}=init.sync,needsNewQuote=freqControl.get(quotes2.frequency,quotes2.last),list=init.local?.quotesCache??[],selection=init.local?.userQuoteSelection??0,quote=list[0],noCache=!list||list?.length===0,isUser=quotes2.type==="user";noCache&&(list=await newQuoteFromAPI(lang,quotes2.type),quote=list[0],storage_default.local.set({quotesCache:list})),isUser&&(list=csvUserInputToQuotes(quotes2.userlist),quote=list[selection]),needsNewQuote&&(quotes2.last=freqControl.set(),quote=controlCacheList(list,lang,quotes2.type),storage_default.sync.set({quotes:quotes2})),insertToDom(quote),toggleAuthorAlwaysOn(quotes2.author),document.getElementById("quotes_container")?.classList.toggle("hidden",!quotes2.on),displayInterface("quotes")}async function updateQuotes({author,frequency,type,userlist,refresh}){let data=await storage_default.sync.get(["lang","quotes"]),local=await storage_default.local.get("quotesCache");author!==void 0&&(data.quotes.author=author,toggleAuthorAlwaysOn(author)),userlist&&(data.quotes.userlist=handleUserListChange(userlist)),refresh&&(data.quotes.last=freqControl.set(),refreshQuotes(data,local?.quotesCache)),isEvery(frequency)&&(data.quotes.frequency=frequency),isQuotesType(type)&&(data.quotes.type=type,updateQuotesType(data,type)),storage_default.sync.set({quotes:data.quotes})}async function updateQuotesType(data,type){let isUser=type==="user",list=[],selection=0;isUser&&data.quotes.userlist&&(selection=(await storage_default.local.get("userQuoteSelection"))?.userQuoteSelection??0,list=csvUserInputToQuotes(data.quotes.userlist)),isUser||(quotesTypeForm.load(),list=await newQuoteFromAPI(data.lang,type),storage_default.local.set({quotesCache:list})),list.length>0&&insertToDom(list[selection]),document.getElementById("quotes_userlist")?.classList.toggle("shown",isUser),quotesTypeForm.accept()}function handleUserListChange(input){let array=[];return input.length===0?"":(input.startsWith("[[")&&(input=oldJSONToCSV(parse(input)??[])),array=csvUserInputToQuotes(input),array.length>0&&(insertToDom({author:array[0].author,content:array[0].content}),document.getElementById("i_qtlist")?.blur(),storage_default.local.set({userQuoteSelection:0})),input)}function refreshQuotes(data,list=[]){data.quotes.type==="user"&&data.quotes.userlist&&(list=csvUserInputToQuotes(data.quotes.userlist)),insertToDom(controlCacheList(list,data.lang,data.quotes.type))}async function newQuoteFromAPI(lang,type){try{if(!navigator.onLine||type==="user")return[];let query=type+=type==="classic"?`/${lang}`:"",response=await apiFetch("/quotes/"+query),json=await response?.json();if(response?.ok)return json}catch(error){console.warn(error)}return[]}function controlCacheList(list,lang,type){if(type==="user"){let randIndex=Math.round(Math.random()*(list.length-1));return storage_default.local.set({userQuoteSelection:randIndex}),list[randIndex]}return list.length>1&&(list.shift(),storage_default.local.set({quotesCache:list})),list.length<2&&newQuoteFromAPI(lang,type).then(list2=>{storage_default.local.set({quotesCache:list2})}),list[0]}function toggleAuthorAlwaysOn(state){document.getElementById("author")?.classList.toggle("always-on",state)}function insertToDom(quote){let quoteDOM=document.getElementById("quote"),authorDOM=document.getElementById("author");!quote||!quoteDOM||!authorDOM||(quoteDOM.textContent=quote.content,authorDOM.textContent=quote.author)}function csvUserInputToQuotes(csv){Array.isArray(csv)&&(csv=oldJSONToCSV(csv));let rows=csv?.split(`
`)??[],arr=[];for(let row of rows){let[author,...rest2]=row.split(","),content=rest2.join(",").trimStart();arr.push({author,content})}return arr}function oldJSONToCSV(input){return input.map(val=>val.join(",")).join(`
`)}function isQuotesType(type=""){return["classic","kaamelott","inspirobot","user"].includes(type)}var bookmarkFolders=[];onSettingsLoad(()=>{let bookmarksdom=document.getElementById("bookmarks"),closebutton=document.getElementById("bmk_close");document.getElementById("bmk_apply").addEventListener("click",()=>importSelectedBookmarks()),closebutton.addEventListener("click",()=>bookmarksdom.close()),bookmarksdom.addEventListener("click",e=>e.composedPath()[0]===bookmarksdom?bookmarksdom.close():null)});async function linksImport(){let bookmarksdom=document.getElementById("bookmarks"),foldersdom=Object.values(document.querySelectorAll(".bookmarks-folder")),treenode=await getBookmarkTree();treenode||await getPermissions()&&(treenode=await getBookmarkTree()),treenode&&(bookmarksdom.showModal(),bookmarkFolders=[],foldersdom?.forEach(node=>node.remove()),parseThroughImport(treenode[0]),addBookmarksFolderToDOM())}async function syncNewBookmarks(init,update2){if(PLATFORM==="online"||PLATFORM==="safari")return;if(update2!==void 0){updateSyncBookmarks(update2);return}let treenode=await getBookmarkTree();if(!treenode||!init)return;parseThroughImport(treenode[0]);let lastCheck=init??Date.now(),newBookmarks=bookmarkFolders.map(folder=>folder.bookmarks).flat().filter(bookmark=>bookmark.dateAdded>lastCheck);newBookmarks.length>0&&(storage_default.sync.set({syncbookmarks:Date.now()}),setTimeout(()=>quickLinks(void 0,{bookmarks:newBookmarks})))}async function updateSyncBookmarks(update2){let i_syncbookmarks=document.getElementById("#i_syncbookmarks");await getPermissions()||(i_syncbookmarks.checked=!1,update2=!1),update2?storage_default.sync.set({syncbookmarks:Date.now()}):storage_default.sync.remove("syncbookmarks")}function importSelectedBookmarks(){let bookmarksdom=document.getElementById("bookmarks"),selected=document.querySelectorAll("li.selected"),flatList=bookmarkFolders.map(folder=>folder.bookmarks).flat(),ids2=Object.values(selected).map(li=>li.id),list={},selectedLinks=[];flatList.forEach(({id,title,url})=>{list[id]={title,url}});for(let id of ids2)selectedLinks.push(list[id]);quickLinks(void 0,{bookmarks:selectedLinks}),document.getElementById("bmk_apply")?.classList.toggle("none",!0),bookmarksdom.close()}function selectBookmark(li){li.classList.toggle("selected");let applybutton=document.getElementById("bmk_apply"),counter=document.querySelectorAll("li.selected").length;counter===0&&(applybutton.textContent=tradThis("Select bookmarks")),counter===1&&(applybutton.textContent=tradThis("Import this bookmark")),counter>1&&(applybutton.textContent=tradThis("Import these bookmarks")),applybutton.classList.toggle("none",counter===0)}function parseThroughImport(treenode){let folder={title:treenode.title,bookmarks:[]};for(let child of treenode.children??[])child.children?parseThroughImport(child):child.url&&folder.bookmarks?.push({id:randomString(6),title:child.title,url:child.url,dateAdded:child.dateAdded??0});folder.bookmarks.length>0&&bookmarkFolders.push(folder)}function addBookmarksFolderToDOM(){let container2=document.getElementById("bookmarks-container");for(let folder of bookmarkFolders){let div=getHTMLTemplate("bookmarks-folder","div"),ol=div.querySelector("ol"),h2=div.querySelector("h2");h2.textContent=folder.title,container2.appendChild(div);for(let bookmark of folder.bookmarks){let li=getHTMLTemplate("bookmarks-item","li"),button=li.querySelector("button"),p_title=li.querySelector(".bookmark-title"),p_url=li.querySelector(".bookmark-url"),img=li.querySelector("img"),url;try{url=new URL(bookmark.url)}catch{return}img.src="https://api.bonjourr.lol/favicon/blob/"+url.origin,p_title.textContent=bookmark.title,p_url.textContent=url.href.replace(url.protocol,"").replace("//","").replace("www.",""),button.addEventListener("click",()=>selectBookmark(li)),li.id=bookmark.id,ol.appendChild(li)}}}async function getPermissions(){return await(PLATFORM==="firefox"?browser:chrome).permissions.request({permissions:["bookmarks"]})}async function getBookmarkTree(){let namespace=PLATFORM==="firefox"?browser:chrome;if(namespace?.bookmarks)return await namespace.bookmarks.getTree()}function favicon(val,isEvent){function createFavicon(emoji){let svg=`data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="85">${emoji}</text></svg>`,defaulticon="/src/assets/"+(BROWSER==="edge"?"monochrome.png":"favicon.ico"),domfavicon=document.getElementById("favicon");domfavicon.href=emoji?svg:defaulticon}if(isEvent){let isEmojiOrShape=val?.match(/[\p{Emoji}\u25A0-\u25FF]/gu)&&!val?.match(/[0-9a-z]/g);eventDebounce({favicon:isEmojiOrShape?val:""}),document.getElementById("head-favicon")?.remove()}BROWSER==="firefox"?setTimeout(()=>createFavicon(val),0):createFavicon(val)}function tabTitle(val="",isEvent){document.title=stringMaxSize(val,80)||tradThis("New tab"),isEvent&&eventDebounce({tabtitle:stringMaxSize(val,80)})}function pageControl(val,isEvent){val.width&&(document.documentElement.style.setProperty("--page-width",(val.width??SYNC_DEFAULT.pagewidth)+"px"),isEvent&&eventDebounce({pagewidth:val.width})),typeof val.gap=="number"&&(document.documentElement.style.setProperty("--page-gap",(val.gap??SYNC_DEFAULT.pagegap)+"em"),isEvent&&eventDebounce({pagegap:val.gap}))}function darkmode(value,isEvent){let theme="light";switch(value){case"disable":theme="light";break;case"enable":theme="dark";break;case"system":theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";break;case"auto":{let now=minutator(new Date),{sunrise:sunrise2,sunset:sunset2}=suntime();theme=now<=sunrise2||now>sunset2?"dark":"light";break}}if(document.documentElement.dataset.theme=theme,isEvent){storage_default.sync.set({dark:value});return}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",event=>{document.documentElement.dataset.theme=event.matches?"dark":"light"})}function textShadow(init,event){let val=init??event;document.documentElement.style.setProperty("--text-shadow-alpha",(val??.2)?.toString()),typeof event=="number"&&eventDebounce({textShadow:val})}var JSON_PROTO=Object.getPrototypeOf({});function fastifyDeepMerge(options){function isNotPrototypeKey(value){return value!=="constructor"&&value!=="prototype"&&value!=="__proto__"}function cloneArray(value){let i=0,il=value.length,result=new Array(il);for(i=0;i<il;++i)result[i]=clone(value[i]);return result}function cloneObject(target){let result={};if(cloneProtoObject&&Object.getPrototypeOf(target)!==JSON_PROTO)return cloneProtoObject(target);let targetKeys=getKeys(target),i,il,key;for(i=0,il=targetKeys.length;i<il;++i)isNotPrototypeKey(key=targetKeys[i])&&(result[key]=clone(target[key]));return result}function concatArrays(target,source){let tl=target.length,sl=source.length,i=0,result=new Array(tl+sl);for(i=0;i<tl;++i)result[i]=clone(target[i]);for(i=0;i<sl;++i)result[i+tl]=clone(source[i]);return result}let propertyIsEnumerable=Object.prototype.propertyIsEnumerable;function getSymbolsAndKeys(value){let result=Object.keys(value),keys=Object.getOwnPropertySymbols(value);for(let i=0,il=keys.length;i<il;++i)propertyIsEnumerable.call(value,keys[i])&&result.push(keys[i]);return result}let getKeys=options&&options.symbols?getSymbolsAndKeys:Object.keys,cloneProtoObject=typeof options?.cloneProtoObject=="function"?options.cloneProtoObject:void 0;function isMergeableObject(value){return typeof value=="object"&&value!==null&&!(value instanceof RegExp)&&!(value instanceof Date)}function isPrimitive(value){return typeof value!="object"||value===null}let isPrimitiveOrBuiltIn=typeof Buffer<"u"?value=>typeof value!="object"||value===null||value instanceof RegExp||value instanceof Date||value instanceof Buffer:value=>typeof value!="object"||value===null||value instanceof RegExp||value instanceof Date,mergeArray=options&&typeof options.mergeArray=="function"?options.mergeArray({clone,deepmerge:_deepmerge,getKeys,isMergeableObject}):concatArrays;function clone(entry){return isMergeableObject(entry)?Array.isArray(entry)?cloneArray(entry):cloneObject(entry):entry}function mergeObject(target,source){let result={},targetKeys=getKeys(target),sourceKeys=getKeys(source),i,il,key;for(i=0,il=targetKeys.length;i<il;++i)isNotPrototypeKey(key=targetKeys[i])&&sourceKeys.indexOf(key)===-1&&(result[key]=clone(target[key]));for(i=0,il=sourceKeys.length;i<il;++i)isNotPrototypeKey(key=sourceKeys[i])&&(key in target&&(targetKeys.indexOf(key)!==-1&&(result[key]=_deepmerge(target[key],source[key])),!0)||(result[key]=clone(source[key])));return result}function _deepmerge(target,source){let sourceIsArray=Array.isArray(source),targetIsArray=Array.isArray(target);return isPrimitive(source)?source:isPrimitiveOrBuiltIn(target)?clone(source):sourceIsArray&&targetIsArray?mergeArray(target,source):sourceIsArray!==targetIsArray?clone(source):mergeObject(target,source)}function _deepmergeAll(){switch(arguments.length){case 0:return{};case 1:return clone(arguments[0]);case 2:return _deepmerge(arguments[0],arguments[1])}let result;for(let i=0,il=arguments.length;i<il;++i)result=_deepmerge(result,arguments[i]);return result}return options&&options.all?_deepmergeAll:_deepmerge}var deepmerge=fastifyDeepMerge({symbols:!1}),deepmergeAll=fastifyDeepMerge({all:!0,symbols:!1});function filterImports(current,toImport){if(toImport.reviewPopup&&(toImport.review=toImport.reviewPopup==="removed"?-1:+toImport.reviewPopup),toImport.font&&(toImport.font.weightlist=toImport.font?.availWeights??[],delete toImport.font.url,delete toImport.font.availWeights,toImport.font.system===void 0&&(toImport.font.system=!1)),toImport.weather&&toImport.weather?.geolocation===void 0){let oldLocation=toImport.weather?.location??[];toImport.weather.geolocation="approximate",toImport.weather.geolocation=oldLocation.length===0?"off":"precise",delete toImport.weather.location,delete toImport.weather.lastState,delete toImport.weather.lastCall}if(Array.isArray(toImport.hide)&&(toImport.hide[0][0]&&(toImport.hide.clock=!0),toImport.hide[0][1]&&(toImport.hide.date=!0),toImport.hide[1][0]&&(toImport.hide.greetings=!0),toImport.hide[1][1]&&(toImport.hide.weatherdesc=!0),toImport.hide[1][2]&&(toImport.hide.weathericon=!0),toImport.hide[3][0]&&(toImport.hide.settingsicon=!0),toImport.time=!(toImport.hide.clock&&toImport.hide.date),toImport.main=!(toImport.hide.weatherdesc&&toImport.hide.weathericon&&toImport.hide.weathericon)),toImport.background_type==="dynamic"&&(toImport.background_type="unsplash"),toImport.background_type==="custom"&&(toImport.background_type="local"),toImport.dynamic&&(toImport.unsplash={...toImport.dynamic,pausedImage:void 0},delete toImport.dynamic),typeof toImport.searchbar=="boolean"&&(toImport.searchbar={...SYNC_DEFAULT.searchbar,on:toImport.searchbar,newtab:toImport.searchbar_newtab||!1,engine:toImport.searchbar_engine?.replace("s_","")||"google",suggestions:!1},delete toImport.searchbar_newtab,delete toImport.searchbar_engine),Array.isArray(toImport.links)&&(toImport.links.length>0&&toImport.quicklinks===void 0&&(toImport.quicklinks=!0),toImport.links?.forEach(({title,url,icon},i)=>{let id="links"+randomString(6),filteredIcon=icon?.startsWith("alias:")?toImport[icon]:icon;toImport[id]={_id:id,order:i,title,url,icon:filteredIcon}}),delete toImport.links,Object.keys(toImport).filter(key=>key.match("alias:")).forEach(key=>delete toImport[key])),Array.isArray(toImport?.quotes?.userlist)&&(toImport.quotes.userlist=oldJSONToCSV(toImport.quotes.userlist)),!toImport.move){let importStates={time:toImport.time??current.time,main:toImport.main??current.main,notes:toImport.notes?.on??(current.notes?.on||!1),quotes:toImport.quotes?.on??current.quotes?.on,searchbar:toImport.searchbar?.on??current.searchbar?.on,quicklinks:toImport.quicklinks??current.quicklinks},diffWidgets={time:current.time!==importStates.time,main:current.main!==importStates.main,notes:current.notes?.on!==importStates.notes,quotes:current.quotes?.on!==importStates.quotes,searchbar:current.searchbar?.on!==importStates.searchbar,quicklinks:current.quicklinks!==importStates.quicklinks};Object.keys(toImport).some(key=>key.match(/time|main|notes|quotes|searchbar|quicklinks/g))&&(current.move.selection="single");let layout=structuredClone(current.move.layouts[current.move.selection]);Object.entries(diffWidgets).filter(([_,diff])=>diff===!0).forEach(([key,_])=>{layout.grid=gridWidget(layout.grid,current.move.selection,key,importStates[key])}),current.move.layouts[current.move.selection].grid=layout.grid,current.move.layouts[current.move.selection].items=layout.items}toImport.move&&current.move&&Object.entries(toImport.move?.layouts).forEach(([key,layout])=>{let keyIsValidLayout=key in current.move.layouts,layoutKey=key;layout.grid&&keyIsValidLayout&&(current.move.layouts[layoutKey].grid=[])});let importedURLs=bundleLinks(toImport).map(link=>link.folder?"":link.url),currentLinks=bundleLinks(current);for(let ii=0;ii<currentLinks.length;ii++){let link=currentLinks[ii];!link.folder&&link.url===importedURLs[ii]&&delete current[link._id]}if(toImport.linktabs){let importTitles=toImport.linktabs.titles,currentTitles=current.linktabs.titles;toImport.linktabs.titles=importTitles.filter((title,i)=>title!=currentTitles[i])}return current=deepmergeAll(current,toImport,{about:SYNC_DEFAULT.about}),current}function orderedStringify(data){let orderedKeys=[...Object.keys(SYNC_DEFAULT)],keylist=new Set;JSON.stringify(data,(key,value)=>(keylist.add(key),value));let links=bundleLinks(data);links.length>0&&links.forEach(link=>orderedKeys.splice(orderedKeys.indexOf("linksrow")+1,0,link._id));let sortOrder=(a,b)=>orderedKeys.indexOf(a)-orderedKeys.indexOf(b);return JSON.stringify(data,Array.from(keylist).sort(sortOrder),2)}async function settingsInit(){if(document.getElementById("settings"))return;let data=await storage_default.sync.get(),outerHtml=`<aside id="settings" class="init">${await(await fetch("settings.html")).text()}</aside>`,settingsDom=new DOMParser().parseFromString(outerHtml,"text/html").getElementById("settings");document.body.appendChild(settingsDom),traduction(settingsDom,data.lang),settingsFooter(),showall(data.showall,!1),updateExportJSON(data),initOptionsValues(data),initOptionsEvents(),settingsDrawerBar(),controlOptionsTabFocus(settingsDom),loadCallbacks(),queueMicrotask(()=>document.dispatchEvent(new Event("settings")));let storageUpdate=()=>updateExportJSON(),removeListener=()=>chrome.storage.onChanged.removeListener(storageUpdate);PLATFORM==="online"?window.addEventListener("storage",storageUpdate):(chrome.storage.onChanged.addListener(storageUpdate),window.addEventListener("beforeunload",removeListener,{once:!0})),document.addEventListener("toggle-settings",toggleSettingsMenu)}function initOptionsValues(data){let domsettings=document.getElementById("settings"),userQuotes=data.quotes?.userlist?.[0]?data.quotes?.userlist:void 0;setInput("i_blur",data.background_blur??15),setInput("i_bright",data.background_bright??.8),setInput("i_row",data.linksrow||8),setInput("i_linkstyle",data.linkstyle||"default"),setInput("i_type",data.background_type||"unsplash"),setInput("i_freq",data.unsplash?.every),setInput("i_dark",data.dark||"system"),setInput("i_favicon",data.favicon??""),setInput("i_tabtitle",data.tabtitle??""),setInput("i_pagewidth",data.pagewidth||1600),setInput("i_pagegap",data.pagegap??1),setInput("i_dateformat",data.dateformat||"eu"),setInput("i_greeting",data.greeting??""),setInput("i_textshadow",data.textShadow??.2),setInput("i_noteswidth",data.notes?.width||50),setInput("i_notesopacity",data.notes?.opacity.toString()||.1),setInput("i_notesalign",data.notes?.align||"left"),setInput("i_sbengine",data.searchbar?.engine||"google"),setInput("i_sbplaceholder",data.searchbar?.placeholder||""),setInput("i_sbopacity",data.searchbar?.opacity??.1),setInput("i_sbwidth",data.searchbar?.width??30),setInput("i_sbrequest",data.searchbar?.request||""),setInput("i_qtfreq",data.quotes?.frequency||"day"),setInput("i_qttype",data.quotes?.type||"classic"),setInput("i_qtlist",userQuotes??""),setInput("i_clockface",data.clock?.face||"none"),setInput("i_clockstyle",data.clock?.style||"round"),setInput("i_clocksize",data.clock?.size??5),setInput("i_timezone",data.clock?.timezone||"auto"),setInput("i_collection",data.unsplash?.collection??""),setInput("i_geol",data.weather?.geolocation||"approximate"),setInput("i_ccode",data.weather?.ccode||"US"),setInput("i_units",data.weather?.unit??"metric"),setInput("i_forecast",data.weather?.forecast||"auto"),setInput("i_temp",data.weather?.temperature||"actual"),setInput("i_moreinfo",data.weather?.moreinfo||"none"),setInput("i_provider",data.weather?.provider??""),setInput("i_weight",data.font?.weight||"300"),setInput("i_size",data.font?.size||(IS_MOBILE?11:14)),setInput("i_announce",data.announcements??"major"),setCheckbox("i_showall",data.showall),setCheckbox("i_settingshide",data.hide?.settingsicon??!1),setCheckbox("i_quicklinks",data.quicklinks),setCheckbox("i_syncbookmarks",!!data.syncbookmarks),setCheckbox("i_linktabs",data.linktabs.active),setCheckbox("i_linknewtab",data.linknewtab),setCheckbox("i_time",data.time),setCheckbox("i_main",data.main),setCheckbox("i_greethide",!data.hide?.greetings),setCheckbox("i_notes",data.notes?.on??!1),setCheckbox("i_sb",data.searchbar?.on??!1),setCheckbox("i_quotes",data.quotes?.on??!1),setCheckbox("i_ampm",data.clock?.ampm??!1),setCheckbox("i_sbsuggestions",data.searchbar?.suggestions??!0),setCheckbox("i_sbnewtab",data.searchbar?.newtab??!1),setCheckbox("i_qtauthor",data.quotes?.author??!1),setCheckbox("i_seconds",data.clock?.seconds??!1),setCheckbox("i_analog",data.clock?.analog??!1),translatePlaceholders(),IS_MOBILE&&(domsettings.querySelector(".tooltiptext .instructions").textContent=tradThis("Edit your Quick Links by long-pressing the icon."));let i_lang=paramId("i_lang");if(Object.entries(langs_default).forEach(([code,title])=>{let option=document.createElement("option");option.value=code,option.text=title,i_lang.appendChild(option)}),setInput("i_lang",data.lang||"en"),localStorage.hasUpdated==="true"&&changelogControl(domsettings),(BROWSER==="safari"||PLATFORM==="online")&&(paramId("importbookmarks")?.setAttribute("style","display: none"),paramId("syncbookmarks")?.setAttribute("style","display: none")),BROWSER==="safari"&&paramId("i_favicon").setAttribute("style","display: none"),PLATFORM==="safari"&&paramId("save_wrapper").setAttribute("style","display: none"),paramId("time_options")?.classList.toggle("shown",data.time),paramId("analog_options")?.classList.toggle("shown",data.clock.analog&&data.showall),paramId("digital_options")?.classList.toggle("shown",!data.clock.analog),paramId("main_options")?.classList.toggle("shown",data.main),paramId("weather_provider")?.classList.toggle("shown",data.weather?.moreinfo==="custom"),paramId("quicklinks_options")?.classList.toggle("shown",data.quicklinks),paramId("notes_options")?.classList.toggle("shown",data.notes?.on||!1),paramId("searchbar_options")?.classList.toggle("shown",data.searchbar?.on),paramId("searchbar_request")?.classList.toggle("shown",data.searchbar?.engine==="custom"),paramId("quotes_options")?.classList.toggle("shown",data.quotes?.on),domsettings.querySelectorAll("#grid-layout button").forEach(b=>{let selectedLayout=b.dataset.layout===(data.move?.selection||"single");b?.classList.toggle("selected",selectedLayout)}),function(){let{clock:clock2,date,weatherdesc,weathericon}=data.hide||{},time=!clock2&&!date?"all":clock2?"clock":"date",weather2=weatherdesc&&weathericon?"disabled":weatherdesc?"desc":weathericon?"icon":"all";setInput("i_timehide",time),setInput("i_weatherhide",weather2)}(),paramId("local_options")?.classList.toggle("shown",data.background_type==="local"),paramId("unsplash_options")?.classList.toggle("shown",data.background_type==="unsplash"),data?.unsplash?.collection){let coll=data?.unsplash?.collection;paramId("i_collection")?.setAttribute("placeholder",coll||"2nVzlQADDIE")}paramId("quotes_options")?.classList.toggle("shown",data.quotes?.on),paramId("quotes_userlist")?.classList.toggle("shown",data.quotes?.type==="user"),document.querySelectorAll("#settings form").forEach(form=>{form.querySelectorAll("input").forEach(input=>{input.addEventListener("input",()=>form.classList.toggle("valid",form.checkValidity()))})})}function initOptionsEvents(){paramId("i_showall").addEventListener("change",function(){showall(this.checked,!0)}),paramId("i_lang").addEventListener("change",function(){switchLangs(this.value)}),paramId("i_favicon").addEventListener("input",function(){favicon(this.value,!0)}),paramId("i_favicon").addEventListener("change",function(){paramId("i_favicon").blur()}),paramId("i_tabtitle").addEventListener("input",function(){tabTitle(this.value,!0)}),paramId("i_tabtitle").addEventListener("change",function(){paramId("i_tabtitle").blur()}),paramId("i_dark").addEventListener("change",function(){darkmode(this.value,!0)}),paramId("i_settingshide").addEventListener("change",function(){hideElements({settingsicon:this.checked},{isEvent:!0})}),paramId("i_quicklinks").addEventListener("click",function(){moveElements(void 0,{widget:["quicklinks",this.checked]})}),paramId("f_addlink").addEventListener("submit",function(event){event.preventDefault(),quickLinks(void 0,{addLink:{title:paramId("i_addlink-title").value,url:paramId("i_addlink-url").value}}),paramId("i_addlink-url").value="",paramId("i_addlink-title").value=""}),paramId("i_syncbookmarks").addEventListener("change",function(){syncNewBookmarks(void 0,this.checked)}),paramId("i_linktabs").addEventListener("change",function(){quickLinks(void 0,{tab:this.checked})}),paramId("i_linknewtab").addEventListener("change",function(){quickLinks(void 0,{newtab:this.checked})}),paramId("i_linkstyle").addEventListener("change",function(){quickLinks(void 0,{style:this.value})}),paramId("i_row").addEventListener("input",function(){quickLinks(void 0,{row:this.value})}),paramId("b_importbookmarks").addEventListener("click",linksImport),paramId("i_type").addEventListener("change",function(){selectBackgroundType(this.value)}),paramId("i_freq").addEventListener("change",function(){updateBackgroundOption({freq:this.value})}),paramId("i_refresh").addEventListener("click",function(){updateBackgroundOption({refresh:this.children[0]})}),paramId("f_collection").addEventListener("submit",function(event){event.preventDefault(),unsplashBackgrounds(void 0,{collection:stringMaxSize(paramId("i_collection").value,256)})}),paramId("i_bgfile").addEventListener("change",function(){localBackgrounds({newfile:this.files})}),paramId("b_thumbnail-more").addEventListener("click",function(){localBackgrounds({showing:"more"})}),paramId("b_thumbnail-all").addEventListener("click",function(){localBackgrounds({showing:"all"})}),paramId("i_blur").addEventListener("input",function(){backgroundFilter({blur:parseFloat(this.value),isEvent:!0})}),paramId("i_bright").addEventListener("input",function(){backgroundFilter({brightness:parseFloat(this.value),isEvent:!0})}),paramId("i_time").addEventListener("change",function(){moveElements(void 0,{widget:["time",this.checked]})}),paramId("i_analog").addEventListener("change",function(){clock(void 0,{analog:this.checked})}),paramId("i_seconds").addEventListener("change",function(){clock(void 0,{seconds:this.checked})}),paramId("i_clockface").addEventListener("change",function(){clock(void 0,{face:this.value})}),paramId("i_clockstyle").addEventListener("change",function(){clock(void 0,{style:this.value})}),paramId("i_clocksize").addEventListener("input",function(){clock(void 0,{size:parseFloat(this.value)})}),paramId("i_ampm").addEventListener("change",function(){clock(void 0,{ampm:this.checked})}),paramId("i_timezone").addEventListener("change",function(){clock(void 0,{timezone:this.value})}),paramId("i_dateformat").addEventListener("change",function(){clock(void 0,{dateformat:this.value})}),paramId("i_timehide").addEventListener("change",function(){hideElements({clock:this.value==="clock",date:this.value==="date"},{isEvent:!0})}),paramId("i_main").addEventListener("change",function(){moveElements(void 0,{widget:["main",this.checked]})}),paramId("i_geol").addEventListener("change",function(event){weather(void 0,{geol:this?.value})}),paramId("i_city").addEventListener("input",function(){document.getElementById("f_location")?.classList.toggle("valid",this.value.length>2)}),paramId("f_location").addEventListener("submit",function(event){weather(void 0,{city:!0}),event.preventDefault()}),paramId("i_units").addEventListener("change",function(){weather(void 0,{units:this.value})}),paramId("i_forecast").addEventListener("change",function(){weather(void 0,{forecast:this.value})}),paramId("i_temp").addEventListener("change",function(){weather(void 0,{temp:this.value})}),paramId("i_moreinfo").addEventListener("change",function(){weather(void 0,{moreinfo:this.value})}),paramId("i_provider").addEventListener("change",function(){weather(void 0,{provider:this.value}),this.blur()}),paramId("i_weatherhide").addEventListener("change",function(){let weatherdesc=this.value==="disabled"||this.value==="desc",weathericon=this.value==="disabled"||this.value==="icon";hideElements({weatherdesc,weathericon},{isEvent:!0}),weather(void 0,{unhide:!0})}),paramId("i_greethide").addEventListener("change",function(){hideElements({greetings:!this.checked},{isEvent:!0})}),paramId("i_greeting").addEventListener("input",function(){clock(void 0,{greeting:stringMaxSize(this.value,32)})}),paramId("i_greeting").addEventListener("change",function(){paramId("i_greeting").blur()}),paramId("i_notes").addEventListener("click",function(){moveElements(void 0,{widget:["notes",this.checked]})}),paramId("i_notesalign").addEventListener("change",function(){notes(void 0,{align:this.value})}),paramId("i_noteswidth").addEventListener("input",function(){notes(void 0,{width:this.value})}),paramId("i_notesopacity").addEventListener("input",function(){notes(void 0,{opacity:this.value})}),paramId("i_sb").addEventListener("click",function(){moveElements(void 0,{widget:["searchbar",this.checked]})}),paramId("i_sbengine").addEventListener("change",function(){searchbar(void 0,{engine:this.value})}),paramId("i_sbopacity").addEventListener("input",function(){searchbar(void 0,{opacity:this.value})}),paramId("i_sbwidth").addEventListener("input",function(){searchbar(void 0,{width:this.value})}),paramId("i_sbrequest").addEventListener("change",function(){searchbar(void 0,{request:this})}),paramId("i_sbnewtab").addEventListener("change",function(){searchbar(void 0,{newtab:this.checked})}),paramId("i_sbsuggestions").addEventListener("change",function(){searchbar(void 0,{suggestions:this.checked})}),paramId("i_sbplaceholder").addEventListener("keyup",function(){searchbar(void 0,{placeholder:this.value})}),paramId("i_sbplaceholder").addEventListener("change",function(){paramId("i_sbplaceholder").blur()}),paramId("i_quotes").addEventListener("click",function(){moveElements(void 0,{widget:["quotes",this.checked]})}),paramId("i_qtfreq").addEventListener("change",function(){quotes(void 0,{frequency:this.value})}),paramId("i_qttype").addEventListener("change",function(){quotes(void 0,{type:this.value})}),paramId("i_qtrefresh").addEventListener("click",function(){inputThrottle(this),turnRefreshButton(this.children[0],!0),quotes(void 0,{refresh:!0})}),paramId("i_qtauthor").addEventListener("change",function(){quotes(void 0,{author:this.checked})}),paramId("i_qtlist").addEventListener("change",function(){quotes(void 0,{userlist:this.value})}),paramId("i_customfont").addEventListener("pointerenter",function(){customFont(void 0,{autocomplete:!0})}),paramId("f_customfont").addEventListener("submit",function(event){customFont(void 0,{family:paramId("i_customfont").value}),event.preventDefault()}),paramId("i_weight").addEventListener("input",function(){customFont(void 0,{weight:this.value})}),paramId("i_size").addEventListener("input",function(){customFont(void 0,{size:this.value})}),paramId("i_textshadow").addEventListener("input",function(){textShadow(void 0,parseFloat(this.value))}),paramId("b_editmove").addEventListener("click",function(){moveElements(void 0,{toggle:!0})}),paramId("b_resetlayout").addEventListener("click",function(){moveElements(void 0,{reset:!0})});for(let button of paramId("grid-layout").querySelectorAll("button"))button.addEventListener("click",()=>{moveElements(void 0,{layout:button.dataset.layout||""})});if(paramId("i_pagewidth").addEventListener("input",function(){pageControl({width:parseInt(this.value)},!0)}),paramId("i_pagegap").addEventListener("input",function(){pageControl({gap:parseFloat(this.value)},!0)}),paramId("i_pagewidth").addEventListener("touchstart",()=>moveElements(void 0,{overlay:!0}),{passive:!0}),paramId("i_pagewidth").addEventListener("mousedown",()=>moveElements(void 0,{overlay:!0})),paramId("i_pagewidth").addEventListener("touchend",()=>moveElements(void 0,{overlay:!1})),paramId("i_pagewidth").addEventListener("mouseup",()=>moveElements(void 0,{overlay:!1})),paramId("i_announce").addEventListener("change",function(){interfacePopup(void 0,{announcements:this.value})}),paramId("s_export").addEventListener("click",function(){toggleSettingsManagement(!1)}),paramId("s_import").addEventListener("click",function(){toggleSettingsManagement(!0)}),paramId("b_exportfile").addEventListener("click",function(){exportAsFile()}),paramId("b_exportcopy").addEventListener("click",function(){copyImportText(this)}),paramId("i_importfile").addEventListener("change",function(){importAsFile(this)}),paramId("i_importtext").addEventListener("keyup",function(){importAsText(this.value)}),paramId("b_resetconf").addEventListener("click",function(){paramsReset("conf")}),paramId("b_resetyes").addEventListener("click",function(){paramsReset("yes")}),paramId("b_resetno").addEventListener("click",function(){paramsReset("no")}),paramId("b_importtext").addEventListener("click",function(){let val=document.getElementById("i_importtext").value;paramsImport(parse(val)??{})}),IS_MOBILE){let touchHandler=touch=>document.getElementById("settings")?.classList.toggle("see-through",touch);document.querySelectorAll("input[type='range'").forEach(input=>{input.addEventListener("touchstart",()=>touchHandler(!0),{passive:!0}),input.addEventListener("touchend",()=>touchHandler(!1),{passive:!0})})}paramClasses("uploadContainer").forEach(function(uploadContainer){let toggleDrag=()=>uploadContainer.classList.toggle("dragover"),input=uploadContainer.querySelector('input[type="file"');input?.addEventListener("dragenter",toggleDrag),input?.addEventListener("dragleave",toggleDrag),input?.addEventListener("drop",toggleDrag)}),document.querySelectorAll(".tooltip").forEach(elem=>{elem.addEventListener("click",function(){let cl=[...elem.classList].filter(c=>c.startsWith("tt"))[0];document.querySelector(".tooltiptext."+cl)?.classList.toggle("shown")})})}function toggleSettingsMenu(){let domsettings=document.getElementById("settings"),domshowsettings=document.getElementById("showSettings"),dominterface3=document.getElementById("interface"),domedit=document.getElementById("editlink"),isClosed=domsettings?.classList.contains("shown")===!1;domsettings?.classList.toggle("init",!1),domsettings?.classList.toggle("shown",isClosed),domedit?.classList.toggle("pushed",isClosed),dominterface3?.classList.toggle("pushed",isClosed),domshowsettings?.classList.toggle("shown",isClosed),domsettings?.style.removeProperty("transform"),domsettings?.style.removeProperty("transition"),domsettings?.style.removeProperty("--translate-y"),document.dispatchEvent(new Event("close-edit"))}function changelogControl(settingsDom){let domshowsettings=document.querySelector("#showSettings"),domchangelog=settingsDom.querySelector("#changelogContainer");if(!domchangelog)return;domchangelog.classList.toggle("shown",!0),domshowsettings?.classList.toggle("hasUpdated",!0);let dismiss=()=>{domshowsettings?.classList.toggle("hasUpdated",!1),domchangelog.className="dismissed",localStorage.removeItem("hasUpdated")},loglink=settingsDom.querySelector("#link"),logdismiss=settingsDom.querySelector("#log_dismiss");loglink.onclick=()=>dismiss(),logdismiss.onclick=()=>dismiss()}function translatePlaceholders(){let cases=[["i_title","Name"],["i_greeting","Name"],["i_tabtitle","New tab"],["i_sbrequest","Search query: %s"],["i_sbplaceholder","Search"],["cssEditor","Type in your custom CSS"],["i_importtext","or paste as text"],["i_addlink-title","Title"],["i_addlink-url","example.com"]];for(let[id,text]of cases)document.getElementById(id)?.setAttribute("placeholder",tradThis(text))}async function switchLangs(nextLang){await toggleTraduction(nextLang),storage_default.sync.set({lang:nextLang}),storage_default.local.remove("quotesCache"),document.documentElement.setAttribute("lang",nextLang);let data=await storage_default.sync.get(),local=await storage_default.local.get(["quotesCache","userQuoteSelection","lastWeather"]);local?.lastWeather&&(local.lastWeather.timestamp=0,local.lastWeather.forecasted_timestamp=0),data.lang=nextLang,clock(data),weather({sync:data,lastWeather:local.lastWeather}),quotes({sync:data,local}),tabTitle(data.tabtitle),notes(data.notes),customFont(void 0,{lang:!0}),settingsFooter(),translatePlaceholders()}function showall(val,event){document.getElementById("settings")?.classList.toggle("all",val),event&&storage_default.sync.set({showall:val})}async function selectBackgroundType(cat){if(document.getElementById("local_options")?.classList.toggle("shown",cat==="local"),document.getElementById("unsplash_options")?.classList.toggle("shown",cat==="unsplash"),cat==="local"&&(localBackgrounds({settings:document.getElementById("settings")}),setTimeout(()=>localBackgrounds(),100)),cat==="unsplash"){let data=await storage_default.sync.get(),local=await storage_default.local.get("unsplashCache");if(!data.unsplash)return;document.querySelector("#i_freq").value=data.unsplash.every||"hour",document.getElementById("creditContainer")?.classList.toggle("shown",!0),setTimeout(()=>unsplashBackgrounds({unsplash:data.unsplash,cache:local.unsplashCache}),100)}storage_default.sync.set({background_type:cat})}function settingsFooter(){let one=document.querySelector("#signature-one"),two=document.querySelector("#signature-two"),donate=document.getElementById("donate"),version=document.getElementById("version"),rand=Math.random()>.5;one&&two&&(one.href=rand?"https://victr.me/":"https://tahoe.be/",two.href=rand?"https://tahoe.be/":"https://victr.me/",one.textContent=rand?"Victor Azevedo":"Tahoe Beetschen",two.textContent=rand?"Tahoe Beetschen":"Victor Azevedo"),version&&(version.textContent=SYNC_DEFAULT.about.version),(SYSTEM_OS==="ios"||PLATFORM==="safari")&&donate?.remove()}function controlOptionsTabFocus(settingsDom){optionsTabIndex(settingsDom);for(let option of settingsDom.querySelectorAll(".opt-hider"))option.addEventListener("input",function(){setTimeout(()=>optionsTabIndex(settingsDom),10)})}function optionsTabIndex(settingsDom){let id=s=>settingsDom.querySelector(`#${s}`),isAllSettings=id("i_showall")?.checked,toggleTabindex=(parent,on=!0)=>{settingsDom?.querySelectorAll(`${parent} :is(input,  select,  button,  a, textarea)`).forEach(dom=>{on?dom.removeAttribute("tabindex"):dom.setAttribute("tabindex","-1")})};isAllSettings&&toggleTabindex(".as",!0),settingsDom.querySelectorAll(".dropdown").forEach(dom=>{toggleTabindex("#"+dom.id,dom?.classList.contains("shown"))}),isAllSettings===!1&&toggleTabindex(".as",!1),settingsDom.querySelectorAll(".tooltiptext").forEach(dom=>{toggleTabindex("."+dom.classList[1],dom?.classList.contains("shown"))}),toggleTabindex("#analog_options",id("analog_options")?.classList.contains("shown")),toggleTabindex("#digital_options",id("digital_options")?.classList.contains("shown")),toggleTabindex("#searchbar_request",id("searchbar_request")?.classList.contains("shown")),toggleTabindex("#weather_provider",id("weather_provider")?.classList.contains("shown")),toggleTabindex("#quotes_userlist",id("quotes_userlist")?.classList.contains("shown")),toggleTabindex("#import",id("import")?.classList.contains("shown")),toggleTabindex("#export",id("export")?.classList.contains("shown")),toggleTabindex("#sett_city",id("i_geol")?.checked===!1)}function settingsDrawerBar(){let drawerDragDebounce=debounce(()=>{document.getElementById("settings-footer").style.removeProperty("padding"),drawerDragEvents()},600);window.addEventListener("resize",()=>{drawerDragDebounce(),document.getElementById("settings")?.style.transition||document.getElementById("settings")?.setAttribute("style","transition: none")}),drawerDragEvents()}function drawerDragEvents(){let settingsDom=document.getElementById("settings"),settingsVh=-75,firstPos=0,startTouchY=0,dragzone=settingsDom.querySelector("#mobile-drag-zone");dragzone?.addEventListener("touchstart",dragStart,{passive:!1}),dragzone?.addEventListener("mousedown",dragStart),dragzone?.addEventListener("touchend",dragEnd,{passive:!1}),dragzone?.addEventListener("mouseup",dragEnd),document.body?.addEventListener("mouseleave",e=>{settingsDom?.classList.contains("shown")&&window.innerWidth<600&&dragEnd(e)});function dragStart(e){e.preventDefault(),e.type==="mousedown"&&(startTouchY=e.clientY),e.type==="touchstart"&&(startTouchY=e.touches[0].clientY),firstPos===0&&(firstPos=startTouchY),SYSTEM_OS.match(/windows|android/)&&(settingsDom.style.width="calc(100% - 10px)",settingsDom.style.paddingRight="10px"),settingsDom.style.overflow="clip",window.addEventListener("touchmove",dragMove),window.addEventListener("mousemove",dragMove)}function dragMove(e){let clientY=0;e.type==="mousemove"&&(clientY=e.clientY),e.type==="touchmove"&&(clientY=e.touches[0].clientY),clientY>60&&(settingsVh=+(100-clientY/window.innerHeight*100).toFixed(2),settingsDom.style.transform=`translateY(-${settingsVh}vh)`,settingsDom.style.transition="transform .0s")}function dragEnd(e){let clientY=0;(e.type==="mouseup"||e.type==="mouseleave")&&(clientY=e.clientY),e.type==="touchend"&&(clientY=e.changedTouches[0].clientY),window.removeEventListener("touchmove",dragMove),window.removeEventListener("mousemove",dragMove),startTouchY=0;let footer=document.getElementById("settings-footer");footer.style.paddingBottom=100-Math.abs(settingsVh)+"vh",settingsDom.style.removeProperty("padding"),settingsDom.style.removeProperty("width"),settingsDom.style.removeProperty("overflow"),clientY>window.innerHeight-100&&toggleSettingsMenu()}}function toggleSettingsManagement(toggled){document.getElementById("export")?.classList.toggle("shown",!toggled),document.getElementById("import")?.classList.toggle("shown",toggled),document.querySelector(".importexport-tabs")?.classList.toggle("toggled",toggled)}async function copyImportText(target){try{let pre=document.getElementById("export-data");await navigator.clipboard.writeText(pre?.textContent??"{}"),target.textContent=tradThis("Copied"),setTimeout(()=>{let domimport=document.getElementById("b_exportcopy");domimport&&(domimport.textContent=tradThis("Copy text"))},1e3)}catch(err){console.error("Failed to copy: ",err)}}async function exportAsFile(){let a=document.getElementById("downloadfile");if(!a)return;let date=new Date,data=await storage_default.sync.get()??{},zero=n=>n.toString().length===1?"0"+n:n.toString(),YYYYMMDD=date.toISOString().slice(0,10),HHMMSS=`${zero(date.getHours())}_${zero(date.getMinutes())}_${zero(date.getSeconds())}`,bytes=new TextEncoder().encode(orderedStringify(data)),blob=new Blob([bytes],{type:"application/json;charset=utf-8"}),href=URL.createObjectURL(blob);a.setAttribute("href",href),a.setAttribute("tabindex","-1"),a.setAttribute("download",`bonjourr-${data?.about?.version} ${YYYYMMDD} ${HHMMSS}.json`),a.click()}function importAsText(string2){let importtext=document.getElementById("b_importtext");try{parse(string2),importtext?.removeAttribute("disabled")}catch{importtext?.setAttribute("disabled","")}}function importAsFile(target){function decodeExportFile(str){let result={};try{result=parse(atob(str))??{}}catch{try{result=parse(str)??{}}catch{result={}}}return result}if(!target.files||target.files&&target.files.length===0)return;let file=target.files[0],reader=new FileReader;reader.onload=()=>{if(typeof reader.result!="string")return!1;let importData=decodeExportFile(reader.result);Object.keys(SYNC_DEFAULT).filter(key=>key in importData).length>0&&paramsImport(importData)},reader.readAsText(file)}async function paramsImport(toImport){try{let data=await storage_default.sync.get();if(toImport?.font?.system===!1){let family=toImport?.font?.family,lang=toImport?.lang;await fontIsAvailableInSubset(lang,family)===!1&&(toImport.font.family="")}data=filterImports(data,toImport),storage_default.sync.clear(),storage_default.sync.set(data),fadeOut()}catch(e){console.log(e)}}function paramsReset(action){if(action==="yes"){storage_default.sync.clear(),storage_default.local.clear(),setTimeout(()=>{storage_default.sync.set({...getSyncDefaults()}),storage_default.local.set({...LOCAL_DEFAULT}),fadeOut()},50);return}document.getElementById("reset_first")?.classList.toggle("shown",action==="no"),document.getElementById("reset_conf")?.classList.toggle("shown",action==="conf")}function updateExportJSON(data){data?updateTextArea(data):storage_default.sync.get().then(updateTextArea);function updateTextArea(data2){let pre=document.getElementById("export-data");pre&&(data2.about.browser=PLATFORM,pre.textContent=orderedStringify(data2))}}function fadeOut(){let dominterface3=document.getElementById("interface");dominterface3.click(),dominterface3.style.transition="opacity .4s",setTimeout(()=>dominterface3.style.opacity="0"),setTimeout(()=>location.reload(),400)}function paramId(str){return document.getElementById(str)}function paramClasses(str){return document.querySelectorAll(`.${str}`)}function setCheckbox(id,cat){let checkbox=paramId(id);checkbox.checked=cat}function setInput(id,val){let input=paramId(id);input.value=typeof val=="string"?val:val?.toString()}var dominterface2=document.getElementById("interface"),features=["clock","links"],interfaceDisplayCallback=()=>{},loadtime=performance.now();try{startup(),serviceWorker(),onlineAndMobile()}catch(error){errorMessage(error)}async function startup(){let{sync,local}=await storage_default.init(),OLD_VERSION=sync?.about?.version,versionChanged=OLD_VERSION!==CURRENT_VERSION,firstStart=OLD_VERSION===void 0&&Object.keys(sync).length===0;if(versionChanged&&(firstStart?(console.log(`First install: ${CURRENT_VERSION}`),sync=await getSyncDefaults()):(console.log(`Version change: ${OLD_VERSION} => ${CURRENT_VERSION}`),sync=upgradeSyncStorage(sync)),storage_default.sync.set(sync)),await setTranslationCache(sync.lang,local,versionChanged),displayInterface(void 0,sync),traduction(null,sync.lang),suntime(local.lastWeather?.sunrise,local.lastWeather?.sunset),weather({sync,lastWeather:local.lastWeather}),customFont(sync.font),textShadow(sync.textShadow),favicon(sync.favicon),tabTitle(sync.tabtitle),clock(sync),darkmode(sync.dark),searchbar(sync.searchbar),quotes({sync,local}),notes(sync.notes),moveElements(sync.move),customCss(sync.css),hideElements(sync.hide),initBackground(sync,local),quickLinks(sync),syncNewBookmarks(sync.syncbookmarks),pageControl({width:sync.pagewidth,gap:sync.pagegap}),document.getElementById("time")?.classList.toggle("hidden",!sync.time),document.getElementById("main")?.classList.toggle("hidden",!sync.main),onInterfaceDisplay(()=>{document.body.classList.remove("init"),userActionsEvents(),setPotatoComputerMode(),interfacePopup({old:OLD_VERSION,new:CURRENT_VERSION,review:sync.review??0,announce:sync.announcements})}),BROWSER==="opera"&&PLATFORM==="chrome"&&!local?.operaExplained)return operaExtensionExplainer()}function upgradeSyncStorage(data){if(data.reviewPopup&&(data.review=data.reviewPopup==="removed"?-1:+data.reviewPopup),Array.isArray(data?.quotes?.userlist)){let newuserlist=oldJSONToCSV(data?.quotes?.userlist);data.quotes.userlist=newuserlist}return data.dateformat||(data.dateformat=data.usdate?"us":"eu"),data.linktabs||(data.linktabs={...SYNC_DEFAULT.linktabs}),data?.css&&(data.css=data.css.replaceAll("#clock","#digital").replaceAll("#analogClock","#analog").replaceAll("#center","#analog-center").replaceAll("#hours","#analog-hours").replaceAll("#minutes","#analog-minutes").replaceAll("#analogSeconds","#analog-seconds")),storage_default.sync.remove("reviewPopup"),storage_default.sync.remove("usdate"),delete data.reviewPopup,delete data.usdate,delete data.cssHeight,storage_default.sync.remove("cssHeight"),data=linksDataMigration(data),data.about=SYNC_DEFAULT.about,data}function displayInterface(ready,data){if(data){data?.font?.family&&features.push("fonts"),data?.quotes?.on&&features.push("quotes");return}else if(!ready)return;let index=features.indexOf(ready);if(index!==-1)features.splice(index,1);else return;features.length>0||(loadtime=Math.min(performance.now()-loadtime,400),loadtime=loadtime>33?loadtime:0,document.documentElement.style.setProperty("--load-time-transition",loadtime+"ms"),document.body.classList.remove("loading"),setTimeout(()=>{onInterfaceDisplay()},Math.max(333,loadtime)))}function onInterfaceDisplay(callback){callback?interfaceDisplayCallback=callback:interfaceDisplayCallback()}function userActionsEvents(){let toggleSettingsMenu2=()=>document.dispatchEvent(new Event("toggle-settings")),domsuggestions2=document.getElementById("sb-suggestions"),domshowsettings=document.querySelector("#showSettings"),isMousingDownOnInput=!1;document.body.addEventListener("mousedown",detectTargetAsInputs),document.getElementById("showSettings")?.addEventListener("click",toggleSettingsMenu2),document.getElementById("b_editmove")?.addEventListener("click",closeSettingsOnMoveOpen),domshowsettings?.addEventListener("mouseenter",settingsFirstLoad),domshowsettings?.addEventListener("pointerdown",settingsFirstLoad),document.body.addEventListener("keydown",settingsFirstLoad),document.addEventListener("click",clickUserActions),document.addEventListener("keydown",keydownUserActions);async function keydownUserActions(event){if(event.altKey&&event.code==="KeyS"&&(console.clear(),console.log(localStorage),console.log(await storage_default.sync.get())),event.code==="Escape"){if(domsuggestions2?.classList.contains("shown")){domsuggestions2?.classList.remove("shown");return}let open=isOpen();open.contextmenu?document.dispatchEvent(new Event("close-edit")):open.settings?toggleSettingsMenu2():open.selectall?document.dispatchEvent(new Event("remove-select-all")):open.folder?document.dispatchEvent(new Event("close-folder")):toggleSettingsMenu2();return}if(event.code==="Tab"){document.body.classList.toggle("tabbing",!0);return}}async function clickUserActions(event){if(isMousingDownOnInput)return;let open=isOpen(),path=event.composedPath()??[document.body],pathIds=path.map(el=>el.id),on={link:path.some(el=>el?.classList?.contains("block")),body:path[0].tagName==="BODY",folder:path.some(el=>el?.id==="linkblocks"&&el?.classList?.contains("in-folder")),interface:pathIds.includes("interface")};document.body.classList.contains("tabbing")&&document.body?.classList.toggle("tabbing",!1),(on.body||on.interface)!==!1&&(open.contextmenu?document.dispatchEvent(new Event("close-edit")):open.settings?toggleSettingsMenu2():open.selectall&&!on.link?document.dispatchEvent(new Event("remove-select-all")):open.folder&&!on.folder&&document.dispatchEvent(new Event("close-folder")))}function isOpen(){return{settings:!!document.getElementById("settings")?.classList.contains("shown"),folder:document.getElementById("linkblocks")?.classList.contains("in-folder"),selectall:document.getElementById("linkblocks")?.classList.contains("select-all"),contextmenu:document.querySelector("#editlink")?.open}}function detectTargetAsInputs(event){let tagName=event.composedPath()[0]?.tagName??"";isMousingDownOnInput=["TEXTAREA","INPUT"].includes(tagName)}function closeSettingsOnMoveOpen(){setTimeout(()=>{document.getElementById("element-mover")?.classList.contains("hidden")===!1&&toggleSettingsMenu2()},20)}function settingsFirstLoad(event){if(document.getElementById("settings"))return;let type=event?.type,code=event?.code,iosClickStart=SYSTEM_OS==="ios"&&event?.type==="pointerdown";(code==="Escape"||type==="mouseenter"||type==="pointerdown")&&(domshowsettings?.removeEventListener("mouseenter",settingsFirstLoad),domshowsettings?.removeEventListener("pointerdown",settingsFirstLoad),document.body.removeEventListener("keydown",settingsFirstLoad),settingsInit()),(code==="Escape"||iosClickStart)&&setTimeout(()=>domshowsettings?.dispatchEvent(new MouseEvent("click")),20)}}function onlineAndMobile(){let onlineFirefoxMobile=PLATFORM==="online"&&BROWSER==="firefox"&&IS_MOBILE,onlineSafariIOS=PLATFORM==="online"&&BROWSER==="safari"&&SYSTEM_OS==="ios",visibilityHasChanged=!1,firefoxRAFTimeout;IS_MOBILE&&document.addEventListener("visibilitychange",updateOnVisibilityChange),onlineFirefoxMobile&&(updateAppHeight(),SYSTEM_OS==="ios"&&(window.requestAnimationFrame(triggerAnimationFrame),setTimeout(()=>cancelAnimationFrame(firefoxRAFTimeout),500))),onlineSafariIOS&&onSettingsLoad(()=>{let inputs=document.querySelectorAll('input[type="text"], input[type="url"], textarea');for(let input of inputs)input.addEventListener("focus",disableTouchAction),input.addEventListener("blur",enableTouchAction)});async function updateOnVisibilityChange(){if(visibilityHasChanged===!1){visibilityHasChanged=!0;return}visibilityHasChanged=!1;let data=await storage_default.sync.get(),local=await storage_default.local.get(["unsplashCache","lastWeather"]);if(!data?.clock||!data?.weather)return;let frequency=freqControl.get(data.unsplash.every,data.unsplash.time??Date.now());data.background_type==="unsplash"&&frequency&&data.unsplash&&initBackground(data,local),clock(data),weather({sync:data,lastWeather:local.lastWeather})}function triggerAnimationFrame(){updateAppHeight(),firefoxRAFTimeout=requestAnimationFrame(triggerAnimationFrame)}function updateAppHeight(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}function disableTouchAction(){let settingsDom=document.getElementById("settings");dominterface2&&settingsDom&&(dominterface2.style.touchAction="none",settingsDom.style.touchAction="none")}function enableTouchAction(){let settingsDom=document.getElementById("settings");dominterface2&&settingsDom&&(dominterface2.style.removeProperty("touch-action"),settingsDom.style.removeProperty("touch-action"))}}function serviceWorker(){if(ENVIRONNEMENT!=="PROD"||PLATFORM!=="online"||!("serviceWorker"in navigator))return;navigator.serviceWorker.register("service-worker.js");let promptEvent;window.addEventListener("beforeinstallprompt",function(e){return promptEvent=e,promptEvent})}async function setPotatoComputerMode(){if(BROWSER==="firefox"||BROWSER==="safari")return;let fourHours=1e3*60*60*4,isPotato=localStorage.potato==="yes";if(Date.now()-parseInt(localStorage.lastPotatoCheck??"0")<fourHours){document.body.classList.toggle("potato",isPotato);return}let gl=document.createElement("canvas")?.getContext("webgl"),debugInfo=gl?.getExtension("WEBGL_debug_renderer_info");if(BROWSER==="chrome"&&!gl){document.body.classList.add("potato");return}let vendor=gl?.getParameter(debugInfo?.UNMASKED_VENDOR_WEBGL??0)+"",renderer=gl?.getParameter(debugInfo?.UNMASKED_RENDERER_WEBGL??0)+"",detectedPotato=vendor.includes("Google")&&renderer.includes("SwiftShader");localStorage.potato=detectedPotato?"yes":"no",localStorage.lastPotatoCheck=Date.now(),document.body.classList.toggle("potato",detectedPotato)}function operaExtensionExplainer(){let doc=document.getElementById("opera-explainer-template").content.cloneNode(!0),dialog=doc.getElementById("opera-explainer"),button=doc.getElementById("b_opera-explained");document.body.classList.add("loading"),document.body.appendChild(dialog),dialog.showModal(),setTimeout(()=>dialog.classList.add("shown")),button?.addEventListener("click",()=>{storage_default.local.set({operaExplained:!0}),document.body.classList.remove("loading"),dialog.close()})}})();
